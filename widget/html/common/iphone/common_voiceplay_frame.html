<!-- 名称：通用页面：语音播放window -->
<!-- 功能：语音播放通用页面 -->
<!-- 作者：王帅  -->
<!-- 时间：2016.12.02 -->
<!-- 传参说明： voice_content：播放内容； nameWin：window名称；voice_type：朗读页面显示隐藏判断参数，2是打开，1是隐藏 -->
<!-- 使用说明：调用时，使用commonListernArticle方法打开此页面，并传递参数1或者2,1路径为../common/common_voiceplay_frame.html 2路径为../../../common/common_voiceplay_frame.html-->
<!-- 范例页面：voicePlayer.js-->
<!-- 注意事项： -->
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
        <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
        <title>通用页面：语音播放window</title>
        <link rel="stylesheet" type="text/css" href="../../../css/aui/aui.css" />
        <style>
            html, body {
                background-color: transparent;
            }
            body {
                padding: 0;
                margin: 0;
            }
            .shadow {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                z-index: 1;
            }
            .clearfix:after {
                content: ' ';
                display: block;
                clear: both;
                visibility: hidden;
                line-height: 0;
                height: 0;
            }
            .header {
                width: 100%;
                height: 45px;
            }
            .main {
                background-color: rgba(0,0,0,0.9);
                position: absolute;
                left: 0;
                bottom: 0;
                width: 100%;
                z-index: 2;
                font-size: 15px;
                color: #8A8A8A;
            }
            .main .name {
                height: 50px;
                line-height: 50px;
            }
            .main .bb {
                width: 100%;
                border-bottom: 1px solid #313131;
                padding-bottom: 15px;
            }
            .mlr15 {
                margin: 0 15px;
            }
            .seleted-sound div {
                display: inline-block;
                width: 47%;
                height: 42px;
                text-align: center;
                line-height: 42px;
                border: 1px solid #8A8A8A;
                border-radius: 5px;
            }
            .seleted-sound .man {
                float: left;
            }
            .seleted-sound .women {
                float: right;
            }
            .seleted-sound div.selected {
                color: #BE4C46;
                border: 1px solid #BE4C46;
            }
            .seleted-sound div.selected a {
                color: #BE4C46 !important;
            }
            .speak {
                height: 23px;
            }
            .speak div {
                display: inline-block;
                width: 20px;
            }
            .speak .fast {
                float: right;
            }
            .speak .slow {
                float: left;
            }
            .btn {
                height: 50px;
                line-height: 50px;
                text-align: center;
            }
            .btn div {
                display: inline-block;
                width: 49%;
            }
            .back {
                position: relative;
                color: #8A8A8A;
                padding-left: 0;
                padding-right: 0;
            }
            .shadow {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                z-index: 1;
            }
        </style>
    </head>
    <body >
        <div class="shadow" tapmode onclick="frameHide();"></div>
        <div id="header" class="header" ></div>
        <div id="main" class="main clearfix"  >
            <div class="bb clearfix">
                <div class="name  mlr15 clearfix">
                    选择声音:
                </div>
                <div class="seleted-sound  mlr15 clearfix">
                    <div id="man" class="man selected" onclick="toggleSelected(1,'Male')">
                        <a class="aui-iconfont aui-icon-man back"></a>
                        磁性男声
                    </div>
                    <div id="women" class="women" onclick="toggleSelected(0,'Female')">
                        <a class="aui-iconfont aui-icon-women back"></a>
                        甜美女声
                    </div>
                </div>
            </div>
            <div class="bb clearfix">
                <div class="name  mlr15 clearfix">
                    语速调整:
                </div>
                <div class="speak mlr15 clearfix">
                    <div class="slow">
                        慢
                    </div>
                    <div class="fast">
                        快
                    </div>
                </div>
            </div>
            <div class="btn clearfix">
                <div style="border-right:1px solid #313131;" onclick="startPlay();">
                    开始语音朗读
                </div>
                <div onclick="endPlay();">
                    结束语音朗读
                </div>
            </div>
        </div>
    </body>
    <script type="text/javascript" src="../../../script/api.js"></script>
    <script type="text/javascript" src="../../../script/assembly/slidingDevice.js" ></script>
    <script type="text/javascript" src="../../../script/assembly/voicePlayer.js" ></script>
    <script type="text/javascript" src="../../../script/plug-in/base64.js" ></script>
    <script type="text/javascript" src="../../../script/common/common.js" ></script>
    <script src="https://code.responsivevoice.org/responsivevoice.js"></script>
    <script type="text/javascript">
        var sliderId;
        //男生、女生
        var sound_type = 'Male';
        var voice_type = 2;
        //语速
        var voice_speed = 0.01;
        //播放内容
        var voice_content;
        var nameWin;
        apiready = function() {
            voice_content = api.pageParam.voice_content;
            nameWin = api.pageParam.nameWin;
            openSlider();
        };
        /*
         *author:ws
         *function:打开语音调整进度条
         *date：20161124
         */
        function openSlider() {
            var params = {
                animation : true,
                orientation : 'horizontal',
                rect : {
                    x : 40,
                    y : api.winHeight - 81,
                    size : api.winWidth - 85
                },
                bubble : {
                    direction : 'top',
                    state : 'always',
                    w : 80,
                    h : 30,
                    size : 0,
                    color : 'rgba(0,0,0,0.9)',
                    bg : 'widget://res/slider/bubble.png',
                },
                handler : {
                    w : 10,
                    h : 8,
                    bg : 'widget://res/handler.png'
                },
                bar : {
                    h : 4,
                    bg : '#424242',
                    active : '#c6c6c6'
                },
                value : {
                    min : 50,
                    max : 150,
                    step : 1,
                    init : 100
                },
                fixedOn : api.frameName,
                fixed : false
            }
            slidingDevice.openSlidingDevice(params, function(is_true, data) {
                sliderId = data.id;
                voice_speed = data.value*0.01;
                if(voice_type == 1){
                    voicePlayer.stopRead();
                    startPlay();
                }
            })
        }
        /*
         *author:zhaoj
         *function:开始播放
         *date：20170921
         */
        function startPlay(){
            var new_voice_content = Base64.decode($api.trimAll(voice_content));
            var params = {
                readStr : new_voice_content,
                speed : voice_speed,
                volume : 60,
                voice : sound_type,
                rate : 16000
            }
            voicePlayer.startRead(params);
        }

        /*
         *author:ws
         *function:停止播放
         *date：20161124
         */
        function endPlay() {
            voicePlayer.stopRead();
            setTimeout(function() {
                api.closeFrame({
                    name : 'common_voiceplay_frame'
                });
            }, 300);
            api.execScript({
                name : nameWin,
                script : 'voicePlayer.changeVoiceType(2);'
            });
        }

         /*
         *author:ws
         *function:隐藏该页面
         *date：20161124
         */
        function frameHide() {
            api.setFrameAttr({// 隐藏内容层
                name : 'common_voiceplay_frame',
                hidden : true,
            });
        }
        
                /*
         *author:ws
         *function:选择男生女生
         *date：20161124
         */
        function toggleSelected(type,now_tyep) {
            sound_type = now_tyep;
            if (type == 1) {
                $api.removeCls($api.byId('women'), 'selected');
                $api.addCls($api.byId('man'), 'selected');
            } else {
                $api.removeCls($api.byId('man'), 'selected');
                $api.addCls($api.byId('women'), 'selected');
            }
            if(voice_type == 1){
                voicePlayer.stopRead();
                startPlay();
            }
        }
    </script>
</html>