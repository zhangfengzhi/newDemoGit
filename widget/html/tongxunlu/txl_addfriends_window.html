<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <!-- html5：在创建html时为了防止页面缩放等不兼容效果，要创建个viewport  -->
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
        <!-- 在IOS设备上，有时会将数字转为手机号，这里也要禁止下 -->
        <meta name="format-detection" content="telephone=no"/>
        <title>好友</title>
        <link rel="stylesheet" type="text/css" href="../../css/aui/aui.css" />
        <link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
        <style>
            .history-date {
                font-size: 12px;
            }
            #message-content {
                overflow-y: auto;
                display: none;
            }
        </style>
    </head>
    <body class="tongxunlu-common">
        <div id="wrap">
            <header class="aui-bar aui-bar-nav aui-bar-primary" id="aui-header">
                <div id="cloud" class="topbar activebar">
                    <div id="back" class="back" onclick="back();" tapmode="">
                        <i class="aui-iconfont aui-icon-left"></i>返回
                    </div>
                    <div class="mTitle" id="mTitle">
                        <div id="btn_title" class="btn-title">
                            <div id="btn_title_go" class="btn-l btn-top" onclick="changeBtnTitle(0);">
                                我添加的
                            </div>
                            <div id="btn_title_to" class="btn-r btn-top" onclick="changeBtnTitle(1);">
                                添加我的
                            </div>
                        </div>
                    </div>
                    <div class="win-menu">
                        <a  class="aui-iconfont aui-icon-code"  onclick="openScanner();"></a>
                    </div>
                </div>
                <div class="aui-searchbar-wrap demo" id="search">
                    <div class="aui-searchbar aui-border-radius" tapmode onclick="commonDoSearch();">
                        <i class="aui-iconfont aui-icon-search"></i>
                        <div class="aui-searchbar-text">
                            请输入搜索内容
                        </div>
                        <div class="aui-searchbar-input">
                            <form action="javascript:startSearch(1);">
                                <input oninput="commonRemoveExpression(this)" type="text" placeholder="按人名搜索,最多支持20个字符" id="search-input" maxlength ='20'>
                            </form>
                        </div>
                        <i class="aui-iconfont aui-icon-roundclosefill" tapmode onclick="commonClearInput()"></i>
                    </div>
                    <div class="aui-searchbar-cancel aui-text-info" tapmode onclick="commonCancelSearch()">
                        取消
                    </div>
                </div>
            </header>
            <div  class="aui-content aui-content-padded" id="message-content">
                <p class="aui-text-center history-date"></p>
            </div>
        </div>
        <script type="text/javascript" src="../../script/api.js"></script>
        <script type="text/javascript" src="../../script/plug-in/base64.js" ></script>
        <script type="text/javascript" src="../../script/common/common.js"></script>
    </body>
    <script type="text/javascript">
        var header_h;
        var add_from_html;
        var is_fir_add = 0;
        apiready = function() {
        	commonSetTheme({"level":2,"type":0});
            header_h = api.pageParam.header_h;
            add_from_html = api.pageParam.com_param;
            if ( isEmptyString (api.pageParam.mode_type)) {
                initFrameGroup(0);
            } else {
                initFrameGroup(1);
            }
            commonBackForAndroid();
            //安卓关闭
            commonIosAuiHeader();
            //定位header位置，留出上面电池等空隙，苹果需要
        };
        /**
         * 返回应用页面
         * 周枫
         * 2015.10.11
         */
        function back() {
            var is_change = parseInt($api.getStorage('friend_is_change'));
            if (is_change == 1) {
                commonExecScript('root', 'txl_index', 'loadData();', 1);
            }
            api.closeWin();
        }

        /**
         * 切换按钮
         * 周枫
         * 2016.1.21
         */
        function changeBtnTitle(btn_type) {
            //如果当前微课，不需要更新
            var $btn_title = $api.byId('btn_title');
            var $btn_title_all = $api.domAll($btn_title, 'div');
            for (var j = 0; j < $btn_title_all.length; j++) {
                $api.removeCls($btn_title_all[j], 'btn-top-active');
            }
            //定义切换页面样式json
            var rect_json = {};
            if (btn_type == 0) {
                $api.addCls($api.byId('btn_title_go'), 'btn-top-active');
                $api.addCls($api.byId('btn_title'), 't_display_b');
                $api.removeCls($api.byId('back'), 't_display_n');
                rect_json['x'] = 0;
                rect_json['y'] = header_h + 94;
                rect_json['w'] = api.winWidth;
                rect_json['h'] = api.winHeight - header_h - 94;
            } else {
                if (is_fir_add != 0) {
                    commonExecScript('txl_addfriends_window', 'txl_addfriendsgo_frame', 'commonCloseNavigationBar();', 1);
                }
                $api.addCls($api.byId('btn_title_to'), 'btn-top-active');
                $api.removeCls($api.byId('btn_title'), 't_display_b');
                $api.removeCls($api.byId('back'), 't_display_n');
                add_from_html = '';
                rect_json['x'] = 0;
                rect_json['y'] = header_h;
                rect_json['w'] = api.winWidth;
                rect_json['h'] = api.winHeight - header_h;
            }
            api.setFrameGroupAttr({
                name : 'friends_group',
                rect : rect_json
            });
            api.setFrameGroupIndex({
                name : 'friends_group',
                index : btn_type,
                scroll : true
            });
        }

        function initFrameGroup(open_index) {
            api.openFrameGroup({
                name : 'friends_group',
                scrollEnabled : false,
                rect : {
                    'x' : 0,
                    'y' : header_h + 94,
                    'w' : 'auto',
                    'h' : api.winHeight - header_h - 94
                },
                index : open_index,
                //预加载
                preload : 0,
                scrollToTop : true,
                bounces : true,
                frames : [{
                    name : 'txl_addfriendsgo_frame',
                    scrollToTop : true,
                    allowEdit : true,
                    url : 'txl_addfriendsgo_frame.html',
                    pageParam : {
                        header_h : header_h,
                        add_from_html : add_from_html
                    },
                    vScrollBarEnabled : true,
                    hScrollBarEnabled : false,
                    //页面是否弹动 为了下拉刷新使用
                    bounces : true
                }, {
                    name : 'txl_addfriendsto_frame',
                    scrollToTop : true,
                    allowEdit : true,
                    url : 'txl_addfriendsto_frame.html',
                    pageParam : {
                        header_h : header_h
                    },
                    vScrollBarEnabled : true,
                    hScrollBarEnabled : false,
                    //页面是否弹动 为了下拉刷新使用
                    bounces : true
                }]
            }, function(ret, err) {
                var btn_index = ret.index;
                switch(btn_index) {
                    case 0:
                        if (is_fir_add != 0) {
                            commonExecScript('txl_addfriends_window', 'txl_addfriendsgo_frame', 'openNavigationBarAddFriend();', 1);
                        } else {
                            changeBtnTitle(0);
                        }
                        break;
                    case 1:
                        if (is_fir_add != 0) {
                            commonExecScript('txl_addfriends_window', 'txl_addfriendsto_frame', 'initData();', 1);
                        } else {
                            changeBtnTitle(1);
                        }
                        break;
                }
                is_fir_add++;
            });
        }

        /**
         * 打开扫一扫页面
         * 周枫
         * 2016.1.22
         */
        function openSysWindow() {
            api.openWin({
                name : 'sys_index_window',
                url : '../yingyong/sys_index_window.html',
                bounces : false,
                delay : 0,
                scrollToTop : true,
                allowEdit : true,
                slidBackEnabled : false,
                scaleEnabled : false,
                animation : {
                    type : "reveal", //动画类型（详见动画类型常量）
                    subType : "from_right", //动画子类型（详见动画子类型常量）
                    duration : 300
                },
                pageParam : {
                    'targetId' : target_id,
                    'old_msg_id' : parseInt(old_msg_id),
                    'conver_type' : conver_type,
                    'person_name' : person_name,
                    'header_h' : header_h,
                    'conver_type' : conver_type,
                    'h_from' : h_from,
                    'avatar_url' : avatar_url
                }
            });
        }
        /*
        *author:zhaoj
        *function:开始搜索
        *date：20161220
        */
        function startSearch(type) {
            commonSearch(type, function(data) {
                commonExecScript(api.winName,'txl_addfriendsgo_frame','setKeyword("' + data + '");',1);
            })
        }

		function openScanner() {
//			if (api.uiMode == 'pad') {
//				api.execScript({
//					name : 'root',
//					script : 'openScanner();'
//				});
//			} else {
				api.execScript({
					name : 'root',
					script : 'openSysPhone();'
				});
//			}
		}
	</script>
</html>