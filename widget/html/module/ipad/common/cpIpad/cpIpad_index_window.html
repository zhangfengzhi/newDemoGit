<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<!-- html5：在创建html时为了防止页面缩放等不兼容效果，要创建个viewport  -->
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<!-- 在IOS设备上，有时会将数字转为手机号，这里也要禁止下 -->
		<meta name="format-detection" content="telephone=no"/>
		<title>菜单</title>
		<link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../../../../css/module/ipad/left-right-layout.css"/>
		<link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
		<style>
			.history-date {
				font-size: 12px;
			}
			#message-content {
				overflow-y: auto;
				display: none;
			}
			
			
			.t_display_n {
				display: none;
			}
			.t_display_b {
				display: block;
			}
			.aui-icon-add{padding-right:5px;}
			.win-right{width:55%;}
		</style>
	</head>
	<body class="left-layout-body common-ipad-cpIpadstu">
		<div id="wrap">
			<header class="aui-bar aui-bar-nav aui-bar-primary" id="aui-header">
				<div id="cloud" class="topbar activebar">
					<div id="back" class="back" onclick="back();" tapmode="">
						<i class="aui-iconfont aui-icon-left"></i>返回
					</div>
					<div class="mTitle" id="mTitle">
						校园食谱
					</div>
					<div class="win-menu">
						<a id='menu' style="display: none;" class="aui-iconfont aui-icon-add"  onclick="openAddCpFrame('cpIpad','cpIpad_add_frame');"></a>
					</div>
				</div>
			</header>
			<div  class="aui-content aui-content-padded" id="message-content">
				<p class="aui-text-center history-date"></p>
			</div>
		</div>
		<div id="j-right" class="win-right cp-right fr"></div>
	</body>
	<script type="text/javascript" src="../../../../../script/api.js"></script>
	<script type="text/javascript" src="../../../../../script/plug-in/base64.js" ></script>
	<script type="text/javascript" src="../../../../../script/common/common.js"></script>
	<script type="text/javascript" src="../../../../../script/common/six_common.js"></script>
	<script type="text/javascript" src="../../../../../script/assembly/tongjiData.js"></script>
	<script type="text/javascript">

		var header_h;//顶部header高度
		var back_type = 'index';
		var is_xxgly;//是否为学校管理员
		var register_id=0;//注册号
		var school_id;//学校id
		apiready = function() {
			commonSetTheme({"level":5,"type":0});
			//定位header位置，留出上面电池等空隙，苹果需要
			var header = $api.byId('aui-header');
			$api.fixStatusBar(header);
			header_h = api.pageParam.header_h;
			school_id = api.pageParam.school_id;
			judgeRoles(function(flag){
				if(flag && isEmptyString(school_id)){
					isAddDisplay(true);
				}
			});
			
			var frame_w = Math.floor(api.winWidth*0.45);
			var pageParamJson = {school_id:school_id,w:frame_w,header_h:header_h};
			commonOpenFrame('cpIpad_index_frame', 'cpIpad_index_frame.html', header_h, true, false, '#efeff4', pageParamJson)
//			openCommonIndexFrame('cpIpad_index_frame',0,'',school_id);
			//安卓关闭
			commonBackForAndroid();
			commonOpenTjData($api.getStorage("identity")+'_'+api.winName);//记录统计
		};
		/**
		 * 返回应用页面
		 * 周枫
		 * 2015.10.11
		 */
		function back() {
			switch(back_type) {
				case 'index':
					commonCloseTjData($api.getStorage("identity")+'_'+api.winName);//记录统计
					api.closeWin();
					reBackType('index');
					break;
				case 'content':
					commonExecScript('cpIpad_index_window','cpIpad_index_frame','isShowBoxShow(0);',1);//隐藏虚线
					api.closeFrame({
						name : 'cpIpad_content_frame'
					});
					reBackType('index');
					break;
				case 'add':
					api.closeFrame({
						name : 'cpIpad_add_frame'
					});
					reBackType('index');
					//两种情况,如果content页面打开了,则reBackType('content'),没打开，直接reBackType('index')
					break;	
				case 'picture_sel':
					commonExecScript('cpIpad_index_window','cpIpad_add_frame','closePicture();',1);
					reBackType('add');  
					break;
				case 'open_picture':
					reBackType('add');
					break;
				case 'picture_detail':
					reBackType('content');
					break;
			}
		}
		/**
		 * 重置从哪个页面退出，是新闻资讯内容页面还是新闻资讯列表页面
		 * 周枫
		 * 2015.10.14
		 */
		function reBackType(type) {
			switch(type) {
				//如果新闻资讯列表页面退出
				case 'index':
					$api.html($api.byId('mTitle'), "校园食谱");
					if(is_xxgly && isEmptyString(school_id)){
						isAddDisplay(true);
					}
					back_type = 'index';
					break;
				//如果新闻资讯内容页面退出
				case 'content':
					$api.html($api.byId('mTitle'), "校园食谱");
					if(is_xxgly && isEmptyString(school_id)){
						isAddDisplay(true);
					}
					back_type = 'content';
					break;
				//如果新闻资讯内容页面退出
				case 'add':
					if(is_xxgly && isEmptyString(school_id)){
						isAddDisplay(true);
					}
					back_type = 'add';
					break;
				case 'picture_sel':
					if(is_xxgly && isEmptyString(school_id)){
						isAddDisplay(true);
					}
					back_type = 'picture_sel';
					break;
				//如果打开图片退出
				case 'open_picture':
					back_type = 'open_picture';
					break;
				case 'picture_detail':
					back_type = 'picture_detail';
					break;
			}
		}
		/**
		 * 添加食谱
		 * zfz
		 * 20171023
		 */
		function openAddCpFrame(){
			reBackType('add');
			var pageParamJson = {register_id:register_id,header_h:header_h};
			commonOpenFrame('cpIpad_add_frame', 'cpIpad_add_frame.html', 0, true, false, 'rgba(0,0,0,0)', pageParamJson)
			
		}
	</script>
</html>