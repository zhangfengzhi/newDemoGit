<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no"/>
    <title>检测</title>
    <link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
    <link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
    <style>
    	.axis-body .top-content .right{color:#fff;padding-left:0;width:120px;height:35px;line-height:35px;text-align:center;top:25px;}
    	.zsd-content{width:280px;max-width:280px;overflow-x:auto;height:100%;position: fixed;top:0;left:0;padding:80px 0 20px 20px;}
    	.zsd-content .main{height:100%;border:1px solid #e0e0e0;max-height:100%;overflow-y: auto;color:#3D4245;background:#fff;}
    	.zsd-content .main .parent{border-bottom:1px solid #e0e0e0;}
    	.zsd-content .main .parent .name{min-height:50px;line-height:50px;padding:10px 0 10px 45px;position: relative;}
    	.fold{position:absolute;width:40px;height:50px;left:0;top:0;}
    	.zsd-content .main .parent .down{background:url(../../../../../image/fun-module/ipad/zuoye/down.png) center center no-repeat;}
    	.zsd-content .main .parent .up{background:url(../../../../../image/fun-module/ipad/zuoye/up.png) center center no-repeat;}
    	.zsd-content .main .parent img{position:absolute;right:10px;top:14px;width:14px;}
    	.opacity5{opacity:0.2;}
    	.zsd-content .main .parent .child li{min-height:50px;line-height:50px;padding:10px 0 10px 45px;position: relative;}
    	.zsd-content .main .parent .child li.active{color:#209BFF;}
    	.zsd-content .main .parent .name .location,.zsd-content .main .parent .child li .location{position:absolute;width:40px;height:50px;right:0;top:0;background:url('../../../../../image/fun-module/ipad/zuoye/location.png') center center no-repeat;background-size:14px auto;}
    	.zsd-content .main .parent .name .location.opacity,.zsd-content .main .parent .child li .location.opacity{opacity:0.1;}
    	.zsd-content .main .parent .name.active{color:#209BFF;}
    	.time-axis{margin:70px 0 0 280px;padding:10px 20px 0 20px;}
    	.time-axis .title3{padding:5px 0 20px 40px;font-size:20px;color:#000;font-weight:bold;}
    	.time-axis .title3.my{background:url(../../../../../image/fun-module/ipad/zuoye/title_bg.png) 0 0 no-repeat;background-size:35px auto;}
    	.time-axis .title3.jp{background:url(../../../../../image/fun-module/ipad/zuoye/title_bg.png) 0 -66px no-repeat;background-size:35px auto;}
    	.time-axis-body{background:#fff;padding:0;}
		.time-axis-zy{width:50%;float:left;height:185px;margin-bottom:20px;padding-right:20px;}
    	.time-axis-zy .zy-content{position:relative;border:1px solid #e0e0e0;height:100%;}
    	.time-axis-zy .zy-content .left{position:absolute;left:12px;bottom:0;width:128px;height:100%;background:url(../../../../../image/fun-module/ipad/zuoye/zy-list.png) center 13px no-repeat;background-size:110% auto;}
    	.time-axis-zy .zy-content .right{position:relative;height:100%;margin:0 20px 0 160px;padding:20px 0;}
    	.time-axis-zy .zy-content .right .zy-name{padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}
    	.time-axis-zy .zy-content .right .zy-name span{display:inline-block;max-width:90%;}
    	.time-axis-zy .zy-content .right .time{position:relative;color:#777;font-size:16px;}
    	.time-axis-zy .zy-content .right .time div{padding-top:12px;}
    	.time-axis-zy .zy-content .bottom{position:absolute;width:100%;left:0;height:50px;bottom:0;line-height:30px;padding:9px 20px;border-top:1px solid #e0e0e0;}
    	.time-axis-zy .zy-content .bottom .btn{height:100%;}
    	.time-axis-zy .zy-content .bottom .btn span{display:inline-block;width:100%;height:100%;border-radius:4px;text-align:center;color:#fff;}
    	.public,.tongji{width:23%;}
    	.share,.delete,.piyue{width:18%;}
    	.piyue{padding:0 4px 0 8px;}
    	.share{padding:0 4px;}
    	.delete{padding:0 8px 0 4px;}
    	.time-axis-zy .zy-content .bottom .tongji span{background:#03A203 !important;}
    	.delete span{ background:#F67362 !important;}
    	.time-axis-zy .zy-content .tip{position:absolute;width:55px;height:55px;top:0;right:0;background:url(../../../../../image/fun-module/iphone/zuoye/no-xiafa.png) top repeat-x;background-size:100% 100%;}
    	.time-axis-zy .zy-content .jp{background:url(../../../../../image/fun-module/iphone/daoxueJy/jp-king.png) top repeat-x;background-size:100% 100%;}
    	.zhehang{line-height:30px;word-break: break-all;width:80%;}
    </style>
</head>
<body class="axis-body common-ipad-zuoyeIpad-tea">
	<div id="j_top" class="top-content">
		<div id="j_version_textbook" class="left fl ml20"></div>
		<div class="right" onclick="openStuGroupWin();">学生分组</div>
	</div>
	<div id="msg_top_all" style="height:0px; overflow:hidden"></div>
	<div class="zsd-content fl">
		<div id="zsd_body" class="main">
<!--			<div class="parent">
				<div class="name">
					<div id="j_parent_1" class="fold down" onclick="foldOrUnfold('j_parent_1',1)">&nbsp;</div>
					第一章节
					<div class="location opacity">&nbsp;</div>
				</div>
				<ul class="child aui-hide" id="j_child_1">
					<li>子节点1<div class="location opacity">&nbsp;</div></li>
					<li>子节点1<div class="location">&nbsp;</div></li>
				</ul>
			</div>-->
		</div>
		<script type="text/html" id="zsd_script">
			<%if(section_list.length == 0){%>
				<div class="no-data">暂无知识点</div>
			<%}else{%>
				<%for(var i = 0; i < section_list.length; i++){%>
					<div class="parent">
						<%if(!section_list[i].is_select){%>
							<div class="name" 
						<%}else{%>
							<div class="name active" 
						<%}%>onclick='setStructure(<%=section_list[i].structure_id%>,"<%=section_list[i].structure_name%>",1,this)'>
							<%if(section_list[i].structure_list.length > 0){%>
								<div id="j_parent_<%=section_list[i].structure_id%>" class="fold down" onclick="foldOrUnfold(<%=section_list[i].structure_id%>,event,1)">&nbsp;</div>
							<%}%>
							<div class="zhehang"><%=section_list[i].structure_name%></div>
							<div onclick='getCourseId(this,<%=section_list[i].structure_id%>,"<%=section_list[i].structure_name%>",event);' <%if(!section_list[i].is_select){%> class="location opacity"<%}else{%>class="location j_opacity"<%}%>>&nbsp;</div>
						</div>
						<%if(section_list[i].structure_list.length > 0){%>
							<ul class="child aui-hide" id="j_child_<%=section_list[i].structure_id%>">
								<%for(var j = 0; j < section_list[i].structure_list.length; j++){%>
									<%if(!section_list[i].structure_list[j].is_select){%>
										<li 
									<%}else{%>
										<li class="active" 
									<%}%>onclick="setStructure(<%=section_list[i].structure_list[j].structure_id%>,'<%=section_list[i].structure_list[j].structure_name%>',1,this)">
									<div class="zhehang"><%=section_list[i].structure_list[j].structure_name%></div>
									<div onclick='getCourseId(this,<%=section_list[i].structure_list[j].structure_id%>,"<%=section_list[i].structure_list[j].structure_name%>",event);' <%if(!section_list[i].structure_list[j].is_select){%> class="location opacity"<%}else{%>class="location j_opacity"<%}%>>&nbsp;</div></li>
								<%}%>
							</ul>
						<%}%>
					</div>
				<%}%>
			<%}%>
		</script>
	</div>
	<div id="j_list" class="time-axis aui-hide">
		<div class="title3 my">我的检测</div>
		<div id="my_body" class="time-axis-body clearfix">
			<!--<div class="time-axis-zy clearfix">
				<div class="zy-content">
					<div class="left">&nbsp;</div>
					<div class="right">
						<div class="zy-name">汉语拼音1 aoe</div>
						<div class="time">
							<div class="pub-time">发布时间:2017-07-29 10:50</div>
							<div class="pub-class ellipsis">发布范围:2015级2班，2016级三班，2017级4班，2015级2班，2016级三班，2017级4班</div>
						</div>
						<div class="zy-tip ypy"></div>
					</div>
					<div class="bottom">
						<div class="btn tongji fr"><span>查看统计</span></div>
						<div class="btn delete fr"><span>删除</span></div>
						<div class="btn share fr"><span>共享</span></div>
						<div class="btn piyue fr"><span>批阅</span></div>
						<div class="btn public fr"><span>发布</span></div>
					</div>
					<div class="tip">&nbsp;</div>
				</div>
			</div>-->
		</div>
		<script type="text/html" id="my_script">
			<%if(list.length == 0){%>
				<div class="no-data">暂无检测</div>
			<%}else{%>
				<%for(var i = 0; i < list.length; i++){%>
					<div class="time-axis-zy clearfix" onclick="openCommonWin('zuoyeIpad_detail_window','<%=list[i].zy_name_base64%>',<%=list[i].zy_id%>,'',1,1,event);">
						<div class="zy-content">
							<div class="left">&nbsp;</div>
							<div class="right">
								<div class="zy-name ellipsis"><%=list[i].zy_name%></div>
								<div class="time">
									<div class="pub-time ellipsis">创建时间:<%=list[i].create_time%>
</div>
									<div class="pub-class ellipsis">发布范围:<%=list[i].xiafa_object_name%></div>
								</div>
							</div>
							<div class="bottom">
								<%if(list[i].is_xiafa != 0){%>
								<div class="btn tongji fr" onclick="openCommonWin('zuoyeIpad_tj_window','<%=list[i].zy_name_base64%>',<%=list[i].zy_id%>,'','','',event);"><span>检测报告</span></div>
								<%}%>
								<div class="btn delete fr" onclick="deleteZyIpad(<%=list[i].zy_id%>,'<%=list[i].zy_name_base64%>',<%=list[i].id%>,event)"><span>删除</span></div>
								<div class="btn share fr" onclick="openCommonWin('zuoyeIpad_share_window','<%=list[i].zy_name_base64%>',<%=list[i].zy_id%>,1,'','',event);"><span>共享</span></div>
								<%if(list[i].is_xiafa != 0){%>
								<div class="btn piyue fr" onclick="openPiyueIpad('<%=list[i].zy_name_base64%>',<%=list[i].zy_id%>,'<%=list[i].tijiao_count%>','<%=list[i].zg_ti_count%>',event);"><span>批阅</span></div>
								<%}%>
								<%if(list[i].is_xiafa == 0){%>
									<div class="btn public fr" onclick="openPublishWin(<%=list[i].zy_id%>,'<%=list[i].zy_name_base64%>',<%=list[i].subject_id%>,event);"><span>发布</span></div>
								<%}else{%>
									<div class="btn public fr" onclick="cancelPublishZyIpad(<%=list[i].zy_id%>,'<%=list[i].zy_name_base64%>',event);"><span>取消发布</span></div>
								<%}%>
							</div>
							<%if(list[i].is_xiafa == 0){%>
								<div class="tip">&nbsp;</div>
							<%}%>
						</div>
					</div>
				<%}%>
			<%}%>
		</script>
		<div class="title3 jp">精品检测</div>
		<div id="jp_body" class="time-axis-body clearfix"></div>
		<script type="text/html" id="jp_script">
			<%if(list.length == 0){%>
				<div class="no-data">暂无精品检测</div>
			<%}else{%>
				<%for(var i = 0; i < list.length; i++){%>
					<div class="time-axis-zy clearfix" onclick="openCommonWin('zuoyeIpad_detail_window','<%=list[i].zy_name_base64%>',<%=list[i].zy_id%>,'',1,1,event);">
						<div class="zy-content">
							<div class="left">&nbsp;</div>
							<div class="right">
								<div class="zy-name ellipsis"><%=list[i].zy_name%></div>
								<div class="time">
									<div class="pub-time ellipsis">创建时间:<%=list[i].create_time%></div>
									<div class="pub-class ellipsis">上传教师:<%=list[i].person_name%>/<%=list[i].org_name%></div>
								</div>
							</div>
							<div class="bottom">
								<div class="btn tongji fr" onclick="openApplyFrame('<%=list[i].zy_name_base64%>',<%=list[i].zy_id%>,event);"><span>选用</span></div>
							</div>
							<div class="tip jp">&nbsp;</div>
						</div>
					</div>
				<%}%>
			<%}%>
		</script>
	</div>
</body>
<script type="text/javascript" src="../../../../../script/api.js"></script>
<script type="text/javascript" src="../../../../../script/base_config.js" ></script>
<script type="text/javascript" src="../../../../../script/plug-in/template.js" ></script>
<script type="text/javascript" src="../../../../../script/plug-in/base64.js" ></script>
<script type="text/javascript" src="../../../../../script/common/common.js" ></script>
<script type="text/javascript" src="../../../../../script/common/jszy_jy_common.js"></script>
<script type="text/javascript">
	var header_h;
	var share_org_type_array=[];//共享机构的级别标识数组
	var share_org_type;//共享机构的级别标识：0全国1本省2本市3本区4本校5群组
	var lobal_variable={};//全局变量json
	var zsd_json_data;//知识点数据
	apiready = function(){
		commonSetTheme({"level":5,"type":0});
		header_h = api.pageParam.header_h;
		lobal_variable.stage_id=0;//学段id
        lobal_variable.subject_id=0;//学科id
        lobal_variable.scheme_id=0;//版本id
        lobal_variable.volume_id=0;//教材id
        lobal_variable.structure_id=0;//知识点id
		BASE_URL_ACTION = $api.getStorage('BASE_URL_ACTION');
		initData();
		isShowFooterBtn(1);//显示下方按钮
	};
	/*
	*作者:zhaoj
	*功能:初始化函数
	*日期：20160920
	*/
	function initData(){
		showSelfProgress('加载中...')
		getSchemeProgress(function(book_flag,book_data){
			if(book_flag){
				lobal_variable.stage_id = book_data.stage_id;//学段id
				lobal_variable.subject_id = book_data.subject_id;//学科id
				lobal_variable.scheme_id = book_data.scheme_id;//版本id
				lobal_variable.volume_id = book_data.volume_id;//教材id
				lobal_variable.stage_name = book_data.stage_name;//学段名称
				lobal_variable.subject_name = book_data.subject_name;//学科名称
				lobal_variable.scheme_name = book_data.scheme_name;//版本名称
				lobal_variable.volume_name = book_data.volume_name;//教材名称
				setTextbook('',0);//显示设置教材
				getSectionAndStruc(function(zsd_flag,zsd_data){
					zsd_json_data = zsd_data;
					if(zsd_flag){
						if(zsd_data.section_list.length > 0){
							getTeachingProgress(function(prog_flag,prog_data){
								if(prog_flag){
									setStructure(prog_data.structure_id,prog_data.structure_name,0,-1);
								}else{
									setStructure(zsd_data.section_list[0].structure_id,zsd_data.section_list[0].structure_name,0,-1);
								}
								//渲染知识点数据到页面中
							});
						}else{
							api.hideProgress();
									commonAddOnceHtml('zsd_body','zsd_script',zsd_data);
								}
					}else{
						api.hideProgress();
						popToast(zsd_data);
					}
				});
			}else{
				api.hideProgress();
				popToast(book_data);
			}
		});
	}
	/*
	*author:zhaoj
	*function:设置知识点id和name
	*date：20171013
	*/
	function setStructure(id,name,type,self){
		if(type == 1 && self!=-1){
			$api.removeCls($api.dom($api.byId('zsd_body'), '.active'), 'active');
			$api.addCls(self, 'active');
		}
		lobal_variable.structure_id = id;
		lobal_variable.structure_name = name;
		if(type==0){
			var flag = false;//判断是否是定位到一级知识点
			for(var i = 0; i < zsd_json_data.section_list.length; i ++){
				if(zsd_json_data.section_list[i].structure_id == id){
					flag = true;
					zsd_json_data.section_list[i].is_select = 1;
				}else{
					zsd_json_data.section_list[i].is_select = 0;
				}
			}
			if(!flag){
				var select_par_structure_id = "";
				for(var i = 0; i < zsd_json_data.section_list.length; i ++){
					var data =  zsd_json_data.section_list[i];
					for(var j = 0; j < data.structure_list.length; j++){
						if(data.structure_list[j].structure_id == id){
							data.structure_list[j].is_select = 1;
							select_par_structure_id = data.structure_id;
						}else{
							data.structure_list[j].is_select = 0;
						}
					}
				}
			}
			commonAddOnceHtml('zsd_body','zsd_script',zsd_json_data);
			flag ? "":foldOrUnfold(select_par_structure_id,event,0);//如果定位在二级节点,展开第二级节点
		}
		changePackageId();
	}
	/*
	*author:zhaoj
	*function:取消发布检测
	*date：20160523
	*/
	function cancelPublishZy(zy_id){
		api.ajax({
			url : BASE_URL_ACTION + '/ypt/xx/cancelPublishZy',
			method : 'post',
			timeout : 0,
			dataType : 'json',
			data : {
				values : {
					"random_num" : creatRandomNum(),
					"zy_id" : zy_id,
					"zy_type" : 1
				}
			},
			headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
}
		}, function(ret, err) {
			if (err) {
				popToast('取消发布失败');
			} else {
				if(ret.success){
					updataList();
				}else{
					popToast('取消发布失败');
				}
			}
		});
	}
	/*
	*author:zhaoj
	*function:删除检测
	*date：20160523
	*/
	function deleteZy(zy_id,ids){
		showSelfProgress('删除中...');
		api.ajax({
			url : BASE_URL_ACTION + '/ypt/space/course_package/_delete_resource_by_ids',
			method : 'post',
			timeout : 30,
			dataType : 'json',
			data : {
				values : {
					"random_num" : creatRandomNum(),
					"zy_id" : zy_id,
					"ids" : lobal_variable.ids,
					"res_type_id":lobal_variable.res_type_id,
				}
			},
			headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
}
		}, function(ret, err) {
			api.hideProgress();
			if (err) {
				popToast('删除失败');
			} else {
				if(ret.success){
					popToast('删除成功');
					updataList();
				}else{
					popToast('删除失败');
				}
			}
		});
	}
	/*
	*author:zhaoj
	*function:删除检测
	*date：20160920
	*/
	function collectZy(zy_id,type){
		var o_type;
		if(type == 5){
			showSelfProgress('收藏中...');
			o_type = 1;
		}else{
			showSelfProgress('取消收藏中...');
			o_type = 2;
		}
		api.ajax({
			url : BASE_URL_ACTION + '/xx/collectZy',
			method : 'get',
			timeout : 30,
			dataType : 'json',
			data : {
				values : {
					"random_num" : creatRandomNum(),
					"zy_id" : zy_id,
					"zy_type" : 1,
					"o_type" : o_type,
					"person_id" : $api.getStorage("person_id"),
					"identity_id" : $api.getStorage("identity")
				}
			},
			headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
}
		}, function(ret, err) {
			api.hideProgress();
			if (err) {
				type == 5 ? popToast('收藏失败') : popToast('取消收藏失败');
			} else {
				if(ret.success){
					popToast(ret.info);
					if(type == 6){
						updataList();
					}
				}else{
					popToast(ret.info);
				}
			}
		});
	}
	/*
	*作者:zhaoj
	*功能:取消共享检测
	*日期：20160921
	*/
	function shareZy(zy_id){
		showSelfProgress('取消共享中...');
	   	api.ajax({
			url : BASE_URL_ACTION + '/xx/shareZy',
			method : 'post',
			timeout : 30,
			dataType : 'json',
			data : {
				values : {
					"random_num" : creatRandomNum(),
					"zy_id" : zy_id,
					"o_type" : 2,
					"share_person_id" : $api.getStorage("person_id"),
				}
			},
			headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				api.hideProgress();
				if (err) {
					popToast('取消共享失败');
				} else {
					if(ret.success){
						popToast(ret.info);
						updataList();
					}else{
						popToast('取消共享失败');
					}
				}
		});
	}
	 /*
	*author:zhaoj
	*function:打开学段学科版本教材切换页面
	*date：20170911
	*/
    function openChangeFrame(){
    	commonExecScript('zuoyeIpad_index_window','','reBackType("change");',0);
    	commonOpenFrame('common_change_frame', 'widget://html/module/ipad/teacher/common/common_change_frame.html',0, false, false,"rgba(0,0,0,0)",{"lobal_variable":JSON.stringify(lobal_variable),"winName":api.winName,"frameName":api.frameName});//打开index页面
    }
     /*
	*author:zhaoj
	*function:显示设置教材
	*date：20170918
	*/
    function setTextbook(param,type){
    	if(type==1){
	    	var param = JSON.parse(Base64.decode(param));
	    	lobal_variable.stage_id = param.stage_id;
	    	lobal_variable.subject_id = param.subject_id;
	    	lobal_variable.scheme_id = param.scheme_id;
	    	lobal_variable.volume_id = param.volume_id;
	    	lobal_variable.stage_name = param.stage_name;
	    	lobal_variable.subject_name = param.subject_name;
	    	lobal_variable.scheme_name = param.scheme_name;
	    	lobal_variable.volume_name = param.volume_name;
	    }
		$api.html($api.byId('j_version_textbook'),lobal_variable.stage_name+'&nbsp;->&nbsp;'+lobal_variable.subject_name+'&nbsp;->&nbsp;'+lobal_variable.scheme_name+'&nbsp;->&nbsp;'+lobal_variable.volume_name+'<font class="plr5" onclick="openChangeFrame();">（点击可切换）</font>');
    	if(type==1){
    		commonExecScript('zuoyeIpad_index_window','','back();',0);
    		initData();
    	}
    }
    /*
	*author:zhaoj
	*function:获取当前教师任教的教材信息
	*date：20170401
	*/
	function getSchemeProgress(callback){
		api.ajax({
			url : BASE_URL_ACTION + '/ypt/space/course_package/get_scheme_progress?random_num='+creatRandomNum()+'&person_id='+$api.getStorage("person_id")+'&identity_id='+$api.getStorage('identity'),
			method : 'get',
			timeout : 0,
			dataType : 'json',
			headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				if(err){
					callback(false,'获取教材信息失败，请稍候重试');
				}else{
					if(ret.success){
						callback(true,ret);
					}else{
						api.hideProgress();
						openChangeFrame();
					}
				}
			});
	}
	/*
	*author:zhaoj
	*function:知识点展开或收起
	*date：20171013
	*/
	function foldOrUnfold(id,e,type){
		if($api.hasCls($api.byId('j_parent_'+id),'down')){
			$api.removeCls($api.byId('j_parent_'+id),'down');
			$api.addCls($api.byId('j_parent_'+id),'up');
			commonAddOrRemoveHideCss('j_child_'+id,1);
		}else{
			$api.removeCls($api.byId('j_parent_'+id),'up');
			$api.addCls($api.byId('j_parent_'+id),'down');
			commonAddOrRemoveHideCss('j_child_'+id,0);
		}
		type?e.stopPropagation():'';
	}
	/*
	*author:zhaoj
	*function:获取知识点接口
	*date：20170401
	*/
	function getSectionAndStruc(callback){
	    api.ajax({
	        url : BASE_URL_ACTION + '/ypt/bkCtl/getSectionAndStruc?random_num='+creatRandomNum()+'&volume_id='+lobal_variable.volume_id,
	        method : 'get',
	        timeout : 0,
	        dataType : 'json',
	        headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
	        }, function(ret, err) {
	            if(err){
	                callback(false,'获取知识点信息失败，请稍候重试');
	            }else{
	                if(ret.success){
	                    callback(true,ret);
	                }else{
	                    callback(false,'获取知识点信息失败，请稍候重试');
	                }
	            }
	        });
	}
	/*
	*author:zhaoj
	*function:获取教师教学进度接口
	*date：20170401
	*/
	function getTeachingProgress(callback){
	    api.ajax({
	        url : BASE_URL_ACTION + '/ypt/space/course_package/get_teaching_progress?random_num='+creatRandomNum()+'&scheme_id='+lobal_variable.scheme_id+'&volume_id='+lobal_variable.volume_id+'&subject_id='+lobal_variable.subject_id+'&stage_id='+lobal_variable.stage_id+'&person_id='+$api.getStorage("person_id"),
	        method : 'get',
	        timeout : 0,
	        dataType : 'json',
	        headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
	        }, function(ret, err) {
	            if(err){
	                callback(false,'');
	            }else{
	                if(ret.success){
	                    callback(true,ret);
	                }else{
	                    callback(false,'');
	                }
	            }
	        });
	}
	/*
	*author:zhaoj
	*function:更换课程表id
	*date：20170329
	*/
	function changePackageId(){
		getCoursepackageBySchemeidOrStructureid(lobal_variable.structure_id,function(package_flag,package_data){
			if(package_flag){
				if(package_data.list.length > 0){
					lobal_variable.package_id = package_data.list[0].id;
					getResType();
				}else{
					saveCoursePackage(lobal_variable.structure_id,lobal_variable.structure_name,function(cour_flag,cour_data){
						if(cour_flag){
							lobal_variable.package_id = cour_data.id;
							getResType();
						}else{
							popToast(cour_data);
						}
					});
				}
			}else{
				popToast(package_data);
			}
		});
	}
	/*
	*author:zhaoj
	*function:获取资源类型关系id
	*date：20170329
	*/
	function getResType(){
		getRestypeList(function(res_flag,res_data){
			if(res_flag){
				for(var i =0; i < res_data.list.length; i++){
					if(res_data.list[i].res_type == 11){
						lobal_variable.res_type_id = res_data.list[i].id;
					}
				}
				updataList();
			}else{
				popToast(res_data);
			}
		});
	}
	/*
	*author:zhaoj
	*function:获取课程包id
	*date：20170401
	*/
	function getCoursepackageBySchemeidOrStructureid(structure_id,callback){
	    api.ajax({
	        url : BASE_URL_ACTION + '/ypt/space/course_package/get_coursepackage_by_schemeid_or_structureid?random_num='+creatRandomNum()+'&scheme_id='+lobal_variable.scheme_id+'&volume_id='+lobal_variable.volume_id+'&subject_id='+lobal_variable.subject_id+'&stage_id='+lobal_variable.stage_id+'&person_id='+$api.getStorage("person_id")+'&page_num=1&page_size=1&structure_id='+structure_id,
	        method : 'get',
	        timeout : 0,
	        dataType : 'json',
	        headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
	        }, function(ret, err) {
	            if(err){
	                callback(false,'获取课程包失败，请稍候重试');
	            }else{
	                if(ret.success){
	                    callback(true,ret);
	                }else{
	                    callback(false,'获取课程包失败，请稍候重试');
	                }
	            }
	        });
	}
	/*
	*author:zhaoj
	*function:获取当前节点课程包id
	*date：20171013
	*/
	function getCourseId(self,structure_id,structure_name,e){
		getCoursepackageBySchemeidOrStructureid(structure_id,function(package_flag,package_data){
			if(package_flag){
				if(package_data.list.length > 0){
					package_id = package_data.list[0].id;
					save_teaching_progress(self,structure_id,package_id,e);
				}else{
					saveCoursePackage(structure_id,structure_name,function(cour_flag,cour_data){
						if(cour_flag){
							package_id = cour_data.id;
							save_teaching_progress(self,structure_id,package_id,e);
						}else{
							popToast(cour_data);
						}
					});
				}
			}else{
				popToast(package_data);
			}
		});
		e.stopPropagation();
	}
	/*
	*author:zhaoj
	*function:设置章节为进度
	*date：20171013
	*/
	function save_teaching_progress(self,structure_id,package_id,e){
		api.ajax({
			url : BASE_URL_ACTION + '/ypt/space/course_package/save_teaching_progress',
			method : 'post',
			timeout : 0,
			dataType : 'json',
			data : {
				values : {
					"random_num" : creatRandomNum(),
					"package_id" : package_id,
					"person_id" : $api.getStorage("person_id"),
					"scheme_id" : lobal_variable.scheme_id,
					"stage_id" : lobal_variable.stage_id,
					"structure_id" : structure_id,
					"subject_id" : lobal_variable.subject_id,
					"volume_id" : lobal_variable.volume_id
				}
			},
			headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
}
		}, function(ret, err) {
			if (err) {
				popToast('设置失败');
			} else {
				if(ret.success){
					popToast('设置成功，已将当前章节设置为进度');
					$api.addCls($api.dom($api.byId('zsd_body'), '.j_opacity'), 'opacity');
					$api.removeCls($api.dom($api.byId('zsd_body'), '.j_opacity'), 'j_opacity');
					$api.addCls(self, 'j_opacity');
					$api.removeCls(self, 'opacity');
					changePackageId();
				}else{
					popToast('设置失败');
				}
			}
		});
		e.stopPropagation();
	}
	/*
	*author:zhaoj
	*function:获取资源类型关系id
	*date：20170401
	*/
	function getRestypeList(callback){
	    api.ajax({
	        url : BASE_URL_ACTION + '/ypt/space/course_package/get_restype_list?random_num='+creatRandomNum()+'&package_id='+lobal_variable.package_id,
	        method : 'get',
	        timeout : 0,
	        dataType : 'json',
	        headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
	        }, function(ret, err) {
	            if(err){
	                callback(false,'获取资源类型关系失败，请稍候重试');
	            }else{
	                if(ret.success){
	                    callback(true,ret);
	                }else{
	                    callback(false,'获取资源类型关系失败，请稍候重试');
	                }
	            }
	        });
	}
	/*
	*author:zhaoj
	*function:更新列表
	*date：20170401
	*/
	function updataList(){
		getBoutiqueLeadList();
		getResList();
	}
	/*
	*author:zhaoj
	*function:获取精品检测案列表数据
	*date：20170401
	*/
	function getBoutiqueLeadList(){
	    api.ajax({
	        url : BASE_URL_ACTION + '/ypt/space/lead/get_boutique_lead_list?random_num='+creatRandomNum()+'&keyword=&page_num=1&business_type=1&page_size=10&structure_id='+lobal_variable.structure_id+'&org_id='+$api.getStorage("school_id") +'&org_type=104',
	        method : 'get',
	        timeout : 0,
	        dataType : 'json',
	        headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
	        }, function(ret, err) {
	            api.hideProgress();
	            if(err){
	                popToast('获取检测列表失败，请稍候重试');
	            }else{
	                if(ret.success){
	                	for(var i = 0; i < ret.list.length; i++){
	                        ret.list[i].zy_name_base64 = Base64.encode(ret.list[i].zy_name);
	                    }
	                    commonAddOnceHtml('jp_body','jp_script',ret);
	                }else{
	                    popToast('获取检测列表失败，请稍候重试');
	                }
	            }
	            //通知顶部下拉刷新数据加载完毕，组件会恢复到默认状态
	            api.refreshHeaderLoadDone();
	        });
	}
	/*
	*author:zhaoj
	*function:获取资源类型关系id
	*date：20170401
	*/
	function getResList(){
	    api.ajax({
	        url : BASE_URL_ACTION + '/ypt/space/course_package/get_res_list?random_num='+creatRandomNum()+'&res_type_id='+lobal_variable.res_type_id+'&package_id='+lobal_variable.package_id+'&page_num=1&page_size=2000',
	        method : 'get',
	        timeout : 0,
	        dataType : 'json',
	        headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
	        }, function(ret, err) {
	            api.hideProgress();
	            if(err){
	                popToast('获取检测列表失败，请稍候重试');
	            }else{
	                if(ret.success){
	                    for(var i = 0; i < ret.list.length; i++){
	                        ret.list[i].zy_name_base64 = Base64.encode(ret.list[i].zy_name);
	                    }
	                    commonAddOnceHtml('my_body','my_script',ret);
	                }else{
	                    popToast('获取检测列表失败，请稍候重试');
	                }
	                commonAddOrRemoveHideCss('j_list',1);
	            }
	            //通知顶部下拉刷新数据加载完毕，组件会恢复到默认状态
	            api.refreshHeaderLoadDone();
	        });
	}
	/*
	*author:zhaoj
	*function:取消发布
	*date：20171014
	*/
	function cancelPublishZyIpad(zy_id,zy_name_base64,e){
		var name = Base64.decode(zy_name_base64);
		popConfirm(zy_id,3,'确定取消检测“'+name+'”的发布吗？');
		e.stopPropagation();
	}
	/*
	*author:zhaoj
	*function:取消发布
	*date：20171014
	*/
	function deleteZyIpad(zy_id,zy_name_base64,id,e){
		lobal_variable.ids = id;
		var name = Base64.decode(zy_name_base64);
		popConfirm(zy_id,4,'确定删除“'+name+'”检测吗？');
		e.stopPropagation();
	}
	/*
	*author:zhaoj
	*function:打开批阅
	*date：20171014
	*/
	function openPiyueIpad(zy_name_base64,zy_id,tijiao_count,zg_ti_count,e){
		if(tijiao_count == 0){
			popToast('当前检测还没有学生提交，暂时不能批阅');
		}else if(zg_ti_count == 0){
			popToast('当前检测没有主观题，不能批阅');
		}else{
			openCommonWin('zuoyeIpad_piyue_window',zy_name_base64,zy_id,'','','',e);	
		}
		e.stopPropagation();
	}
	/*
	*author:zhaoj
	*function:打开选用页面
	*date：20171014
	*/
	function openApplyFrame(zy_name_base64,zy_id,e){
		commonExecScript('zuoyeIpad_index_window','','reBackType("apply");',0);//切换index列表数据
		var header_h = api.pageParam.header_h;//顶部高度
		pageParamJson={"header_h":header_h,"zy_name_base64":zy_name_base64,"zy_id":zy_id,"lobal_variable":Base64.encode(JSON.stringify(lobal_variable))};//打开frame页面json数据
		//打开frame页面
		commonOpenFrame("zuoyeIpad_apply_frame","zuoyeIpad_apply_frame.html",0,false,false,"rgba(0,0,0,0)",pageParamJson);
		e.stopPropagation();
	}
	/*
	*author:zhaoj
	*function:学生分组
	*date：20171014
	*/
	function openStuGroupWin(){
		commonExecScript('zuoyeIpad_index_window','','openStuGroupWin();',0);
	}
	/*
 * author:zhaoj
 * function:创建课程包
 * data:20170408
 */
function saveCoursePackage(structure_id,structure_name,callback){
	api.ajax({
		url : BASE_URL_ACTION + '/ypt/space/course_package/save_course_package',
		method : 'post',
		timeout : 0,
		dataType : 'json',
		data : {
			values : {
				"random_num" : creatRandomNum(),
				"course_hour" : 1,
				"course_type" : "讲授课",
				"identity_id":$api.getStorage("identity"),
				"person_id": $api.getStorage("person_id"),
				"person_name": $api.getStorage("person_name"),
                "stage_id" : lobal_variable.stage_id,
                "scheme_id" : lobal_variable.scheme_id,
                "scheme_name" : lobal_variable.scheme_name,
                "subject_id" : lobal_variable.subject_id,
                "volume_id":lobal_variable.volume_id,
                "structure_id":structure_id,
                "structure_name":structure_name,
                "title":lobal_variable.structure_name
			}
		},
		headers : {
'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
}
		}, function(ret, err) {
			if(err){
				callback(false,'获取导学失败，请稍候重试');
			}else{
				if(ret.success){
					callback(true,ret);
				}else{
					callback(false,'获取导学失败，请稍候重试');
				}
			}
		});
}
</script>
</html>