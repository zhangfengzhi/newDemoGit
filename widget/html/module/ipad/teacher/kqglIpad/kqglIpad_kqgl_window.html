<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<!-- html5：在创建html时为了防止页面缩放等不兼容效果，要创建个viewport  -->
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<!-- 在IOS设备上，有时会将数字转为手机号，这里也要禁止下 -->
		<meta name="format-detection" content="telephone=no"/>
		<title>考勤管理</title>
		<link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
		<link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
		<style>
			.history-date {
				font-size: 12px;
			}
			#message-content {
				overflow-y: auto;
				display: none;
			}
			.t_display_n {
				display: none;
			}
			.t_display_b {
				display: block;
			}
			.tag-title {
				height:65px;
				line-height: 65px;
				background: #ffffff;
			}
			.tag-title div {
				width: 50%;
				text-align: center;
				color: #62656A;
			}
			.fl {
				float: left;
			}
			.fr {
				float: right;
			}
			.nav{display:block;}
			.nav li{display:inline-block;float:left;}
			.nav li span{display:inline-block;color:#262626;}
			.nav li span.active{height:65px;border-bottom:2px solid #f00; color:#f00;}
			.plr20{padding:0 20px;}
			.nav_bar{height:65px;}
		</style>
	</head>
	<body class="common-ipad-kaoqinIpad-tea">
		<div id="wrap">
			<header class="aui-bar aui-bar-nav aui-bar-primary" id="aui-header">
				<div id="cloud" class="topbar activebar">
					<div id="back" class="back" onclick="back();" tapmode="">
						<i class="aui-iconfont aui-icon-left"></i>返回
					</div>
					<div  class="mTitle" id="mTitle">
						<div id="btn_title" class="btn-title">
							<div id="j_btn_2" class="btn-l btn-top-active btn-top" onclick="changeBtnTitle(this,2);">
								考勤撤销
							</div>
							<div id="j_btn_1" class="btn-r btn-top" onclick="changeBtnTitle(this,1);">
								在岗统计
							</div>
						</div>
					</div>
					<div class="win-menu">
						<!--我的考勤——考勤汇总菜单-->
						<!--	<a id='menu1' style="display: none;" class="aui-iconfont aui-icon-menu back"  onclick="openMenuFrame();"></a>
						<a id='menu2' style="display: none;" class="aui-iconfont aui-icon-fold back"  onclick="closeMenuFrame();"></a>-->
					</div>
				</div>	
			</header>
			<div class="nav_bar clearfix">
				<div class="tag-title fl">
					<ul class="nav clearfix">
						<li class="plr20 " onclick="openQjFrame();">
							<span id="qingjia" class="active">请假撤销</span>
						</li>
						<li class="plr20" onclick="openGcFrame();">
							<span id="gongchu">公出撤销</span>
						</li>
					</ul>
				</div>
				<div class="search-ipad fr">
					<div class="search-body">
						<input id="search-input" placeholder="请输入关键字" oninput='commonShowOrHideClear(this.value.length,this);' type="text" maxlength="20" />
						<div id="j_search_clear" class="search-close aui-hide" onclick="commonIpadClearInput();">&nbsp;</div>
						<div class="search-btn" onclick="startSearch(1);">&nbsp;</div>
					</div>
				</div>
			</div>
			<div  class="aui-content aui-content-padded" id="message-content">
				<p class="aui-text-center history-date"></p>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../../../../script/api.js"></script>
	<script type="text/javascript" src="../../../../../script/base_config.js" ></script>
	<script type="text/javascript" src="../../../../../script/common/kaoqinIpad_common.js"></script>
	<script type="text/javascript" src="../../../../../script/common/common.js"></script>
	<script type="text/javascript" src="../../../../../script/plug-in/base64.js" ></script>
	<script type="text/javascript" src="../../../../../script/assembly/tongjiData.js"></script>
	<script type="text/javascript">
		//顶部header高度
		var header_h;
		var back_type = "index";
		//返回参数
		var BASE_URL_ACTION;
		var qj_count = 0;
		var wc_count = 0;
		apiready = function() {
			commonSetTheme({"level":5,"type":0});
			//定位header位置，留出上面电池等空隙，苹果需要
			var header = $api.byId('aui-header');
			header_h = api.pageParam.header_h;
			BASE_URL_ACTION = $api.getStorage('BASE_URL_ACTION');
			//打开我的考勤请假申请页面
			getCheckLeaveCountByType(2, function(flag, data) {
				qj_count = data.qj_count;
				wc_count = data.wc_count;
				if (qj_count == 0 && wc_count > 0) {
					openFrame('kqglIpad_kqhzIndexList_frame', function(flag) {
						openGcFrame();
					});
				} else {
					openFrame('kqglIpad_kqhzIndexList_frame', function(flag) {
						openQjFrame();
					});
				}
				setTagName(data.qj_count, data.wc_count);
			})
			//显示menu
			$api.css($api.byId('menu1'), 'display:block;');
			$api.fixStatusBar(header);
			//安卓关闭
			commonBackForAndroid();
			commonOpenTjData($api.getStorage("identity")+'_'+api.winName);//记录统计
		};
		function changeBtnTitle(self, num) {
			if (num == 1) {
				$api.removeCls($api.byId('j_btn_2'), 'btn-top-active');
				$api.addCls($api.byId('j_btn_1'), 'btn-top-active');
				commonCloseFrame('kqglIpad_kqhzIndexList_frame'); 
				commonOpenFrame('kqglIpad_zgtj_frame', 'kqglIpad_zgtj_frame.html', header_h, false, true, '#ffffff', {header_h : header_h});
			} else {
				$api.removeCls($api.byId('j_btn_1'), 'btn-top-active');
				$api.addCls($api.byId('j_btn_2'), 'btn-top-active');
				commonCloseFrame('kqglIpad_zgtj_frame'); 
				getCheckLeaveCountByType(2, function(flag, data) {
					qj_count = data.qj_count;
					wc_count = data.wc_count;
					if (qj_count == 0 && wc_count > 0) {
						openFrame('kqglIpad_kqhzIndexList_frame', function(flag) {
							openGcFrame();
						});
					} else {
						openFrame('kqglIpad_kqhzIndexList_frame', function(flag) {
							openQjFrame();
						});
					}
					setTagName(data.qj_count, data.wc_count);
				})
			}
		}

		/*
		 *author:zhaoj
		 *function:设置tag的名字和数量
		 *date：20160706
		 */
		function setTagName(qj, wc) {
			if (qj > 0) {
				$api.text($api.byId('qingjia'), '请假撤销(' + qj + ')');
			} else {
				$api.text($api.byId('qingjia'), '请假撤销');
			}
			if (wc > 0) {
				$api.text($api.byId('gongchu'), '公出撤销(' + wc + ')');
			} else {
				$api.text($api.byId('gongchu'), '公出撤销');
			}
		}

		/*
		 *author:zhaoj
		 *function:设置请假或公出数目减一
		 *date：20160706
		 */
		function setSubCount(type) {
			type == 1 ? qj_count-- : wc_count--;
			setTagName(qj_count, wc_count);
		}

		/*
		 *author:zhaoj
		 *function:打开我的考勤请假申请页面
		 *date：20160620
		 */
		function openQjFrame() {
			$api.removeCls($api.byId('gongchu'), 'active');
			$api.addCls($api.byId('qingjia'), 'active');
			commonExecScript('kqglIpad_kqgl_window','kqglIpad_kqhzIndexList_frame','changeType(0);',1);
		}

		/*
		 *author:zhaoj
		 *function:打开我的考勤公出申请页面
		 *date：20160620
		 */
		function openGcFrame() {
			//reBackType('index');
			$api.removeCls($api.byId('qingjia'), 'active');
			$api.addCls($api.byId('gongchu'), 'active');
			commonExecScript('kqglIpad_kqgl_window','kqglIpad_kqhzIndexList_frame','changeType(1);',1);
		}

		/*
		 *author:zhaoj
		 *function:打开frame页面
		 *date：20160620
		 */
		function openFrame(name, callback) {
			api.openFrame({
				name : name,
				scrollToTop : true,
				allowEdit : true,
				url : name + '.html',
				rect : {
					x : 0,
					y : header_h + 65,
					w : 'auto',
					h : api.winHeight - header_h - 65,
				},
				pageParam : {
					header_h : header_h,
				},
				vScrollBarEnabled : true,
				hScrollBarEnabled : true,
				bgColor : 'rgba(255,255,255,1)',
				//页面是否弹动 为了下拉刷新使用
				bounces : true
			});
			setTimeout(function() {
				callback(true);
			}, 300);
		}

		/*
		 *author:zhaoj
		 *function:打开考勤汇总彩电页面
		 *date：20160620
		 */
		function openMenuFrame() {
			reBackType('menu');
			api.openFrame({
				name : 'kqglIpad_kqhzMenu_frame',
				scrollToTop : true,
				allowEdit : true,
				url : 'kqglIpad_kqhzMenu_frame.html',
				rect : {
					x : 0,
					y : header_h,
					w : 'auto',
					h : api.winHeight - header_h,
				},
				pageParam : {
					header_h : header_h,
				},
				vScrollBarEnabled : true,
				hScrollBarEnabled : true,
				bgColor : 'rgba(255,255,255,1)',
				//页面是否弹动 为了下拉刷新使用
				bounces : true
			});
		}

		/*
		 *author:zhaoj
		 *function:返回页面
		 *date：20160307
		 */
		function back() {
			switch(back_type) {
				case 'index':
					commonCloseTjData($api.getStorage("identity")+'_'+api.winName);//记录统计
					commonExecScript('root','cshym_hbg_frame','getKaoqinMenu1(2)',1);
					api.closeWin();
					break;
				case 'menu':
					commonCloseFrame('kqglIpad_kqhzMenu_frame'); 
					reBackType('index');
					break;
			}
		}
		/*
		 *author:zhaoj
		 *function:返回页面
		 *date：20160621
		 */
		function resetName(name) {
			$api.text($api.byId('mTitle'), name);
		}

		/**
		 * 重置从哪个页面退出
		 * 周枫
		 * 2015.12.17
		 */
		function reBackType(type) {
			switch(type) {
				//如果通知列表页面退出
				case 'index':
					//resetName('考勤管理');
					$api.css($api.byId('menu1'), 'display:block;');
					$api.css($api.byId('menu2'), 'display:none;');
					back_type = 'index';
					break;
				//如果微课内容页面退出
				case 'menu':
					resetName('考勤范围');
					$api.css($api.byId('menu1'), 'display:none;');
					$api.css($api.byId('menu2'), 'display:block;');
					back_type = 'menu';
					break;
			}
		}

		/*
		 *author:zhaoj
		 *function:关闭菜单页面
		 *date：20160622
		 */
		function closeMenuFrame() {
			alert('关闭菜单页面');
		}

		/*
		 *作者:wangshuai
		 *功能:开始搜索
		 *日期：20161024
		 */
		function startSearch(type) {
			commonSearch(type, function(data) {
				commonExecScript('kqglIpad_kqgl_window','kqglIpad_kqhzIndexList_frame','setKeyword("' + data + '");',1);
			})
		}
	</script>
</html>