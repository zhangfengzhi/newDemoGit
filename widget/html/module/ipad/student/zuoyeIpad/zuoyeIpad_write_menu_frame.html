<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>检测下拉菜单</title>
    <link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
    <link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
    <style>
    	html, body {
        	background-color: transparent;
        	background:rgba(0,0,0,0);
   		 }
    	body{padding:0;margin:0;}
    	.shadow{position:absolute;left:0;top:0;width:100%;height:100%;z-index: 1;}
    	.header{width:100%;height:45px;}
    	.main{width:100%;}
    	.menu-list{
    		list-style:none;
    		background-color: #ffffff;
			box-shadow: 0px 0px 5px #cccccc;
			position: relative;
			width: 186px;
			float: right;
			z-index: 2;
			padding: 0;
			margin:0;
		}
		.menu-list li {
			height: 48px;
			line-height:48px;
			display: block;
			border-bottom: 1px solid #eeeeee;
			color: #333;
			font-family: sans-serif;
		}
		.menu-list li .icon-box{width:60px;height:48px;display:inline-block;float:left;}
		.menu-list li span{display:inline-block;height:48px;line-height:48px;float:left;}
		.menu-list li .tiwen{background: url(../../../../../image/fun-module/iphone/zuoye/shuoming.png) 15px center no-repeat; background-size: 30px 28px;}
		.menu-list li .chouqu{background: url(../../../../../image/fun-module/iphone/zuoye/tijiao.png) 15px center no-repeat; background-size: 34px 32px;}
		.menu-list li .zuowei{background: url(../../../../../image/fun-module/iphone/zuoye/look.png) 15px center no-repeat; background-size: 31px 31px;}
    </style>
</head>
<body class="common-ipad-zuoyeIpadstu">
	<div class="shadow" tapmode onclick="api.closeFrame({name:'zuoyeIpad_write_menu_frame'});"></div>
	<div id="header" class="header"></div>
	<div id="main" class="main">
		<ul class="menu-list">
			<li onclick="openDetailsFrame();">
				<div class="icon-box tiwen"></div>
				<span>检测说明</span>
			</li>
			<li onclick="menuSubmit();">
				<div class="icon-box chouqu"></div>
				<span>提交检测</span>
			</li>
		</ul>
	</div>
</body>
<script type="text/javascript" src="../../../../../script/api.js"></script>
<script type="text/javascript" src="../../../../../script/base_config.js" ></script>
<script type="text/javascript">
	var header_h;
	var BASE_URL_ACTION;
	var BASE_APP_TYPE;
	var no_answer_sort=0;//没有作答的最小的sort
	var answered_count=0;
	var list_length;
	apiready = function(){
		commonSetTheme({"level":5,"type":0});
		header_h = api.pageParam.header_h;
		BASE_URL_ACTION = $api.getStorage('BASE_URL_ACTION');
		BASE_APP_TYPE = $api.getStorage('BASE_APP_TYPE');
		$api.css($api.byId('header'),'height:'+header_h+'px;');
		$api.css($api.byId('main'),'height:'+(api.winHeight - header_h)+'px;');
	};
	/*
	*author:zhaoj
	*function:提交答案
	*date：20160405
	*/
	function submitZy(){
		answeredCount = list_length-answered_count;
		var tipMsg;
		if(answeredCount == 0){
			tipMsg = '确定要提交检测？';
		}else{
			tipMsg = '您还有'+answeredCount+'道题没做，确定要提交检测？';
		}
		api.confirm({
		    title: '提示',
		    msg: tipMsg,
		    buttons: ['确定','取消']
		},function( ret, err ){
			if(ret.buttonIndex == 2){
				api.closeFrame({name:'zuoyeIpad_write_menu_frame'});
			}else if(ret.buttonIndex == 1 ){
		         api.showProgress({
					title : '提交中...',
					text : '请稍候...',
					modal : true
				});
				api.ajax({
					url : BASE_URL_ACTION + '/xx/submitZy',
					method : 'post',
					timeout : 30,
					dataType : 'json',
					returnAll : false,
					data : {
						values : {
							"random_num" : creatRandomNum(),
							"student_id" : $api.getStorage("person_id"),
							"zy_id" : api.pageParam.zy_id,
							"identity_id":$api.getStorage("identity")
						}
					}
				}, function(ret, err) {
					if (err) {
						api.hideProgress();
						popToast('提交检测失败，请重新提交。');
					} else {
						if(ret.success){
							setTimeout(function(){
								var name ='getStudentZylist('+api.pageParam.subject_id+','+api.pageParam.zy_statu+',1,2)';
								api.execScript({
									name : 'zuoyeIpad_index_window',
									frameName : 'zuoyeIpad_index_frame',
									script : name
								});
							},1000);
							setTimeout(function(){
								api.hideProgress();
								api.execScript({
									name : 'zuoyeIpad_write_window',
									script : 'back()'
								});
								api.closeFrame({name:'zuoyeIpad_write_menu_frame'});
							},3000);
						}else{
							api.hideProgress();
							popToast('提交检测失败，请重新提交。');
						}
					}
				});
		    }
		});
	}
	/*
	*author:zhaoj
	*function:获取学生检测作答进度
	*date：20160405
	*/
	function getStudentZyProgress(){
		answered_count=0;
		api.ajax({
			url : BASE_URL_ACTION + '/xx/getStudentZyProgress',
			method : 'post',
			timeout : 30,
			dataType : 'json',
			returnAll : false,
			data : {
				values : {
					"random_num" : creatRandomNum(),
					"student_id" : $api.getStorage("person_id"),
					"zy_id" : api.pageParam.zy_id
				}
			}
		}, function(ret, err) {
			if (err) {
			} else {
				if(ret.success){
					var kg_list = ret.kg_que_list;
					var zg_list = ret.zg_que_list;
					list_length = kg_list.length+zg_list.length;
					if(kg_list.length > 0){
						for(var i = 0; i < kg_list.length ;i++){
							objective(kg_list[i].sort,kg_list[i].is_answered,kg_list[i].question_id_char)
						}
					}
					if(zg_list.length > 0){
						for(var i = 0; i < zg_list.length;i++){
							subjective(zg_list[i].sort,zg_list[i].is_answered,zg_list[i].question_id_char)
						}
					}
				}
			}
			submitZy();
		});
	}
	/*
	*author:zhaoj
	*function:主观题选项
	*date：20160329
	*/
	function subjective(sort,is_answered,question_id_char){
		if(is_answered){
			answered_count++;
		}else{
			if(no_answer_sort ==0){
				no_answer_sort = sort
			}else{
				if(sort<no_answer_sort){
					no_answer_sort = sort;
				}
			}
		}
	}
	/*
	*author:zhaoj
	*function:客观题选项
	*date：20160329
	*/
	function objective(sort,is_answered,question_id_char){
		if(is_answered){
			answered_count++;
		}else{
			if(no_answer_sort ==0){
				no_answer_sort = sort
			}else{
				if(sort<no_answer_sort){
					no_answer_sort = sort;
				}
			}
		}

	}
	/*
	*author:zhaoj
	*function:打开检测详情页面
	*date：20160419
	*/
	function openDetailsFrame(){
		api.execScript({
			name : 'zuoyeIpad_write_window',
			script : 'openDetailsFrame();'
		});
		setTimeout(function(){
			api.closeFrame({name:'zuoyeIpad_write_menu_frame'});
		},100);
	}
	/*
	*author:zhaoj
	*function:打开写检测页面提交选择题和多选题答案
	*date：20160420
	*/
	function menuSubmit(){
		api.execScript({
			name : 'zuoyeIpad_write_window',
			frameName : 'zuoyeIpad_write_frame',
			script :'menuSubmit()'
		});
	}
</script>
</html>