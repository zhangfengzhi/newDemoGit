<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>检测</title>
		<link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../../../../css/aui_css_new/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../../../../css/module/common/list_frame.css" />
		<link rel="stylesheet" type="text/css" href="../../../../../css/module/common/jyeoo/ques_data.css" />
		<link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
		<style>
			body {
				margin: 0;
				background: rgba(0,0,0,0);
				font-size:18px;
			}
			.clearfix:after {
				content: ' ';
				display: block;
				clear: both;
				visibility: hidden;	
				line-height: 0;
				height: 0;
			}
			.zuoye-name {
			
				line-height: 60px;
				width: 100%;
			}
			.answer-title {
				border-top: 1px solid #f1f1f1;
				height: 60px;
				width: 100%;
				margin-bottom: 20px;
			}
			.title {
				width: 50%;
				float: left;
			}
			.answer-title div {
				height: 40px;
				display: inline-block;
				line-height: 40px;
				margin-top: 13px;
				padding: 0 18px;
				color: #ffffff;
			}
			.seleted {
				width: 20%;
				float: right;
				text-align: right;
			}
			.seleted .num {
				font-size: 22px;
			}
			.stem {
				padding: 20px 5%;
				max-width:100%;
				word-break:break-all;
				color:#98979D;
			}
			.stem img {
				max-width: 90%; height:auto;
			}
			.stem div,.stem p,.stem span{word-wrap: break-word;word-break: normal; }
			.option dl {
				position:relative;
				border-radius: 5px;
				min-height: 55px;
				border: 2px solid #EFF1F1;
				margin-bottom: 20px;
			}
			.option dl dt {
				position:absolute;
				top:0px;
				bottom:-1px;
				display:block;
				font-size: 22px;
				font-weight: 600;
				width: 12%;
				height:100%;
				float: left;
				background: #EFF1F1;
		/*		line-height: 53px;*/
				border-radius: 1px 0 0 1px;
				text-align: center;
			}
			.option dl dt div{
				position:absolute;
				top:50%;
				left:50%;
				margin-top:-17px;
				margin-left:-8px;
				height:30px;
			}
			.option dl dd {
				width: 84%;
				float: right;
				margin-right:1%;
				min-height: 55px;
				line-height: 25px;
				padding:15px 0;
				color:#98979D;
				word-wrap: break-word;
				word-break: normal; 
			}
			.option dl dd div p img{
				vertical-align: middle;
				margin:10px 0;
			}
			.option dl dd img {
				max-width: 85%;
			}
			.option dl dd .judge{position:absolute;right:4%;top:50%;margin-top:-9px;max-width:15%;width:18px;}
			.option .wrong{border:2px solid #ff0000 !important;}
    		.option .wrong dt{background:#ff0000  !important;color:#ffffff !important;}
			.option .right dt {
				color: #ffffff !important;
			}
			.option .active dt {
				color: #ffffff !important;
			}
			.upload-answer button {
				width: 49%;
				height: 50px;
				color: #ffffff;
				border-radius: 4px;
				margin-bottom: 20px;
				font-size:18px;
			}
			.upload-answer button:first-child{
				float:left;
			}
			.upload-answer button:last-child{
				float:right;
			}
			.upload-answer button.no-use {
				background: #f1f1f1;
				color: #dCdCdc
			}
			.upload-answer button .aui-iconfont {
				margin-right: 5px;
				font-size: 22px;
			}
			.source-img ul {
				overflow: visible;
			}
			.source-img ul li {
				list-style: none;
				overflow: visible;
				position: relative;
			}
			.source-img ul li div {
				text-align: center;
				border: 1px solid #f1f1f1;
			}
			.source-img ul li .delete-img {
				position: absolute;
				top: -10px;
				right: -10px;
			}
			.source-img img{
				max-width: 100%;
			}
			.next {
				line-height: 55px;
				text-align: right;
			}
			.source-img ul li.voice {
				position: relative;
				margin-bottom: 20px;
				background: url(../../../../../image/fun-module/iphone/zuoye/voice.png) left top no-repeat;
				height: 50px;
				text-align: left;
				line-height: 45px;
				padding-left: 20px;
				color: #ffffff;
			}
			.source-img ul li.voice .delete-voice {
				position: absolute;
				right: -7px;
				top: -7px
			}
			.source-img ul li.voice .voice-right {
				position: absolute;
				right: -6px;
				top: 0;
				display:block;
				background: url(../../../../../image/fun-module/iphone/zuoye/voice-right.png) right top no-repeat;
			}
			.plr15 {
				padding: 0 15px;
			}
			.no-data {
				text-align: center;
				color: #c0c0c0;
				margin-bottom: 20px;
			}
			.footer-div{
				position:fixed;
				z-index:999;
				height:60px;
				background:#ffffff;
				display: block;
				bottom: 0px;
				width:100%;
				box-shadow:3px 0 4px #aaaaaa;
			}
			.footer-div .prevQ,.footer-div .nextQ{display: inline-block;width:50%;float: left;}
			.footer-div .prevQ{text-align: left;}
			.footer-div .nextQ{text-align: right;}
			.footer_div{height:62px;}
			.plrb15{padding:0 15px 15px 15px;}
			.source-img{color:#9C9C9C;}
			.no-question-data{text-align:center;color:#666;height:50px;line-height:50px;}
			.analysis-btn{width:92%;line-height:45px;text-align:center;color:#ffffff;margin-top:9px;border-radius:2px;margin-left:4%;margin-bottom:15px;}
			/*多种作答样式*/
            .answer-title .answer-btn{width:300px;background:#FDFDFD !important;}
            .answer-btn div.sxb{background:#FDFDFD url(../../../../../image/fun-module/iphone/zuoye/zuoye_sxb.png) 0 0 no-repeat;}
            .answer-btn div.caution{background:#FDFDFD url(../../../../../image/fun-module/ipad/zuoye/sxb_caution.png) 0 0 no-repeat;}
            .answer-btn div.picture{background:#FDFDFD url(../../../../../image/fun-module/iphone/zuoye/zuoye_zd.png) 0 0 no-repeat;}
            .answer-btn div.pen{background:#FDFDFD url(../../../../../image/fun-module/iphone/zuoye/zuoye_zd.png) 0 -40px no-repeat;}
            .answer-btn div.vedio{background:#FDFDFD url(../../../../../image/fun-module/iphone/zuoye/zuoye_zd.png) 0 -80px no-repeat;}
            .answer-btn div.audio{background:#FDFDFD url(../../../../../image/fun-module/iphone/zuoye/zuoye_zd.png) 0 -120px no-repeat;}
            .answer-title .answer-btn{padding:0;position: relative;}
            .answer-title .answer-btn div{height:40px;display:inline-block;width: 20%;margin-top:8px;padding:0;background-size: 40px auto;}
            .fl{float:left;}
            .fr{float:right;}
            .fj-body .fj-title,.text-title{padding:0 15px;}
            .fj-title font{font-size:14px;color:#f00;padding-left:3px;}
            .fj-content{padding:0 10px;}
            .fj-ul{padding:15px 0 5px 0;}
            .fj-ul li{position:relative;width:20%;padding:0 20px 20px 20px;}
            .fj-ul li .delete{position:absolute;right:20px;top:0;width:32px;height:32px;background: url(../../../../../image/fun-module/iphone/zuoye/delete.png) 3px 3px no-repeat;background-size:24px auto;}
            .fj-ul li .fj-name{text-align:center;font-size:16px;color:#777;height:30px;line-height: 30px;}
            .text-content{padding:10px 15px 0 15px;}
            .text-content textarea{margin-bottom:5px;height:127px;max-height:127px;overflow-y:auto;}
            .text-btn button{float:right;color:#fff;margin-bottom:70px;}
            .text-btn button[disabled]{background:#efefef;}
            .zoomImage{padding-bottom:80%;}
            .zoomImage img{position:absolute;width:100%;top:0;bottom:0;height:100%;}
            .caution{background-size: 20px !important;position: absolute;width: 20px !important;height: 20px !important;bottom: -10px;left: 26px;}
		</style>
	</head>
	<body id="body" class="common-ipad-zuoyeIpadstu">
		<div id="q_title"></div>
		<div class="q_div" id="q_div"></div>
		<script type="text/html" id="q_script">
			<div class="zuoye-name plr15 clearfix">
				<div class="title"><%=qt_name %></div>
				<div class="seleted" onclick="openScantron();"><font class="num"><%=sort%></font>/<%=list_length%></div>
			</div>
			<%if(html_json){%>
				<%if(que_source == 1){ %>
					<!--东师理想试题展示-->
					<div class="stem clearfix">
						<%=#commonRemoveQuestionEdit(html_json.question_title)%>
					</div>
					<!--客观题-->
					<%if(qt_type == 1){ %>
						<%if(qt_id == 72){ %>
							<div id="j_option" class="option plr15 clearfix">
								<dl class="clearfix" answerOption="正确" onclick="selectedClass('<%=qt_name%>',<%=qt_id%>,<%=question_id%>,'正确',1,<%=sort%>,'<%=question_id_char%>',1,<%=que_source%>,'<%=jy_subject_en_name%>',this);">
									<dt><div>1</div></dt>
									<dd>正确
										<img id="j_right_1" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
										<img id="j_wrong_1" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
									</dd>
								</dl>
								<dl class="clearfix" answerOption="错误" onclick="selectedClass('<%=qt_name%>',<%=qt_id%>,<%=question_id%>,'错误',1,<%=sort%>,'<%=question_id_char%>',1,<%=que_source%>,'<%=jy_subject_en_name%>',this);">
									<dt><div>2</div></dt>
									<dd>错误
										<img id="j_right_2" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
										<img id="j_wrong_2" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
									</dd>
								</dl>
							</div>
							<div id="j_right_answer_title" class="answer-title clearfix" style="display:none;">
								<div>
									正确答案
								</div>
							</div>
							<div id="j_right_answer" class="source-img plrb15 right-answer img clearfix" style="display:none;">
								<%=#html_json.question_answer%>
							</div>
							<%if(jx_info == 0){%>
								<div id="j_jx_btn" class="analysis-btn" style="display:none;"onclick="viewAnalysis(<%=sort%>,'<%=question_id_char%>','<%=que_source%>','<%=jy_subject_en_name%>')">查看解析</div>
								<div id="j_analysis_title" class="answer-title clearfix" style="display:none;">
									<div>
										题目解析
									</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix" style="display:none;"></div>
							<%}else{%>
								<div id="j_analysis_title" class="answer-title clearfix">
								<div>
									题目解析
								</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix">
									<%=#jx_info%>
								</div>
							<%}%>	
						<!--//判断题-->
						<%}else if(qt_id == 2){ %>
							<!--客观题-->
							<div id="j_option" class="option plr15 clearfix">
								<%for(var i = 0; i < html_json.question_answer_length; i++){%>
									<dl class="clearfix" answerOption="<%=html_json.question_answer_first[i]%>" onclick="selectedClass('<%=qt_name%>',<%=qt_id%>,<%=question_id%>,'<%=html_json.question_answer_first[i]%>',1,<%=sort%>,'<%=question_id_char%>',1,<%=que_source%>,'<%=jy_subject_en_name%>',this);">
										<dt><div><%=html_json.question_answer_first[i]%></div></dt>
										<dd><%=#html_json.quetionOption[i]%>
											<img id="j_right_<%=html_json.question_answer_first[i]%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
											<img id="j_wrong_<%=html_json.question_answer_first[i]%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
										</dd>
									</dl>
								<%}%>
							</div>
							<div id="j_right_answer_title" class="answer-title clearfix" style="display:none;">
								<div>
									正确答案
								</div>
							</div>
							<div id="j_right_answer" class="source-img plrb15 right-answer img clearfix" style="display:none;">
								<%=#html_json.question_answer%>
							</div>
							<%if(jx_info == 0){%>
								<div id="j_jx_btn" class="analysis-btn" style="display:none;"onclick="viewAnalysis(<%=sort%>,'<%=question_id_char%>','<%=que_source%>','<%=jy_subject_en_name%>')">查看解析</div>
								<div id="j_analysis_title" class="answer-title clearfix" style="display:none;">
									<div>
										题目解析
									</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix" style="display:none;"></div>
							<%}else{%>
								<div id="j_analysis_title" class="answer-title clearfix">
								<div>
									题目解析
								</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix">
									<%=#jx_info%>
								</div>
							<%}%>	
						<% } else if (qt_id == 26 || qt_id == 8) { %>
							<!--客观题-->
							<div id="j_option" class="option plr15 clearfix">
								<%for(var i = 0; i < html_json.question_answer_length; i++){%>
									<dl class="clearfix" answerOption="<%=html_json.question_answer_first[i]%>" onclick="selectedClass('<%=qt_name%>',<%=qt_id%>,<%=question_id%>,'<%=html_json.question_answer_first[i]%>',1,<%=sort%>,'<%=question_id_char%>',0,<%=que_source%>,'<%=jy_subject_en_name%>',this);">
										<dt><div><%=html_json.question_answer_first[i]%></div></dt>
										<dd><%=#html_json.quetionOption[i]%>
											<img id="j_right_<%=html_json.question_answer_first[i]%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
											<img id="j_wrong_<%=html_json.question_answer_first[i]%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
										</dd>
									</dl>
								<%}%>
							</div>
							<div id="j_right_answer_title" class="answer-title clearfix" style="display:none;">
								<div>
									正确答案
								</div>
							</div>
							<div id="j_right_answer" class="source-img plrb15 right-answer img clearfix" style="display:none;">
								<%=#html_json.question_answer%>
							</div>
							<%if(jx_info == 0){%>
								<div id="j_jx_btn" class="analysis-btn" style="display:none;"onclick="viewAnalysis(<%=sort%>,'<%=question_id_char%>','<%=que_source%>','<%=jy_subject_en_name%>')">查看解析</div>
								<div id="j_analysis_title" class="answer-title clearfix" style="display:none;">
									<div>
										题目解析
									</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix" style="display:none;"></div>
							<%}else{%>
								<div id="j_analysis_title" class="answer-title clearfix">
								<div>
									题目解析
								</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix">
									<%=#jx_info%>
								</div>
							<%}%>	
						<%}%>
					<%}else{%>
						<!--主观题-->
						<div id="j_answer_title" class="answer-title clearfix">
			                <div>
			                   	 我的作答
			                </div>
			                <div class="answer-btn fr">
			                    <div id="sxb" class="fl sxb aui-hide" onclick="openSxb();">&nbsp;</div>
			                    <div id="caution" class="fl caution aui-hide"></div>
			                    <div class="fl picture" onclick="uploadAnswers();">&nbsp;</div>
			                    <div class="fl pen" onclick="openDrawDoardFrame();">&nbsp;</div>
			                    <div class="fl vedio" onclick="openRecordWindow();">&nbsp;</div>
			                    <div class="fl audio" onclick="openAudioWindow();">&nbsp;</div>
			                </div>
			            </div>
			            <div class="fj-body">
			                <div class="fj-title">附件答案<font>（注：最多上传十个附件）</font></div>
			                <div class="fj-content">
			                    <div id="j_no_data" class="no-data">
			                        暂无附件答案
			                    </div>
			                    <ul id="j_zg_answers" class="fj-ul aui-hide" qtID=<%=qt_id%> qtName=<%=qt_name%> questionID="-1" sort="<%=sort%>" questionIDChar="<%=question_id_char%>" queSource="<%=que_source%>" jySubjectEnName="<%=jy_subject_en_name%>">
			                    </ul>
			                </div>
			            </div>
			            <div class="text-body">
			                <div class="text-title">文本答案</div>
			                <div class="text-content clearfix">
			                    <textarea id="j_textarea" onscroll="this.rows++;" id="notice_content" rows="5" placeholder="请输入内容..."></textarea>
			                    <div class="text-btn">
			                        <button id="j_save_text" onclick="zgtSaveAnswer(1,'');">保存文本</button>
			                    </div>
			                </div>
			            </div>
						<div id="j_right_answer_title" class="answer-title clearfix" style="display:none;">
							<div>
								正确答案
							</div>
						</div>
						<div id="j_right_answer" class="source-img plrb15 right-answer img clearfix" style="display:none;">
							<%=#html_json.question_answer%>
						</div>
						<%if(jx_info == 0){%>
								<div id="j_jx_btn" class="analysis-btn" style="display:none;"onclick="viewAnalysis(<%=sort%>,'<%=question_id_char%>','<%=que_source%>','<%=jy_subject_en_name%>')">查看解析</div>
								<div id="j_analysis_title" class="answer-title clearfix" style="display:none;">
									<div>
										题目解析
									</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix" style="display:none;"></div>
							<%}else{%>
								<div id="j_analysis_title" class="answer-title clearfix">
								<div>
									题目解析
								</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix">
									<%=#jx_info%>
								</div>
							<%}%>	
					<% } %>
				<%}else{%>
					<!--菁优网试题展示-->
					<div class="stem clearfix">
						<%=#commonRemoveQuestionEdit(html_json.Content)%>
					</div>
					<%if(qt_type == 1){ %>
						<!--客观题-->
						<%if(qt_id == 1 || qt_id == 8 && html_json.Answers.length == 1) { %>
							<!--单选-->
							<div id="j_option" class="option plr15 clearfix">
								<%for(var i = 0; i < html_json.Options.length; i++){%>
									<dl class="clearfix" answerOption="<%=html_json.Options_first[i]%>" onclick="selectedClass('<%=qt_name%>',<%=qt_id%>,<%=question_id%>,'<%=i%>',1,<%=sort%>,'<%=question_id_char%>',1,<%=que_source%>,'<%=jy_subject_en_name%>',this);">
										<dt><div><%=html_json.Options_first[i]%></div></dt>
										<dd><%=#html_json.Options[i]%>
											<img id="j_right_<%=html_json.Options_first[i]%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
											<img id="j_wrong_<%=html_json.Options_first[i]%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
										</dd>
									</dl>
								<%}%>
							</div>
							<!--//单选-->
						<%}else if(qt_id == 3 || qt_id == 8 && html_json.Answers.length > 1){%>
							<!--选择题-->
							<div id="j_option" class="option plr15 clearfix">
								<%for(var i = 0; i < html_json.Options.length; i++){%>
									<dl class="clearfix" answerOption="<%=i%>" onclick="selectedClass('<%=qt_name%>',<%=qt_id%>,<%=question_id%>,'<%=i%>',1,<%=sort%>,'<%=question_id_char%>',0,<%=que_source%>,'<%=jy_subject_en_name%>',this);">
										<dt><div><%=html_json.Options_first[i]%></div></dt>
										<dd><%=#html_json.Options[i]%>
											<img id="j_right_<%=i%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
											<img id="j_wrong_<%=i%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
										</dd>
									</dl>
								<%}%>
							</div> 
							<!--//选择题-->
						<%}else if(qt_id == 4){%>
							<!--判断题-->
							<div id="j_option" class="option plr15 clearfix">
								<dl class="clearfix" answerOption="√" onclick="selectedClass('<%=qt_name%>',<%=qt_id%>,<%=question_id%>,'√',1,<%=sort%>,'<%=question_id_char%>',1,<%=que_source%>,'<%=jy_subject_en_name%>',this);">
									<dt><div>1</div></dt>
									<dd>正确
										<img id="j_right_1" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
										<img id="j_wrong_1" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
									</dd>
								</dl>
								<dl class="clearfix" answerOption="×" onclick="selectedClass('<%=qt_name%>',<%=qt_id%>,<%=question_id%>,'×',1,<%=sort%>,'<%=question_id_char%>',1,<%=que_source%>,'<%=jy_subject_en_name%>',this);">
									<dt><div>2</div></dt>
									<dd>错误
										<img id="j_right_2" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
										<img id="j_wrong_2" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
									</dd>
								</dl>
							</div>
							<!--//判断题-->
						<%}%>
						<div class="j_jy answer-title clearfix display-none">
                            <div>
                              	  正确答案
                            </div>
                        </div>
                        <div class="j_jy source-img plrb15 right-answer img clearfix display-none">
                            <%if(qt_id == 4){%>
                                <%if(html_json.Answers[0] == "√"){%>
                                  	  正确
                                <%}else{%>
                                    	错误
                                <%}%>
                            <%}else{%>
                                <%for(var i = 0; i < html_json.Answers.length; i++){%>
                                    <%=html_json.Options_first[html_json.Answers[i]]%>
                                <%}%>
                            <%}%>
                        </div>
                        <%if(jx_info == 0){%>
								<div id="j_jx_btn" class="analysis-btn" style="display:none;"onclick="viewAnalysis(<%=sort%>,'<%=question_id_char%>','<%=que_source%>','<%=jy_subject_en_name%>')">查看解析</div>
								<div id="j_analysis_title" class="answer-title clearfix" style="display:none;">
									<div>
										题目解析
									</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix" style="display:none;"></div>
							<%}else{%>
								<div id="j_analysis_title" class="answer-title clearfix">
								<div>
									题目解析
								</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix">
									<%=#jx_info%>
								</div>
							<%}%>	
						<!--//客观题-->
					<%}else{%>
						<!--主观题-->
						<div id="j_answer_title" class="answer-title clearfix">
			                <div>
			                   	 我的作答
			                </div>
			                <div class="answer-btn fr">
			                	<div id="sxb" class="fl sxb aui-hide" onclick="openSxb();">&nbsp;</div>
			                	<div id="caution" class="fl caution aui-hide">&nbsp;</div>
			                    <div class="fl picture" onclick="uploadAnswers();">&nbsp;</div>
			                    <div class="fl pen" onclick="openDrawDoardFrame();">&nbsp;</div>
			                    <div class="fl vedio" onclick="openRecordWindow();">&nbsp;</div>
			                    <div class="fl audio" onclick="openAudioWindow();">&nbsp;</div>
			                </div>
			            </div>
			            <div class="fj-body">
			                <div class="fj-title">附件答案<font>（注：最多上传十个附件）</font></div>
			                <div class="fj-content">
			                    <div id="j_no_data" class="no-data">
			                        暂无附件答案
			                    </div>
			                    <ul id="j_zg_answers" class="fj-ul aui-hide" qtID=<%=qt_id%> qtName=<%=qt_name%> questionID="-1" sort="<%=sort%>" questionIDChar="<%=question_id_char%>" queSource="<%=que_source%>" jySubjectEnName="<%=jy_subject_en_name%>">
			                    </ul>
			                </div>
			            </div>
			            <div class="text-body">
			                <div class="text-title">文本答案</div>
			                <div class="text-content clearfix">
			                    <textarea id="j_textarea" onscroll="this.rows++;" id="notice_content" rows="5" placeholder="请输入内容..."></textarea>
			                    <div class="text-btn">
			                        <button id="j_save_text" onclick="zgtSaveAnswer(1,'');">保存文本</button>
			                    </div>
			                </div>
			            </div>
					<%if(jx_info == 0){%>
								<div id="j_jx_btn" class="analysis-btn" style="display:none;"onclick="viewAnalysis(<%=sort%>,'<%=question_id_char%>','<%=que_source%>','<%=jy_subject_en_name%>')">查看解析</div>
								<div id="j_analysis_title" class="answer-title clearfix" style="display:none;">
									<div>
										题目解析
									</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix" style="display:none;"></div>
							<%}else{%>
								<div id="j_analysis_title" class="answer-title clearfix">
								<div>
									题目解析
								</div>
								</div>
								<div id="j_analysis" class="source-img plrb15 img clearfix">
									<%=#jx_info%>
								</div>
							<%}%>	
						<!--//主观题-->
					<%}%>
					<!--//菁优网试题展示-->
				<%}%>
			<%}else{%>
				<div class="no-question-data">该题目正在生成，请稍候查看</div>
			<%}%>
			<%if(html_json && ((que_source == 1 && (qt_id == 8 || qt_id == 26)) || (que_source == 2 && (qt_id == 3 || qt_id == 8 && html_json.Answers.length >= 1)))){%>
				<div class="footer-div next clearfix">
                    <div class="prevQ" onclick="multiselectSubmit(<%=qt_id%>,'<%=qt_name%>',<%=question_id%>,1,<%=sort%>,'<%=question_id_char%>',0,'<%=que_source%>','<%=jy_subject_en_name%>');"><span class="aui-iconfont aui-icon-left"></span>上一题</div>
                    <div id="j_multiselect" class="nextQ"  qtID=<%=qt_id%> qtName=<%=qt_name%> questionID="<%=question_id%>" sort="<%=sort%>" questionIDChar="<%=question_id_char%>" queSource="<%=que_source%>" jySubjectEnName="<%=jy_subject_en_name%>" onclick="multiselectSubmit(<%=qt_id%>,'<%=qt_name%>',<%=question_id%>,1,<%=sort%>,'<%=question_id_char%>',1,'<%=que_source%>','<%=jy_subject_en_name%>');">下一题<span class="aui-iconfont aui-icon-right"></span></div>
                </div>
			<%}else{%>
				<div class="footer-div next clearfix">
					<div class="prevQ" onclick="enterPreQuestion();"><span class="aui-iconfont aui-icon-left"></span>上一题</div>
					<div class="nextQ" onclick="goNextQuestion();">下一题<span class="aui-iconfont aui-icon-right"></span></div>
				</div>
			<%}%>
		</script>
		<div id="j_wk_title"  class="answer-title clearfix" style="display: none;">
			<div>
				微课讲解
			</div>
		</div>
		<div id="wklist_div" class="wklist_div"></div>
		<script type="text/html" id="wklist_script">
			<% if(wkdetail_list.length > 0){ %>
				<%for(var i=0; i<wkdetail_list.length; i++) {%>
					<!--微课列表-->
					<div class="section3" id="kcListDiv">
						<div class="item style1" tapmode="itemhover" onclick="openWeikeContent('<%=wkdetail_list[i].id %>','<%=wkdetail_list[i].wkds_name %>','<%=wkdetail_list[i].is_phone_wk %>','<%=wkdetail_list[i].phone_wk_file_id %>');">
							<div class="itemlogo userlogo"><img onerror="this.src='../../../../../image/fun-module/common/wk_default.png'" src="../../../../../image/fun-module/common/wk_default.png" alt="" data-echo="<%=wkdetail_list[i].wk_thumb_url %>">
							</div>
							<div class="itemshelf">
								<div class="shelfinfo01">
									<%=wkdetail_list[i].wkds_name %>
								</div>  
								<div class="shelfinfo04">
									<div class="left ellipsis">教师：<%=wkdetail_list[i].teacher_name %>
										<div class="time">发布：<%=wkdetail_list[i].create_time.substring(0,10) %></div>
									</div>
								</div>
								<div class="shelfinfo06">
									浏览次数：<%=wkdetail_list[i].play_count %>&nbsp;次
								</div>
							</div>
							
						</div>
					</div>
				<% } %>
			<% } %>
		</script>
		<div id="footer_div" class="footer_div">
			&nbsp;
		</div>
	</body>
	<script type="text/javascript" src="../../../../../script/api.js"></script>
	<script type="text/javascript" src="../../../../../script/base_config.js" ></script>
	<script type="text/javascript" src="../../../../../script/plug-in/template.js" ></script>
	<script type="text/javascript" src="../../../../../script/plug-in/base64.js" ></script>
	<script type="text/javascript" src="../../../../../script/common/common.js" ></script>
	<script type="text/javascript" src="../../../../../script/plug-in/echo.min.js"></script>
	<script type="text/javascript" src="../../../../../script/assembly/executeApp.js" ></script>
	<script type="text/javascript" src="../../../../../script/assembly/openResource.js" ></script>
	<script type="text/javascript" src="../../../../../script/assembly/photoBrowser.js"></script>
	<script type="text/javascript" src="../../../../../script/assembly/UIAlbumBrowser.js"></script>
	<script type="text/javascript" src="../../../../../script/assembly/getPicture.js"></script>
	<script type="text/javascript">
		var header_h;
		var BASE_URL_ACTION;
		var BASE_APP_TYPE;
		var cross_w;
		//横屏宽度
		var img_count = 0;
		//图片的个数
		var voice_count = 0;
		//语音的个数
		var q_cur_num = 0;
		//当前试题
		var q_sum = 0;
		//试题总数
		var q_json_str;
		//试题json
		var obj_scan;
		var answers_count = 0;//答案的个数
		var voice_duration=0;//音频的秒数
		var guid_amr;//音频的file_id
		var netAudio;//播放录音对象
		var qt_id;//题目的类型
		var is_play_voice;//正在播放声音的路径
		var is_html;//客观题中选择题和多选题是否生成的html代码
		var stuAnswer='';
		var cancel_answer = false;//取消答案
		var is_scan = false;//单选题时，是否进入答题卡页面
		var p_id = 0;
		//身份id
		var i_id = 0;
		var que_source;//试题来源，1，东师理想，2箐优网
		var question_title_base64;//题干
		
		var handWriteBoard;
		var connect_state = false;
		var caution;
		apiready = function() {
			commonSetTheme({"level":5,"type":0});
			header_h = api.pageParam.header_h;
			cross_w = api.pageParam.cross_w;
			p_id = $api.getStorage('person_id');
			i_id = $api.getStorage('identity');
			handWriteBoard = api.require('handWriteBoard');//手写板模块
			if($api.getStorage("stu_sxb") != "false" && api.systemType == "android" && api.uiMode == "pad" && $api.getStorage("identity") * 1 == 6){
		      handWriteBoard.start(resultCallback);
			}
			
			BASE_URL_ACTION = $api.getStorage('BASE_URL_ACTION');
			BASE_APP_TYPE = $api.getStorage('BASE_APP_TYPE');
			obj_scan = api.require('UIAlbumBrowser');
			netAudio = api.require('netAudio');
			getZyInfoById();
			q_cur_num = 0;
			commonScreenSwipeRight('preQuestion()');
			commonScreenSwipeLeft('goNextQuestion();');
		};
		/*
		 *author:zhaoj
		 *function:判断有几张图片上传，如果有四张，按钮不能触发点击事件，成灰
		 *date：20160325
		 */
		function judgeLength(answers_count) {
            if(answers_count==0){
                $api.addCls($api.byId('j_zg_answers'),'aui-hide');
                $api.removeCls($api.byId('j_no_data'),'aui-hide');
            } else {
                $api.addCls($api.byId('j_no_data'),'aui-hide');
                $api.removeCls($api.byId('j_zg_answers'),'aui-hide');
            }
        }

		/*
         *author:zhaoj
         *function:删除上传图片
         *date：20160325
         */
        function deleteImg(e, parent, grandpa, self) {
            answers_count = answers_count - 1;
            var zoomImage = $api.first(parent, '.zoomImage');
            parent.removeChild(zoomImage);
            parent.removeChild(self);
            grandpa.removeChild(parent);
            //判断已有图片数目
            judgeLength(answers_count);
            e.stopPropagation();
        }
		/*
		 *author:zhaoj
		 *function:打开图片
		 *date：20160328
		 */
		function openImage(src_url) {
			var openImgArray = [];
			var index;
			//打开的是第几张图片
			var liArray = $api.domAll($api.byId('add_answer'), '.j_img_li');
			for (var i = 0; i < liArray.length; i++) {
				openImgArray.push($api.attr($api.dom(liArray[i], '.j_img'), 'src'));
				if ($api.attr($api.dom(liArray[i], '.j_img'), 'src') == src_url) {
					index = i;
				}
			}
			var imageBrowser = api.require('imageBrowser');
			imageBrowser.openImages({
				imageUrls : openImgArray,
				//是否以九宫格方式显示图片
				showList : false,
				//showList : true,
				activeIndex : index
			});
		}

		/*
		 *author:zhaoj
		 *function:提交多选答案
		 *date：20160329
		 */
		function openScantron() {
			if(((que_source == 1 && (qt_id == 8 || qt_id == 26)) || (que_source == 2 && qt_id == 3))&&is_html){
				var questionID = $api.byId('j_multiselect').getAttribute("questionID");
				var sort = $api.byId('j_multiselect').getAttribute("sort"); 
				var questionIDChar = $api.byId('j_multiselect').getAttribute("questionIDChar"); 
				var qtName = $api.byId('j_multiselect').getAttribute("qtName"); 
				var qtID = $api.byId('j_multiselect').getAttribute("qtID");
				var queSource = $api.byId('j_multiselect').getAttribute("queSource");
				var jySubjectEnName = $api.byId('j_multiselect').getAttribute("jySubjectEnName");
				multiselectSubmit(qtID ,qtName,questionID,1,sort,questionIDChar,2,queSource,jySubjectEnName);
			}else if(qt_id == 2){
				if(cancel_answer){
					if(is_scan){
						openScantronWin();
					}else{
						openScantron();
					}
				}else{
					openScantronWin();
				}
			}else{
				openScantronWin();
			}
			
		}
		/*
		 *author:zhaoj
		 *function:打开答题卡页面
		 *date：20160329
		 */
		function openScantronWin(){
			commonOpenWin('zuoyeIpad_scantron_window', 'zuoyeIpad_scantron_window.html', false, false, {"header_h":api.pageParam.header_h,zy_id : api.pageParam.zy_id,subject_id : api.pageParam.subject_id,zy_statu : api.pageParam.zy_statu,is_stop : api.pageParam.is_stop});
		}
		function reWriteQuestion(q_cur) {
			cancel_answer = false;//取消答案
			is_scan = false;//单选题时，是否进入答题卡页面
		    q_cur_num =q_cur;
			var length = q_json_str.zy_info.list.length;
			if(length>0){
				answers_count=0;
				q_sum = q_json_str.zy_info.list.length - 1;
				var cur_json = q_json_str.zy_info.list[q_cur];
				cur_json.commonRemoveQuestionEdit=commonRemoveQuestionEdit;
				qt_id = cur_json.qt_id;
				que_source = cur_json.que_source;
				if(que_source == 1){
					question_title_base64 = Base64.encode(cur_json.html_json.question_title);
				}else{
					question_title_base64 = Base64.encode(cur_json.html_json.Content);
				}
				var html_type = template.render('q_script', cur_json);
				document.getElementById('q_div').innerHTML = html_type;
				
				if($api.getStorage("stu_sxb") != "false" && api.systemType == "android" && api.uiMode == "pad" && $api.getStorage("identity") * 1 == 6){
					setTimeout(function (){
						caution = $api.byId("caution");
						$api.removeCls($api.byId("sxb"), "aui-hide");
						resultCallback();
					},300);
				}
				
				var question_id_char=cur_json.question_id_char;
				getAnswerByStuZyQueId(cur_json.question_id,question_id_char,cur_json.que_source,cur_json.jy_subject_en_name);
				//判断text-indent和padding-left
				judgeTextIndent();
				//是否生成了html代码
				if(q_json_str.zy_info.list[q_cur].html_json){
					is_html=1;
				}else{
					is_html=0;
				}
				isStopOpt();
				//判断是最后一题还是第一题
				judgeLastOrFirst(q_cur+1,length);
				if(api.pageParam.is_stop){
					//加载微课
					isShowWk(cur_json.question_id,question_id_char,que_source,q_json_str.zy_info.zy_id);
				}
			}else{
				$api.html($api.byId('q_div'), '<div class="no-question-data">暂无题目</div>');
			}
		}
		/*
		*author:zhaoj
		*function:判断每个p标签的text-indent属性和padding-left属性，解决这个属性过大导致整体页面变宽的问题
		*date：201604014
		*/
		function judgeTextIndent(){
			var pArray = $api.domAll($api.byId('body'), 'p');
			var widthValue = Math.floor(api.winWidth/2);
			for(var i = 0; i < pArray.length; i++){		
				var textIndentValue = $api.cssVal(pArray[i],'text-indent');
				textIndentValue = textIndentValue.substring(0,textIndentValue.length-2)*1;
				if(textIndentValue > widthValue || textIndentValue < -widthValue){
					$api.css(pArray[i],'text-indent:0em;');
				}
				var paddingLeftValue = $api.cssVal(pArray[i],'padding-left');
				paddingLeftValue = paddingLeftValue.substring(0,paddingLeftValue.length-2)*1;
				if(paddingLeftValue > widthValue || paddingLeftValue < -widthValue){
					$api.css(pArray[i],'padding-left:0;');
				}

			}
		}
		/*
		*author:zhaoj
		*function:检测截止的一些操作
		*date：201604013
		*/
		function isStopOpt(){
			var is_stop = api.pageParam.is_stop;
            if(((que_source==1 && qt_id != 2&& qt_id !=8 &&qt_id !=26 &&qt_id !=72) || (que_source==2 && qt_id != 1&& qt_id !=3 &&qt_id !=4)) && is_stop){
                $api.attr($api.byId('j_save_text'),'disabled','disabled');
                $api.css($api.byId('j_save_text'),'margin-bottom:15px;');
            }
            if($api.getStorage('identity') == 7 && !api.pageParam.is_stop){
                $api.attr($api.byId('j_save_text'),'disabled','disabled');
            }
            if(is_stop){
                $api.css($api.byId('j_right_answer_title'),'display:block;');
                $api.css($api.byId('j_right_answer'),'display:block;');
                $api.css($api.byId('j_jx_btn'),'display:block;');
                $api.attr($api.byId('j_save_text'),'disabled','disabled');
                $api.css($api.byId('j_save_text'),'margin-bottom:15px;');
                var jy_array = $api.domAll('.j_jy');
                for(var i = 0; i < jy_array.length; i++){
                    $api.removeCls(jy_array[i],'display-none');
                }
            }
		}
		/*
		*author:zhaoj
		*function:判断是第一题还是最后一题
		*date：201604019
		*/
		function judgeLastOrFirst(q_cur,length){
			if(q_cur == 1 && length != 1){
				$api.css($api.dom('.prevQ'),'display:none;');
				$api.css($api.dom('.nextQ'),'float:right;');
			}else if(q_cur == length && length != 1){
				$api.html($api.dom('.nextQ'),'进入答题卡<span class="aui-iconfont aui-icon-right"></span>');
			}else if(q_cur == 1 && length == 1){
				$api.css($api.dom('.prevQ'),'display:none;');
				$api.css($api.dom('.nextQ'),'float:right;');
				$api.html($api.dom('.nextQ'),'进入答题卡<span class="aui-iconfont aui-icon-right"></span>');
			}
		}
		
		function goNextQuestion(){
			if(((que_source == 1 && (qt_id == 8 || qt_id == 26)) || (que_source == 2 && qt_id == 3))&&is_html){
				var questionID = $api.byId('j_multiselect').getAttribute("questionID");
				var sort = $api.byId('j_multiselect').getAttribute("sort"); 
				var questionIDChar = $api.byId('j_multiselect').getAttribute("questionIDChar"); 
				var qtName = $api.byId('j_multiselect').getAttribute("qtName"); 
				var qtID = $api.byId('j_multiselect').getAttribute("qtID");
				var queSource = $api.byId('j_multiselect').getAttribute("queSource");
				var jySubjectEnName = $api.byId('j_multiselect').getAttribute("jySubjectEnName");
				multiselectSubmit(qtID ,qtName,questionID,1,sort,questionIDChar,1,queSource,jySubjectEnName);
			}else{
				enterNextQuestion();
			}
		}
		/*
		*author:zhaoj
		*function:进入下一道题目
		*date：20160408
		*/
		function enterNextQuestion(){
			if (q_cur_num < q_sum) {
				q_cur_num++;
				reWriteQuestion(q_cur_num);
			} else {
				q_cur_num = q_cur_num;
				openScantron();
			}
		}

		function preQuestion() {
			if(((que_source == 1 && (qt_id == 8 || qt_id == 26)) || (que_source == 2 && qt_id == 3))&&is_html){
				var questionID = $api.byId('j_multiselect').getAttribute("questionID");
				var sort = $api.byId('j_multiselect').getAttribute("sort"); 
				var questionIDChar = $api.byId('j_multiselect').getAttribute("questionIDChar"); 
				var qtName = $api.byId('j_multiselect').getAttribute("qtName"); 
				var qtID = $api.byId('j_multiselect').getAttribute("qtID");
				var queSource = $api.byId('j_multiselect').getAttribute("queSource");
				var jySubjectEnName = $api.byId('j_multiselect').getAttribute("jySubjectEnName");
				multiselectSubmit(qtID ,qtName,questionID,1,sort,questionIDChar,0,queSource,jySubjectEnName);
			}else{
				enterPreQuestion();
			}
		}
		/*
		*author:zhaoj
		*function:进入下一道题目
		*date：20160408
		*/
		function enterPreQuestion(){
			if (q_cur_num > 0) {
				q_cur_num--;
			} else {
				popToast('已经到第一题');
				q_cur_num = 0;
			}
			reWriteQuestion(q_cur_num);
		}
		/*
		*author:zhaoj
		*function:获取检测
		*date：20160405
		*/
		function getZyInfoById(){
			showSelfProgress('加载中...');
			api.ajax({
				url : BASE_URL_ACTION + '/xx/getZyInfoById',
				method : 'get',
				timeout : 0,
				dataType : 'json',
				data : {
					values : {
						"random_num" : creatRandomNum(),
						"zy_id" : api.pageParam.zy_id,
						"zy_type" :1,
						"p_type" : 2,
						"person_id":$api.getStorage("person_id"),
						"identity_id":$api.getStorage("identity")
					}
				},
				headers : {
		'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				api.hideProgress();
				if (err) {
					q_json_str = {"zy_info" : {"list":[]}};
				} else {
					if(ret.success){
						q_json_str = {"zy_info" : {"list":[],"zy_desc":ret.zy_info.zy_desc,"zy_question_ids":ret.zy_info.zy_question_ids,"zy_type":ret.zy_info.zy_type,"zy_name":ret.zy_info.zy_name,"zy_id":ret.zy_info.zy_id}};
						var  list = ret.zy_info.ques;
						if(list.length>0){
							for(var i = 0; i<list.length;i++){
								var oparam = new Object();
								oparam.list_length = list.length;
								oparam.question_id = -1;
								oparam.que_scores = list[i].que_scores;
								oparam.que_source = list[i].que_source;
								oparam.jy_subject_en_name = list[i].jy_subject_en_name;
								oparam.qt_type = list[i].qt_type;
								oparam.qt_id = list[i].qt_id;
								oparam.qt_id_pre = oparam.qt_id;
								oparam.sort = list[i].sort;
								oparam.qt_name = list[i].qt_name;
								oparam.question_id_char= list[i].question_id_char;
								oparam.jx_info = 0;
								//试题相关操作
								if(list[i].html_json){
									if(list[i].que_source == 1){
										//东师理想本地试题
											oparam.html_json={};
											var question_title = Base64.decode(list[i].html_json.question_title);
											var key = '/dsideal_yy';
											var key_re = BASE_URL_ACTION;
											oparam.html_json.question_title = question_title;
											if(oparam.html_json.question_title.indexOf(key_re) == -1){
											 oparam.html_json.question_title = question_title.replaceAll(key, key_re);
											}
											var question_analysis=Base64.decode(list[i].html_json.question_analysis);
											oparam.html_json.question_analysis = question_analysis;
											if(oparam.html_json.question_analysis.indexOf(key_re) == -1){
											 oparam.html_json.question_analysis = question_analysis.replaceAll(key, key_re);
											}
											oparam.html_json.question_analysis = oparam.html_json.question_analysis == ""?"略":oparam.html_json.question_analysis;
											oparam.html_json.question_answer= Base64.decode(list[i].html_json.question_answer);
											if(oparam.html_json.question_answer.indexOf(key_re) == -1){
											 oparam.html_json.question_answer= Base64.decode(list[i].html_json.question_answer).replaceAll(key, key_re);
											}
											if(list[i].html_json.quetionOption != ''){
												var count_length = count(list[i].html_json.quetionOption);
												oparam.html_json.question_answer_length = count_length;
												oparam.html_json.quetionOption=JSON.parse(commonQuetionOption(count_length,JSON.stringify(list[i].html_json.quetionOption),key,key_re));
												oparam.html_json.question_answer_first = JSON.parse(commonQuetionOptionFirst(count_length))
											}else{
												oparam.html_json.question_answer_length = 0;
											}
										}else{
											//菁优网试题
											oparam.qt_id = list[i].html_json.Cate;
											oparam.html_json={};
											
                                            oparam.html_json.question_answer_nottag = list[i].html_json.Answers.join("");
											if (oparam.html_json.question_answer_nottag == "对" ||
												oparam.html_json.question_answer_nottag == "正确" ){
												oparam.html_json.question_answer_nottag = "√";
											}
											if (oparam.html_json.question_answer_nottag == "错" ||
												 oparam.html_json.question_answer_nottag == "错误"){
												oparam.html_json.question_answer_nottag = "×";
											}
                                            
											oparam.html_json.Method= list[i].html_json.Method;
											oparam.html_json.Answers= list[i].html_json.Answers;
											oparam.html_json.Topics= list[i].html_json.Topics;
											oparam.html_json.Analyse= list[i].html_json.Analyse;
											oparam.html_json.Content= list[i].html_json.Content;
											oparam.html_json.Discuss= list[i].html_json.Discuss;
											oparam.html_json.Options= list[i].html_json.Options;
											oparam.html_json.Options_first = JSON.parse(commonQuetionOptionFirst(list[i].html_json.Options.length));
											oparam.html_json.Points= list[i].html_json.Points;
											oparam.html_json.Label= list[i].html_json.Label;
											
                                            if (oparam.qt_id_pre == 26){
												if (parseInt(list[i].html_json.Answers[0]) != list[i].html_json.Answers[0]){
													oparam.html_json.question_answer_nottag = list[i].html_json.Answers.join(" ");
												}else{
													oparam.html_json.question_answer_nottag = "";
													for (var m = 0; m < list[i].html_json.Answers.length; m++){
														oparam.html_json.question_answer_nottag += oparam.html_json.Options_first[list[i].html_json.Answers[m]];
													}
												}											
											}
										}
									}else{
										oparam.html_json = list[i].html_json;
									}
								q_json_str.zy_info.list.push(oparam);
							}
						}
					}else{
						api.hideProgress();
						q_json_str = {"zy_info" : {"list":[]}};
					}
				}
				//重写页面
				reWriteQuestion(q_cur_num);
			});
		}
		/*
		*author:zhaoj
		*function:获取对象长度
		*date：20160406
		*/
		function count(o){
		    var t = typeof o;
			if(t == 'object'){
	            var n = 0;
	            for(var i in o){
	                    n++;
	            }
		    }
		    return n;
		}; 
		/*
		*author:zhaoj
		*function:选择题样式判断 
		*date：20160407
		*/
		function selectedClass(qt_name,qt_id,question_id,answer,qt_type,sort,question_id_char,isAudio,que_source,jy_subject_en_name,self){
			if(!api.pageParam.is_stop && i_id != 7){
				if($api.hasCls(self, 'active')){
					cancel_answer = true;//取消答案
					$api.removeCls(self, 'active');
					if(isAudio == 1){
						var stu_answer = '';
						if(stuAnswer != stu_answer){
							var answer_json={"qt_id":qt_id,"qt_name":qt_name,"question_id":question_id,"stu_answer":stu_answer,"qt_type":qt_type,"sort":sort,"question_id_char":question_id_char,"que_source":que_source,"jy_subject_en_name":jy_subject_en_name,"type":3,"voice_duration":0};
                        	questionSubmit(answer_json);
							stuAnswer='';
						}
					}
				}else{
					if(isAudio == 1){
						var dlArray = $api.domAll($api.byId('j_option'),'dl');
						for(var i = 0 ;i < dlArray.length; i++){
							$api.removeCls(dlArray[i], 'active');
						}
						$api.addCls(self, 'active');
						var stu_answer = answer;
						if(stuAnswer != stu_answer){
							 var answer_json={"qt_id":qt_id,"qt_name":qt_name,"question_id":question_id,"stu_answer":stu_answer,"qt_type":qt_type,"sort":sort,"question_id_char":question_id_char,"que_source":que_source,"jy_subject_en_name":jy_subject_en_name,"type":1,"voice_duration":0};   							questionSubmit(answer_json);
						}
					}else{
						$api.addCls(self, 'active');
					}
				}
			}
		}
		/*
		*author:zhaoj
		*function:选择题已选答案数量
		*date：20160407
		*/
		function activeCount(){
			var activeCount = 0;
			var dlArray = $api.domAll($api.byId('j_option'),'dl');
			for(var i = 0; i <dlArray.length;i++){
				if($api.hasCls(dlArray[i], 'active')){
					activeCount++;
				}
			}
			return activeCount;
		}
		/*
		*author:zhaoj
		*function:多选题目提交
		*date：20160407
		*/
		function multiselectSubmit(qt_id,qt_name,question_id,qt_type,sort,question_id_char,type,que_source,jy_subject_en_name){
			var stu_answer='';
			var answers_array = ['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];
			var dlArray = $api.domAll($api.byId('j_option'),'dl');
			for(var i = 0; i <dlArray.length;i++){
				if($api.hasCls(dlArray[i], 'active')){
					if(que_source == 1){
                        stu_answer = stu_answer+answers_array[i];
                    }else{
                        stu_answer = stu_answer+i;
                    }
				}
			}
			if(stuAnswer != stu_answer || type == 4 || type == 2){
				var answer_json={"qt_id":qt_id,"qt_name":qt_name,"question_id":question_id,"stu_answer":stu_answer,"qt_type":qt_type,"sort":sort,"question_id_char":question_id_char,"que_source":que_source,"jy_subject_en_name":jy_subject_en_name,"type":type,"voice_duration":0};   							
            	questionSubmit(answer_json);  
			}else{
				if(type==1){
					enterNextQuestion();
				}else if(type == 0){
					enterPreQuestion();
				}
			}
		}
		 /*
        *author:zhaoj
        *function:题目提交
        *param:type=2/3/4的时候，是取消答案的时候
        *date：20160407
        */
        function questionSubmit(answer_json){
            commonGetStudentInfoByParentId(p_id, i_id, function(is_true, stu_info_json){
                if(is_true) {
                    api.ajax({
                        url : BASE_URL_ACTION + '/xx/submitAnswer',
                        method : 'post',
                        timeout : 0,
                        dataType : 'json',
                        data : {
                            values : {
                                "random_num" : creatRandomNum(),
                                "student_id" : stu_info_json.student_id,
                                "zy_id" : api.pageParam.zy_id,
                                "question_id" : answer_json.question_id,
                                "qt_type" : answer_json.qt_type,
                                "stu_answer" : answer_json.stu_answer,
                                "sort" : answer_json.sort,
                                "qt_name" :answer_json.qt_name,
                                "qt_id" : answer_json.qt_id,
                                "question_id_char" :answer_json.question_id_char,
                                "que_source":answer_json.que_source,
                                "jy_subject_en_name":answer_json.jy_subject_en_name,
                                "identity_id":$api.getStorage("identity")
                            }
                        },
                        headers : {
                'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
            }
                    }, function(ret, err) {
                    	var type = answer_json.type;
                    	var qt_type = answer_json.qt_type;
                        if (err) {
                            if(type == 2 || type == 3 || type == 4){
                                popToast('网络繁忙，请稍候再试。');
                            }else{
                                popToast('网络繁忙，请再一次点击该题目答案。');
                            }
                        } else {
                            if(ret.success){
                                if(qt_type == 1){
                                    setTimeout(function(){
                                        if(type==1){
                                            enterNextQuestion();
                                        }else if(type == 0){
                                            enterPreQuestion();
                                        }else if(type == 2){
                                            openScantronWin();
                                        }else if(type == 3){
                                            is_scan = true;//单选题时，是否进入答题卡页面
                                        }else{
                                            api.execScript({
                                                name : 'zuoyeXsJy_write_window',
                                                script :'getStudentZyProgress();'
                                            });
                                        }
                                    },100);
                                }else{
                                	var stu_answer = JSON.parse(answer_json.stu_answer);
                                	if(stu_answer.ext == -1){
                                		api.hideProgress();
                                		popToast('保存成功');
                                	}
                                }
                            }else{
                                if(type == 2 || type == 3 || type == 4){
                                    popToast('网络繁忙，请稍候再试。');
                                }else{
                                    popToast('网络繁忙，请再一次点击该题目答案。');
                                }
                            }
                        }
                    });
                } else {
                    popToast(stu_info_json);
                }   
            });
        }
		/*
		*author:zhaoj
		*function:上传答案
		*date：20160220
		*/
		function uploadAnswers(){
			if(showTip()){
        		return;
        	}
			api.actionSheet({
			    cancelTitle: '取消',
			    buttons: ['图片','拍照'],
			    style:{
			    	titleFontColor:'#ff0000'
			    }
			},function( ret, err ){
			    if( ret ){
			         if(ret.buttonIndex == 1){
			         	//相册
			         	getAlbum();
			         }else if(ret.buttonIndex == 2){
			         	//拍照
			         	getpicture();
			         }
//			         else if(ret.buttonIndex == 3){
//			         	//录音
//			         	startRecord();
//			         }
			    }else{
					popToast('网络繁忙，请稍候上传答案。');
			    }
			});
		}
		/*
		 *author:zhaoj
		 *function:选择图片
		 *date：20160225
		 */
		function getAlbum() {
			//var dlArray = $api.domAll($api.byId('j_files'), '.j_file');
			var num = 10-answers_count;
			            if(num != 0){
                UIAlbumBrowser.open(num,function(data){
                    //递归上传图片
                    commonUiUploadFiles({"data":data,"is_trans":1}, function(ret_data) {
                        for(var i = 0; i < ret_data.length; i++){
                            var json_data = JSON.parse(ret_data[i]);
                            var file_id = json_data.file_id;
                            var ext = json_data.ext;
                            var param_json = getParamJson({"file_id" : file_id,"resource_format" : ext, "is_show_tip":0,"type":0,"voice_duration":0});
                                //上传到资源库中
                            insertResourceBaseInfo(param_json);
                        }
                    });
                });
            }else{
                popToast('最多上传10张图片');
            }
//			obj_scan.open({
//				//返回的资源种类,picture（图片）,video（视频）,all（图片和视频）
//				type : 'picture',
//				//（可选项）图片显示的列数，须大于1
//				column : 4,
//				max : num,
//				rotation : true,
//              showPreview : false,
//              showBrowser : true,
//				//（可选项）图片排序方式,asc（旧->新）,desc（新->旧）
//				sort : {
//					key : 'time',
//					order : 'desc'
//				},
//				//（可选项）模块各部分的文字内容
//				texts : {
//					stateText : '已选择*项',
//					cancelText : '取消',
//					finishText : '完成'
//				},
//				styles : {
//					bg : '#fff',
//					mark : {
//						icon : '',
//						position : 'bottom_right',
//						size : 20
//					},
//					nav : {
//						bg : '#eee',
//						stateColor : '#000',
//						stateSize : 18,
//						cancleBg : 'rgba(0,0,0,0)',
//						cancelColor : '#000',
//						cancelSize : 18,
//						finishBg : 'rgba(0,0,0,0)',
//						finishColor : '#000',
//						finishSize : 18
//					}
//				},
//				rotation : true,
//              showPreview : false,
//              showBrowser : true
//			}, function(ret) {
//				if (ret) {
//					if (getJsonObjLength(ret.list) != 0) {
//						//递归上传图片
//						dgUploadFiles(0, ret.list, function(is_true) {
//							if (is_true) {
//								api.hideProgress();
//								//								popToast("上传成功");
//							} else {
//								popToast("服务器繁忙，请稍候再试");
//							}
//						});
//					}
//				}
//			});
		}

		/**
		 * 递归上传图片
		 * 周枫
		 * 2016.3.28
		 */
		function dgUploadFiles(p_c, pic_list, callback) {
			var pic_l = getJsonObjLength(pic_list);
			if (p_c < pic_l) {
				var pic_url_old = pic_list[p_c].path;
				if (api.systemType == 'ios') {
					//将相册图片地址转换为可以直接使用的本地路径地址
					obj_scan.transPath({
						path : pic_url_old
					}, function(ret) {
						var pic_url_new = ret.path;
						commonUploadFiles(pic_url_new, function(is_true, a_file_id, a_ext) {
							if (is_true) {
								var param_json = getParamJson({"file_id" : a_file_id,"resource_format" : a_ext, "is_show_tip":0,"type":0,"voice_duration":0});
                                //上传到资源库中
                                insertResourceBaseInfo(param_json);
								p_c++;
								return dgUploadFiles(p_c, pic_list, callback);
							} else {
								return dgUploadFiles(p_c, pic_list, callback);
							}
						},1);
					});
				} else {
					commonUploadFiles(pic_url_old, function(is_true, a_file_id, a_ext) {
						if (is_true) {
							var param_json = getParamJson({"file_id" : a_file_id,"resource_format" : a_ext, "is_show_tip":0,"type":0,"voice_duration":0});
                            //上传到资源库中
                            insertResourceBaseInfo(param_json);
							p_c++;
							return dgUploadFiles(p_c, pic_list, callback);
						} else {
							return dgUploadFiles(p_c, pic_list, callback);
						}
					},1);
				}
			} else {
				callback(true);
			}
		}
		/**
		 * 获取头像
		 * 周枫
		 * 2016.1.16
		 */
		function getpicture() {
		    getPicture.open({"type":1},function(data){
                //递归上传图片
                commonUiUploadFiles({"data":data,"is_trans":0}, function(ret_data) {
                    for(var i = 0; i < ret_data.length; i++){
                        var json_data = JSON.parse(ret_data[i]);
                        var file_id = json_data.file_id;
                        var ext = json_data.ext;
                        var param_json = getParamJson({"file_id" : file_id,"resource_format" : ext, "is_show_tip":0,"type":0,"voice_duration":0});
                        //上传到资源库中
                        insertResourceBaseInfo(param_json);
                    }
                });
            });
		}
		/*
		*author:zhaoj
		*function:从在线作答传递过来的图片路径
		*date：20170601
		*/
		function getDrawingBoardImgPath(absolutePath){
			uploadFile(absolutePath, 0,0,function(is_true){
				if (is_true) {
					api.hideProgress();
                    commonExecScript('zuoyeIpad_drawingBoard_window','','back();',0);
                    popToast("保存成功");
				} else {
					popToast("服务器繁忙，请稍候再试");
				}
			});
		}
		/*
		*author:zhaoj
		*function:音频和拍照的文件上传
		*date：20160407
		*/
		function uploadFile(file_url,type,voice_duration, callback){
            commonUploadFiles(file_url, function(is_true, a_file_id, a_ext) {
                if (is_true) {
                    if(type == 1){
                        addAppAnnex(a_file_id,voice_duration);
                    }else{
                        var param_json = getParamJson({"file_id" : a_file_id,"resource_format" : a_ext, "is_show_tip":0,"type":type,"voice_duration":voice_duration});
                        //上传到资源库中
                        insertResourceBaseInfo(param_json);
                        callback(true);
                    }
                } else {
                    return uploadFile(file_url,type,voice_duration, callback);
                }
            });
        }
		/*
		*author:zhaoj
		*function:删除具体某一个答案
		*date：20160407
		*/
		function deleteStuAnswer(file_id,type,e, parent, grandpa, self,ext){
			commonShowProgress('删除中...',true);
			api.ajax({
				url : BASE_URL_ACTION+'/xx/deleteStuAnswer',
				method : 'post',
				timeout : 0,
				dataType : 'json',
				data : {
					values : {
						"random_num" : creatRandomNum(),
						"file_id" : file_id
					}
				},
				headers : {
		'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				api.hideProgress();
				if (err) {
					popToast('删除失败，请重新删除');
				} else {
					if(ret.success){
						if(type == 1){
							 deleteImg(e, parent, grandpa, self);
						}else{
							var voice_url;
							if(BASE_APP_TYPE == 1){
								voice_url = madie_url+"/down/App/"+ file_id.substring(0, 2) + "/" + file_id + '.' + ext;
							}else{
								voice_url = BASE_URL_ACTION + "/html/thumb/App/" + file_id.substring(0, 2) + "/" + file_id + '.' + ext;
							}
							if(voice_url==is_play_voice){
								deleteVoice(e, parent, grandpa,grandfather, self,1); 
							}else{
								deleteVoice(e, parent, grandpa,grandfather, self,0); 
							}
						}
					}else{
						popToast('删除失败，请重新删除');
					}
				}
			});
			e.stopPropagation();
		}
		/*
        *author:zhaoj
        *function:弹出Toast提示框
        *date：20160407
        */
		function getAnswerByStuZyQueId(question_id,question_id_char,que_source,jy_subject_en_name){
            commonGetStudentInfoByParentId(p_id, i_id, function(is_true, stu_info_json){
                if(is_true) {
                    api.ajax({
                        url : BASE_URL_ACTION+'/xx/getAnswerByStuZyQueId',
                        method : 'get',
                        timeout : 30,
                        dataType : 'json',
                        data : {
                            values : {
                                "random_num" : creatRandomNum(),
                                "zy_id" : api.pageParam.zy_id,
                                "student_id" : stu_info_json.student_id,
                                "question_id" : question_id,
                                "question_id_char" :question_id_char,
                                "is_need_html" :0,
                                "p_type":2,
                                "que_source":que_source,
                                "jy_subject_en_name":jy_subject_en_name
                            }
                        }
                    }, function(ret, err) {
                        if(err) {
                            popToast('您作答的答案获取失败，请稍候再试！');
                        } else {
                            if(ret) {
                                if(ret.success){
                                    if(api.pageParam.is_stop){
                                        //检测已截止
                                        isStopShowStudentAnswer(ret);
                                    }else{
                                        //检测未截止
                                        if(ret.qt_type == 1){
                                            //客观题
                                            var dlArray = $api.domAll($api.byId('j_option'),'dl');
                                            var stuAnswerArray;//学生作答的答案
                                            if(ret.stu_answer == "正确" || ret.stu_answer == "错误" || ret.stu_answer == "√" || ret.stu_answer == "×"){
                                                //判断题
                                                stuAnswerArray = [ret.stu_answer];
                                            }else{
                                                stuAnswerArray = ret.stu_answer.split("");  
                                            }
                                            stuAnswer=ret.stu_answer;
                                            for(var i = 0 ;i < stuAnswerArray.length; i++){
                                                for(var j = 0 ;j < dlArray.length; j++){
                                                    var answerOption = dlArray[j].getAttribute("answerOption");
                                                    if(stuAnswerArray[i]==answerOption || String.fromCharCode(65 + parseInt(stuAnswerArray[i]))==answerOption){
                                                        $api.addCls(dlArray[j], 'active');
                                                    }
                                                }
                                            }
                                        }else{
                                            //主观题
                                            $api.text($api.byId('j_zg_answers'), '');
                                            var answer_list = ret.stu_answer;
                                            stuAnswer=ret.stu_answer;
                                            //文本答案
                                            $api.val($api.byId('j_textarea'),ret.stu_answer_txt);
                                            for(var i = 0; i < answer_list.length; i++){
                                            	answer_list[i].resource_format = answer_list[i].ext;
                                            	if(answer_list[i].resource_id_int > 0){
                                                	
                                                	if(answer_list[i].resource_type == 1){
														//图片
														answer_list[i].type = 5;
													}else{
														//其他格式
	                                            		answer_list[i].type = 3;
	                                            	}
                                                }else{
                                                	answer_list[i].type = 4;
                                                }
                                                showImg(answer_list[i]);
                                            }
                                        
                                        }
                                    }
                                }else{
                                    stuAnswer='';
                                    judgeLength(0);
                                }
                            } else {
                                popToast('您作答的答案获取失败，请稍候再试！');
                            }
                        }
                    });
                } else {
                    popToast(stu_info_json);
                }   
            });
        }
		/*
		*author:zhaoj
		*function:检测截止时，显示学生作答，并判断他们答案对错
		*date：20160407
		*/
		function isStopShowStudentAnswer(ret){
			if(ret.qt_type == 1){
				api.hideProgress();
				//客观题
				var dlArray = $api.domAll($api.byId('j_option'),'dl');
				var stuAnswerArray;//学生作答的答案
				var rightArray;
				if(ret.stu_answer == "正确" || ret.stu_answer == "错误" || ret.stu_answer == "√" || ret.stu_answer == "×"){
					//判断题
					stuAnswerArray = [ret.stu_answer];
					rightArray = [ret.right_answer];
				}else{
					stuAnswerArray = ret.stu_answer.split("");	
					rightArray = ret.right_answer.split("");
				}
				var stuAnswerLast=[];
				var stuAnswerRight=[];
				for(var i =0; i<stuAnswerArray.length;i++){
					var count = 0;
					for(var j=0; j<rightArray.length;j++){
						if(stuAnswerArray[i]==rightArray [j]){
							count++;
						}
					}
					if(count == 0){
						stuAnswerLast.push(stuAnswerArray[i]);
					}else{
						stuAnswerRight.push(stuAnswerArray[i]);
					}
				}
				for(var i=0; i <dlArray.length;i++){
					var answerOption = dlArray[i].getAttribute("answerOption");
					for(var j = 0; j<stuAnswerLast.length;j++){
						if(answerOption == stuAnswerLast[j]){
							$api.addCls(dlArray[i], 'wrong');
							if(answerOption == "正确" || answerOption == "√"){
								$api.css($api.byId('j_wrong_1'),'display:inline-block');
							}else if(answerOption == "错误" || answerOption == "×"){
								$api.css($api.byId('j_wrong_2'),'display:inline-block');
							}else{
								$api.css($api.byId('j_wrong_'+answerOption),'display:inline-block');
							}
						}
					}
					for(var k = 0; k<stuAnswerRight.length;k++){
						if(answerOption == stuAnswerRight[k]){
							$api.addCls(dlArray[i], 'right');
							if(answerOption == "正确" || answerOption == "√"){
								$api.css($api.byId('j_right_1'),'display:inline-block');
							}else if(answerOption == "错误"|| answerOption == "×"){
								$api.css($api.byId('j_right_2'),'display:inline-block');
							}else{
								$api.css($api.byId('j_right_'+answerOption),'display:inline-block');
							}
						}
					}
				}
			}else{
				//主观题
				$api.text($api.byId('j_zg_answers'), '');
                var answer_list = ret.stu_answer;
                stuAnswer=ret.stu_answer;
                //文本答案
                $api.val($api.byId('j_textarea'),ret.stu_answer_txt);
                for(var i = 0; i < answer_list.length; i++){
                	answer_list[i].resource_format = answer_list[i].ext;
                	if(answer_list[i].resource_id_int > 0){
                    	if(answer_list[i].resource_type == 1){
							//图片
							answer_list[i].type = 5;
						}else{
							//其他格式
                    		answer_list[i].type = 3;
                    	}
                    }else{
                    	answer_list[i].type = 4;
                    }
                    showImg(answer_list[i]);
                }
			}
		}
		/*
		*author:zhaoj
		*function:menu页面点击提交时，进行多选提交
		*date：20160419
		*/
		function menuSubmit(){
			if(((que_source == 1 && (qt_id == 8 || qt_id == 26)) || (que_source == 2 && qt_id == 3))&&is_html){
				var questionID = $api.byId('j_multiselect').getAttribute("questionID");
				var sort = $api.byId('j_multiselect').getAttribute("sort"); 
				var questionIDChar = $api.byId('j_multiselect').getAttribute("questionIDChar"); 
				var qtName = $api.byId('j_multiselect').getAttribute("qtName"); 
				var qtID = $api.byId('j_multiselect').getAttribute("qtID");
				var queSource = $api.byId('j_multiselect').getAttribute("queSource");
				var jySubjectEnName = $api.byId('j_multiselect').getAttribute("jySubjectEnName");
				multiselectSubmit(qtID ,qtName,questionID,1,sort,questionIDChar,4,queSource,jySubjectEnName);
			}else{
				api.execScript({
					name : 'zuoyeIpad_write_window',
					script :'getStudentZyProgress();'
				});
			}
		}
		/*
		*author:zhaoj
		*function:查看微课
		*date：20160412
		*/
		function isShowWk(question_id,question_id_char,que_source,zy_id){
			api.ajax({
				url : BASE_URL_ACTION + '/xx/checkQuestionWeike',
				method : 'post',
				timeout : 30,
				dataType : 'json',
				returnAll : false,
				data : {
					values : {
						"random_num" : creatRandomNum(),
						"question_id_char":question_id_char,
						"que_source":que_source,
						"zy_id":zy_id
					}
				}
			}, function(ret, err) {
				if (err) {
					$api.css($api.byId('j_wk_title'),'display:none;');
					$api.css($api.byId('wklist_div'),'display:none;');
				} else {
					if(ret.success){
						loadData(question_id,question_id_char,zy_id);
						$api.css($api.byId('j_wk_title'),'display:block;');
						$api.css($api.byId('wklist_div'),'display:block;');
					}else{
						$api.css($api.byId('j_wk_title'),'display:none;');
						$api.css($api.byId('wklist_div'),'display:none;');
					}
				}
			});
		}
		/**
		 * 加载数据
		 * 周枫
		 * 2016.4.15
		 */
		function loadData(question_id,question_id_char,zy_id) {
			api.ajax({
				url : $api.getStorage('BASE_URL_ACTION') + '/xx/getQuestionWeike',
				method : 'post',
				timeout : 30,
				dataType : 'json',
				data : {
					values : {
						"question_id_char":question_id_char,
						"zy_id":zy_id
					}
				}
			}, function(ret, err) {
				if(err) {
					api.toast({
	                    msg:'获取微课列表失败'
                    });
                    
				} else {
					if(ret.success) {
						var wk_list = ret.wkdetail_list;
						var wk_list_l = getJsonObjLength(wk_list);
						if (wk_list_l > 0) {
							for (var i = 0; i < wk_list_l; i++) {
								var wk_thumb_id = wk_list[i].thumb_id;
//								var wk_thumb_id = '8E75B87E-68AC-4ACA-87EE-988207BE549C';
								var wk_thumb_url = '';
								if (BASE_APP_TYPE == 1) {
									//https://dsideal.obs.cn-north-1.myhuaweicloud.com/down/Thumbs/8E/8E75B87E-68AC-4ACA-87EE-988207BE549C.thumb
									wk_thumb_url = url_path + BASE_THUMB_BEGIN + wk_thumb_id.substring(0, 2) + '\/' + wk_thumb_id + BASE_THUMB_END;
								} else {
									wk_thumb_url = BASE_URL_ACTION + BASE_THUMB_BEGIN + wk_thumb_id.substring(0, 2) + '\/' + wk_thumb_id + BASE_THUMB_END;
								}
								wk_list[i]["wk_thumb_url"] = wk_thumb_url;
							}
						}
						var html_type = template.render('wklist_script', ret);
						document.getElementById('wklist_div').innerHTML = html_type;
						
						//延迟加载图片
						setTimeout(function() {
							echoInit();
						}, 300);
						
					} else {
						api.toast({
		                    msg:'获取微课列表失败'
	                    });
					}
				}
				//通知顶部下拉刷新数据加载完毕，组件会恢复到默认状态
						commonControlRefresh();
			});
		}
		/**
		 * 打开内容页面
		 * 周枫
		 * 2015.12.17
		 */
		function openWeikeContent(wk_id, wk_name, is_phone_wk, phone_wk_file_id) {
			//先重置通知window返回哪个页面
			commonExecScript('zuoyeIpad_write_window','','reBackType("content");',0);
			var header_h = api.pageParam.header_h;
			var pageParamJson={"header_h":api.pageParam.header_h,wk_id : wk_id,is_phone_wk : is_phone_wk,phone_wk_file_id : phone_wk_file_id};//打开frame页面所需参数
			commonOpenFrame("common_weike_frame","widget://html/common/common_weike_frame.html",header_h,false,false,"#ffffff",pageParamJson);//打开index页面
		}
		/*
		*author:zhaoj
		*function:查看解析
		*date：20160414
		*/
		function viewAnalysis(sort,question_id_char,que_source,jy_subject_en_name){
			showSelfProgress('获取解析中...');
			api.ajax({
				url : $api.getStorage('BASE_URL_ACTION') + '/xx/getQueHtmlInfo?random_num='+creatRandomNum()+'&question_id_char='+question_id_char+'&que_source='+que_source+'&person_id='+$api.getStorage("person_id")+'&identity_id='+$api.getStorage("identity")+'&jy_subject_en_name='+jy_subject_en_name,
				method : 'get',
				timeout : 30,
				dataType : 'json'
			}, function(ret, err) {
				api.hideProgress();
				if(err) {
					popToast('获取解析失败，请稍候再试');
				} else {
					if(ret.success) {
						if(que_source == 2){
							if(ret.html_json.Method){
								q_json_str.zy_info.list[sort-1].jx_info = ret.html_json.Method;
							}else{
								q_json_str.zy_info.list[sort-1].jx_info = "略";
							}
						}else{
							q_json_str.zy_info.list[sort-1].jx_info = Base64.decode(ret.html_json.question_analysis);
						}	
						var key = '/dsideal_yy';
                        var key_re = BASE_URL_ACTION;
                        q_json_str.zy_info.list[sort-1].jx_info = q_json_str.zy_info.list[sort-1].jx_info.replaceAll(key, key_re);
                        q_json_str.zy_info.list[sort-1].jx_info = q_json_str.zy_info.list[sort-1].jx_info == ""?"略":q_json_str.zy_info.list[sort-1].jx_info;
						$api.css($api.byId('j_jx_btn'),'display:none');
						$api.html($api.byId('j_analysis'),q_json_str.zy_info.list[sort-1].jx_info);
						$api.css($api.byId('j_analysis'),'display:block');
						$api.css($api.byId('j_analysis_title'),'display:block');
					} else {
						popToast('获取解析失败，请稍候再试');
					}
				}
			});
		}
		/*
		*author:zhaoj
		*function:打开手写板页面
		*date：20170531
		*/
		function openDrawDoardFrame(){
			if(showTip()){
        		return;
        	}
			commonOpenWin('zuoyeIpad_drawingBoard_window', 'zuoyeIpad_drawingBoard_window.html', false, false, {'header_h':api.pageParam.header_h,"stem":question_title_base64})
		}
		/*
        *author:zhaoj
        *function:打开录视频页面
        *date：20170831
        */
        function openRecordWindow(){
        	if(showTip()){
        		return;
        	}
        	commonModuleDemo({"time":10},function(path){
	        	saveVedio(path);
	        });
//      	var params = {
//				winName:'zuoyeIpad_write_window',
//				frameName:'zuoyeIpad_write_frame',
//				backFun:'saveVedio',
//				name:'common_record_window'
//			};
//      	commonOpenAssembly(params);
        }
        /*
        *author:zhaoj
        *function:根据条件进行提示
        *date：20170904
        */
        function showTip(){
        	var flag = false;
        	if($api.getStorage('identity') == 7){
        		popToast('家长不能上传答案');
        		flag = true;
        	}else{
        		if(api.pageParam.is_stop){
        			popToast('检测已截止，不能上传答案');
        			flag = true;
        		}else{
        			if(answers_count == 10){
		        		popToast('最多上传十个附件');
		        		flag = true;
		        	}
        		}
        	}
        	return flag;
        }
        /*
        *author:zhaoj
        *function:打开录音频页面
        *date：20170831
        */
        function openAudioWindow(){
        	if(showTip()){
        		return;
        	}
            var params = {
				winName:'zuoyeIpad_write_window',
				frameName:'zuoyeIpad_write_frame',
				backFun:'uploadAmr',
				name:'common_audio_window'
			};
        	commonOpenAssembly(params);
        }
        /*
        *author:zhaoj
        *function:上传音频
        *date：20170901
        */
        function uploadAmr(path,voice_duration){
            uploadFile(path,1,voice_duration, function(is_true){
				if (is_true) {
					api.hideProgress();
				} else {
					popToast("服务器繁忙，请稍候再试");
				}
			});
        }
        /*
        *author:zhaoj
        *function:上传视频
        *date：20170901
        */
        function saveVedio(path){
        	uploadFile(path,2,0, function(is_true){
				if (is_true) {
					api.hideProgress();
				} else {
					popToast("服务器繁忙，请稍候再试");
				}
			});
        }
        /*
        *author:zhaoj
        *function:将音频文件转换成mp3格式
        *date：20170901
        */
        function addAppAnnex(file_id,voice_duration){
            api.ajax({
                url : BASE_URL_ACTION+'/dsjxt/addAppAnnex',
                method : 'post',
                timeout : 30,
                dataType : 'json',
                data : {
                    values : {
                        "file_id" : file_id,
                        "extension" : 'amr',
                        "person_id" : $api.getStorage("person_id"),
                        "identity_id" : $api.getStorage('identity'),
                        "duration" : voice_duration
                    }
                }
            }, function(ret, err) {
                api.hideProgress();
                if(err){
                    popToast('上传音频答案失败，请重新上传');
                }else{
                    if(ret.success){
                        var param_json = getParamJson({"file_id" : file_id,"resource_format" : 'mp3', "is_show_tip":0,"type":1,"voice_duration":voice_duration});
                        //上传到资源库中
                        insertResourceBaseInfo(param_json);
                    }else{
                        popToast('上传音频答案失败，请重新上传');
                    }
                }
            });
        }
        /*
        *author:zhaoj
        *function:上传音频、视频、图片的缩略图
        *date：20170901
        */
        function showImg(img_json){
            var img_url;//缩略图路径
            if(img_json.type == 0|| img_json.type == 5){
                //图片
                if (BASE_APP_TYPE == 1) { 
                    img_url = BASE_IMAGE_PRE + url_path_suffix + img_json.file_id.substring(0, 2) + '\/' + img_json.file_id + '.' + img_json.resource_format + commonReturnPhotoCutSize(0);
                } else {
                    img_url = BASE_URL_ACTION + BASE_IMAGE_BEGIN + img_json.file_id.substring(0, 2) + '/' + img_json.file_id + '.' + img_json.resource_format + commonReturnPhotoCutSize(0);
                }
            }else if(img_json.type == 1){
                //音频
                img_url = "../../../../../image/fun-module/iphone/zuoye/audio.png";
            }else if(img_json.type == 2){
                //视频
                img_url = "../../../../../image/fun-module/iphone/zuoye/player.png";
            }else if(img_json.type == 3){
            	//资源库中的缩略图
                if (BASE_APP_TYPE == 1) {
					img_url = url_path + BASE_THUMB_BEGIN + img_json.thumb_id.substring(0, 2) + '\/' + img_json.thumb_id + BASE_THUMB_END;
				} else {
					img_url = BASE_URL_ACTION + BASE_THUMB_BEGIN + img_json.thumb_id.substring(0, 2) + '/' + img_json.thumb_id + BASE_THUMB_END;
				}
			}else{
				//之前上传的答案图片
				 if (BASE_APP_TYPE == 1) {
					img_url = BASE_IMAGE_PRE+"down/App/"+ img_json.file_id.substring(0, 2) + "/" + img_json.file_id + '.' + img_json.resource_format + commonReturnPhotoCutSize(0);
				} else {
					img_url = BASE_URL_ACTION + "/html/thumb/App/" + img_json.file_id.substring(0, 2) + "/" + img_json.file_id + '.' + img_json.resource_format + commonReturnPhotoCutSize(0);
				}
			}
            //
            var deleteHtml = "deleteStuAnswer('"+img_json.file_id+"',1,event,this.parentNode,this.parentNode.parentNode,this,'"+img_json.resource_format+"')";
            var openHtml = "openAnswer('"+img_json.resource_id_int+"','"+img_url+"','"+ img_json.resource_info_id+"')";
            var mr_picture = "this.src='../../../../../image/fun-module/common/wk_default_square.png'";
            var li_html = '<li class="fl" onclick="'+openHtml+'">';
            	if(img_json.type == 2){
            		//视频默认图片
            		li_html +='<div class="zoomImage" style="background:#141414 url('+img_url+') center center no-repeat;background-size:35% auto;"></div>';
            	}else{
                	li_html +='<div class="zoomImage"><img src="'+img_url+'" onerror="'+mr_picture+'" /></div>';
                }
//              li_html +='<div class="fj-name ellipsis">'+img_json.resource_title+'</div>';
                //截止的检测不能删除
                if(!api.pageParam.is_stop){
                	li_html +='<div class="delete" onclick="'+deleteHtml+'">&nbsp;</div>';
                }
                li_html +='</li>';
            $api.append($api.byId('j_zg_answers'), li_html);
            answers_count = answers_count + 1;
            judgeLength(answers_count);
            if(img_json.type < 3){zgtSaveAnswer(2,img_json)};
        }
	     /*
	     *author:zhaoj
	     *function:主观题保存答案
	     *date：20170904
	     */
        function zgtSaveAnswer(file_type,img_json){
        	//上传答案
            var answer_json={};//答案数据
            answer_json.question_id = -1;
			answer_json.sort = $api.byId('j_zg_answers').getAttribute("sort"); 
			answer_json.question_id_char = $api.byId('j_zg_answers').getAttribute("questionIDChar"); 
			answer_json.qt_name = $api.byId('j_zg_answers').getAttribute("qtName"); 
			answer_json.qt_id = $api.byId('j_zg_answers').getAttribute("qtID");
			answer_json.que_source = $api.byId('j_zg_answers').getAttribute("queSource");
			answer_json.jy_subject_en_name = $api.byId('j_zg_answers').getAttribute("jySubjectEnName");
			answer_json.qt_type = 2;
			answer_json.stu_answer = getAnswerInfo(file_type,img_json);
			answer_json.type = 1;
			answer_json.voice_duration = img_json.voice_duration;
			questionSubmit(answer_json);
        }
        /*
         *author:zhaoj
         *function:获取每一个主观题答案的具体
         *date：20160326
         */
        function getAnswerInfo(file_type,img_json){
            var stu_answer={};
            if(file_type == 2){
	            stu_answer.file_type=file_type;
	            stu_answer.file_id=img_json.file_id;
	            stu_answer.ext=img_json.resource_format;
	            stu_answer.file_path="";
	            stu_answer.covnert_file_path="";
	            stu_answer.voice_duration=img_json.voice_duration;
	            stu_answer.resource_type=img_json.resource_type;
	            stu_answer.resource_title=img_json.resource_title;
	            stu_answer.resource_id_int=img_json.resource_id_int;
	            stu_answer.resource_info_id=img_json.resource_info_id;
	        }else{
	        	var file_path = $api.val($api.byId('j_textarea'));
	        	file_path = $api.trim(file_path);
	        	file_path = commonRemoveHTMLTag(file_path);
	        	stu_answer.file_type=file_type;
	            stu_answer.file_id=-1;
	            stu_answer.ext=-1;
	            stu_answer.file_path=file_path;
	            stu_answer.covnert_file_path="";
	            stu_answer.voice_duration="";
		        showSelfProgress('保存中...');
	        }
            return JSON.stringify(stu_answer);
        }
        /*
        *author:zhaoj
        *function:获取到上传资源库中的参数
        *date：20170904
        */
        function getParamJson(param){
            var resource_format =param.resource_format;
            resource_format = resource_format.toLowerCase();
            var check_ext = support_extension.indexOf(resource_format);
            var m3u8_status;
            check_ext != "-1" ? m3u8_status = 1:m3u8_status=0;
            var param_json={
                "app_type_id" : 17,
                "beike_type" : 100,
                "bk_type_name" : -1,
                "file_id" : param.file_id,
                "group_id" : 2,
                "identity_id" : $api.getStorage('identity'),
                "m3u8_status" : m3u8_status,
                "person_id" : $api.getStorage("person_id"),
                "person_name" : Base64.encode($api.getStorage("person_name")),
                "res_type" : 35,
                "resource_format" : resource_format,
                "resource_title" : Base64.encode(param.file_id),
                "structure_id" : -1,
                "is_show_tip":param.is_show_tip,
                "type":param.type,//1:代表视频
                "voice_duration":param.voice_duration
            }
            return param_json;
        }
        /*
        *author:zhaoj
        *function:上传到资源库中
        *date：20170904
        */
        function insertResourceBaseInfo(param_json){
            commonInsertResourceBaseInfo(param_json,function(flag,ret){
                if(flag){
                    if(param_json.type != 0){popToast('保存成功')};
                    param_json.resource_id_int=ret.resource_id_int;
                    param_json.resource_info_id=ret.resource_info_id;
                    param_json.resource_title=ret.resource_title;
                    param_json.resource_type=ret.resource_detail.resource_type;
                    showImg(param_json);//显示缩略图
                    if(param_json.type == 1){
                        commonExecScript('common_audio_window','','back();',0);
                    }else if(param_json.type == 2){
                        commonExecScript('common_record_window','','back();',0);
                    }
                }else{
                	api.hideProgress();
                    popToast('上传答案失败，请重新上传');
                }
            });
        }
        /*
        *author:zhaoj
        *function:打开主观题答案
        *date：20170904
        */
        function openAnswer(resource_id_int,img_url,resource_info_id){
        	if(resource_id_int < 0){
        		common_openPicture.open(img_url,api.winName);
        	}else{
        		var param_json = {"is_show_tip":1,"resource_id_int":resource_id_int,"resource_info_id":resource_info_id};
        		commonGetResInfo(param_json,function(flag,ret){
        			api.hideProgress();
        			if(flag){
 						common_openResource.open(ret.resource_format,ret.file_id,ret.resource_title,ret.m3u8_status,api.winName,'reBackType("voice");','back();',ret.resource_id_int);
        			}else{
        				popToast('打开失败，请稍候重试');
        			}
        		});
        	}
        }
		
		function resultCallback(ret,err){
			if (ret){
				connect_state = ret.connect_state;
			}
			
			if (caution){
				if (connect_state){
					$api.addCls(caution, 'aui-hide');
				}else{
					$api.removeCls(caution, 'aui-hide');
				}
			}
		}
		
		function openSxb(){
			if (connect_state){
				openVertical()
			}else{
				openBleActivity();
			}
		}
		
		function openVertical(){
			handWriteBoard.openVertical(function (ret,err){
				if (ret && ret.handwrite_close){
				
					saveVedio(ret.filePath);
					
					var data = [{"path":ret.jpgPath}]
					//递归上传图片
	                commonUiUploadFiles({"data":data,"is_trans":0}, function(ret_data) {
	                    for(var i = 0; i < ret_data.length; i++){
	                        var json_data = JSON.parse(ret_data[i]);
	                        var file_id = json_data.file_id;
	                        var ext = json_data.ext;
	                        var param_json = getParamJson({"file_id" : file_id,"resource_format" : ext, "is_show_tip":0,"type":0,"voice_duration":0});
	                        //上传到资源库中
	                        insertResourceBaseInfo(param_json);
	                    }
	                });
				}
			});
		}
		
		function openBleActivity(){
			handWriteBoard.openBleActivity(function (ret){
			});
		}
	</script>
</html>