<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>检测</title>
    <link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
    <link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
    <style>
    	body{margin:0;padding-bottom:60px;}
    	.clearfix:after{content: ' ';display: block;clear: both;visibility: hidden;line-height: 0;height: 0;}
    	.plr15{padding:0 15px;}
    	.plr30{padding:0 30px;}
    	.title{height:55px;line-height:55px;color:#606060;}
    	.question-item ul li{float:left;}
    	.question-item ul li div{margin:0 auto;text-align:center;}
    	.question-item ul li div.active{color:#ffffff;background-clip:padding-box;}
		.footer-btn {display: block;bottom: 0px;width: 100%;height:45px;text-align: right;color: #fff;padding-top: 5px;border-top: 1px solid #e0e0e0;position: fixed;background:#fff;z-index:999;}
		.footer-btn button{float:right;margin-right:15px;}
		.content-div{padding-bottom:60px;}
    </style>
</head>
<body class="common-iphone-daoxueNewXs">
	<div class="content-div clearfix">
		<!--主观题-->
		<div id="kg_title" class="title plr15">题号</div>
		<div class="question-item plr30">
			<ul id="objective">
			</ul>
		</div>
		<!--//主观题-->
	</div>
	<!--//客观题-->
	<div id="j_footer" class="footer-btn" style="display:none;">
		<button id="j_submit_btn" class="aui-btn aui-btn-info" onclick="submit();">
			提交
		</button>
		<button id="j_continue_btn" class="aui-btn aui-btn-success display-none" onclick="continueQuestion();">
			继续答题
		</button>
	</div>
</body>
<script type="text/javascript" src="../../../../../script/api.js"></script>
<script type="text/javascript" src="../../../../../script/base_config.js" ></script>
<script type="text/javascript" src="../../../../../script/plug-in/base64.js" ></script>
<script type="text/javascript" src="../../../../../script/common/common.js" ></script>
<script type="text/javascript">
	var no_answer_sort=0;//没有作答的最小的sort
	var answered_count=0;
	var answer_array=[];//记录答案的数组
	apiready = function(){	
		showSelfProgress('加载中...');
		commonSetTheme({"level":5,"type":0});
		answer_array = $api.strToJson(api.pageParam.answer_array);
		for(i = 0 ; i < answer_array.length; i++){
			if(typeof(answer_array[i]) == "string"){
				if(!isEmptyString(answer_array[i])){
					objective(i+1,1);
				}else{
					objective(i+1,0);
				}
			}else{
				if(isEmptyString(answer_array[i].text)&& answer_array[i].list.length == 0){
					objective(i+1,0);
				}else{
					objective(i+1,1);
				}
			}
		}
		//题目全都答完，不能显示继续答题按钮
		if(answer_array.length != answered_count){
			$api.removeCls($api.byId('j_continue_btn'),'display-none');
		}
		if(api.pageParam.is_submit || $api.getStorage('identity') == 7){
			$api.css($api.dom('.content-div'),"padding-bottom:0;");
		}else{
			$api.css($api.byId('j_footer'),"display:block;");
		}
		api.hideProgress();
	};
	/*
	*author:zhaoj
	*function:选项
	*date：20160329
	*/
	function objective(sort,is_answered){
		if(is_answered){
			uploadHtml('objective',sort,'active');
			answered_count++;
		}else{
			uploadHtml('objective',sort,'');
			if(no_answer_sort ==0){
				no_answer_sort = sort
			}else{
				if(sort<no_answer_sort){
					no_answer_sort = sort;
				}
			}
		}
	}
	/*
	*author:zhaoj
	*function:客观题和客观题选项添加到页面中
	*date：20160329
	*/
	function uploadHtml(divID,sort,css){
		var liWidth = Math.floor((api.frameWidth-60)/5);
		var liHeight = liWidth;
		var divWidth= Math.floor(liWidth*0.8);
		var divHeight = divWidth;
		var borderRad = Math.floor(divWidth*0.5);
		var checkHtml='checkQuestion('+sort+')';
		var liHtml = '<li style="width:'+liWidth+'px;height:'+liHeight+'px;" onclick='+checkHtml+'>';
			if(api.frameWidth>360){
				liHtml = liHtml+'<div class="'+css+'" style="max-width:48px;max-height:48px;line-height:47px;border-radius:24px !important;">'+sort+'</div>';
			}else{
				liHtml = liHtml+'<div class="'+css+'" style="width:'+divWidth+'px;height:'+divHeight+'px;border-radius:'+borderRad+'px !important;line-height:'+(divHeight-1)+'px;max-width:48px;max-height:48px;">'+sort+'</div>';
			}
			liHtml = liHtml+'</li>';
		$api.append($api.byId(divID), liHtml);
	}
	/*
	*author:zhaoj
	*function:没有题目时
	*date：20160405
	*/
	function noQuestions(){
		$api.css($api.byId('kg_title'),'display:none;');
		$api.css($api.byId('zg_title'),'display:none;');
		$api.css($api.byId('j_continue_btn'),'display:none;');
		$api.css($api.byId('j_submit_btn_50'),'display:none;');
		$api.css($api.byId('j_submit_btn_100'),'display:block;');
	}
	/*
	*author:zhaoj
	*function:点击查看具体某一道题目
	*date：20160408
	*/
	function checkQuestion(sort){
		sort=sort-1;
		var name = "reWriteQuestion("+sort+")";
		commonExecScript('daoxueNewXs_detail_window','daoxueNewXs_practice_frame',name,1);
		setTimeout(function(){
			commonExecScript('daoxueNewXs_detail_window','','back();',0);
		},150);
	}
	/*
	*author:zhaoj
	*function:点击继续答题按钮
	*date：20160408
	*/
	function continueQuestion(){
		if(no_answer_sort != 0){
			checkQuestion(no_answer_sort);
		}
	}
	/*
	*author:zhaoj
	*function:点击提交按钮
	*date：20170630
	*/
	function submit(){
		answeredCount = answer_array.length - answered_count;
		var tipMsg;
		if(answeredCount == 0){
			tipMsg = '确定要提交吗？';
		}else{
			tipMsg = '您还有'+answeredCount+'道题没做，确定要提交吗？';
		}
		popTwoBtnConfirm('提示',tipMsg , 'clickSubmitBtn();');
	}
	/*
	*author:zhaoj
	*function:点击确定按钮
	*date：20170630
	*/
	function clickSubmitBtn(){
		var param = {
			student_id: $api.getStorage("person_id"),
			zy_type: 8,
			forceCommit: 0,
            zy_id:api.pageParam.zy_id,
            random_num:creatRandomNum(),
        };
        api.ajax({
			url : $api.getStorage('BASE_URL_ACTION')+'/ypt/xx/submitZy',
			method : 'post',
			timeout : 30,
			dataType : 'json',
			returnAll : false,
			data : {
				values : param
			},
			headers : {
				'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
			}		
		}, function(ret, err) {
			if (ret && ret.success){
				popToast('提交成功');
				commonExecScript('daoxueNewXs_detail_window','daoxueNewXs_practice_frame','setSubmitTrue();',1);
				setTimeout(function(){
				    commonExecScript('daoxueNewXs_detail_window','','back();',0);
				},2000);
			}else{
				popToast('提交失败，请重新提交');
			}
		});
	}
</script>
</html>