<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>学生查看具体题目情况</title>
		<link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../../../../css/module/common/testQuestionShow.css" />
		<link rel="stylesheet" type="text/css" href="../../../../../css/module/common/jyeoo/ques_data.css" />
		<link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
		<style>
			body {
				margin: 0;
				background: rgba(0,0,0,0);
				color:#98979D;
			}
			.clearfix:after {
				content: ' ';
				display: block;
				clear: both;
				visibility: hidden;
				line-height: 0;
				height: 0;
			}
			.zuoye-name {
				line-height: 55px;
				width: 100%;
			}
			.answer-title {
				border-top: 1px solid #f1f1f1;
				height: 55px;
				width: 100%;
				margin-bottom: 20px;
			}
			.title {
				width: 50%;
				float: left;
			}
			.answer-title div {
				height: 35px;
				display: inline-block;
				line-height: 35px;
				margin-top: 13px;
				padding: 0 15px;
				color: #ffffff;
			}
			.seleted{width:60%;float:right;text-align:right;}
	    	.seleted div{display:inline-block;font-size:13px;color:#777;}
	    	.seleted .wrong-notebook{margin-right:10px;}
			.stem {
				padding: 20px 5%;
				max-width:100%;
				word-break:break-all;
			}
			.stem img {
				max-width: 90%; height:auto;
			}
			.stem div,.stem p,.stem span{word-wrap: break-word;word-break: normal; }
			.option dl {
				position:relative;
				border-radius: 5px;
				min-height: 55px;
				border: 2px solid #EFF1F1;
				margin-bottom: 20px;
			}
			.option dl dt {
				position:absolute;
				top:0px;
				bottom:-1px;
				display:block;
				font-size: 22px;
				font-weight: 600;
				width: 12%;
				height:100%;
				float: left;
				background: #EFF1F1;
		/*		line-height: 53px;*/
				border-radius: 1px 0 0 1px;
				text-align: center;
				color: #666;
			}
			.option dl dt div{
				position:absolute;
				top:50%;
				left:50%;
				margin-top:-10px;
				margin-left:-8px;
				height:20px
			}
			.option dl dd {
				width: 75%;
				float: right;
				margin-right:30px;
				min-height: 55px;
				line-height: 25px;
				padding:15px 0;
				color:#98979D;
				word-wrap: break-word;
				word-break: normal; 
			}
			.img img{max-width: 100%;padding : 0 5% 15px 5%;max-width:90%;height:auto;}
			.option dl dd div p img{
				vertical-align: middle;
				margin:10px 0;
			}
			.option dl dd img {
				max-width: 85%;
			}
			.option dl dd .judge{position:absolute;right:4%;top:50%;margin-top:-9px;max-width:15%;width:18px;}
			.option .active dt {
				color: #ffffff !important;
			}
			.option .wrong{border:2px solid #ff0000 !important;}
    		.option .wrong dt{background:#ff0000  !important;color:#ffffff !important;}
			.upload-answer button {
				width: 100%;
				height: 55px;
				color: #ffffff;
				border-radius: 5px;
				font-size: 16px;
				margin-bottom: 20px;
			}
			.upload-answer button.no-use {
				background: #f1f1f1;
				color: #dCdCdc
			}
			.upload-answer button .aui-iconfont {
				margin-right: 5px;
				font-size: 22px;
			}
			.source-img ul {
				overflow: visible;
			}
			.source-img ul li {
				list-style: none;
				overflow: visible;
			}
			.source-img ul li div {
				text-align: center;
				border: 1px solid #f1f1f1;
				position: relative;
			}
			.next {
				line-height: 55px;
				text-align: right;
			}
			.source-img ul li.voice {
				position: relative;
				margin-bottom: 20px;
				background: url(../../../../../image/fun-module/iphone/zuoye/voice.png) left top no-repeat;
				height: 50px;
				text-align: left;
				line-height: 45px;
				padding-left: 20px;
				color: #ffffff;
			}
			.source-img ul li.voice .delete-voice {
				position: absolute;
				right: -13px;
				top: -7px
			}
			.source-img ul li.voice .voice-right {
				position: absolute;
				right: -6px;
				top: 0;
				display:block;
				background: url(../../../../../image/fun-module/iphone/zuoye/voice-right.png) right top no-repeat;
			}
			.plr15 {
				padding: 0 15px;
			}
			.no-data {
				text-align: center;
				color: #c0c0c0;
				background: url(../../../../../image/fun-module/iphone/zuoye/kong.png) center top no-repeat;
				padding-top: 55px;
				margin-bottom: 20px;
			}
			.footer-div{
				position:fixed;
				height:55px;
				background:#ffffff;
				display: block;
				bottom: 0px;
				width:100%;
				box-shadow:3px 0 4px #aaaaaa;
			}
			.footer-div .prevQ,.footer-div .nextQ{display: inline-block;width:50%;float: left;}
			.footer-div .prevQ{text-align: left;}
			.footer-div .nextQ{text-align: right;}
			.q_div{
				padding-bottom:70px !important;
			}
			.no-question-data{text-align:center;color:#666;height:50px;line-height:50px;}
			.plrb15{padding:0 15px 15px 15px;}
			.source-img{color:#9C9C9C;word-wrap: break-word;word-break: normal;}
			.right-answer span{z-index: 0 !important;}
		</style>
	</head>
	<body id="body" class="common-iphone-zuoyeXsJy">
		<div id="q_title"></div>
		<div class="q_div default-testQuestionShow" id="q_div">
		</div>
		<script type="text/html" id="q_script">
			<!--//客观题-->
			<div class="zuoye-name plr15 clearfix">
				<div id="student_name" class="title"></div>
				<div class="seleted">
				</div>
			</div>
			<%if(html_json){%>
                <%if(que_source == 1){ %>
                    <!--东师理想试题展示-->
                    <div class="stem clearfix">
                        <%=#commonRemoveQuestionEdit(html_json.question_title)%>
                    </div>
					<% if(qt_type == 1){ %>
						<% if(html_json.question_answer == "正确" || html_json.question_answer == "错误"){ %>
							<div id="j_option" class="option plr15 clearfix">
								<dl class="clearfix" answerOption="正确">
									<dt><div>1</div></dt>
									<dd>正确
										<img id="j_right_1" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
										<img id="j_wrong_1" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
									</dd>
								</dl>
								<dl class="clearfix" answerOption="错误">
									<dt><div>2</div></dt>
									<dd>错误
										<img id="j_right_2" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
										<img id="j_wrong_2" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
									</dd>
								</dl>
							</div>
							<div id="j_right_answer_title" class="answer-title clearfix" style="display:none;">
								<div>
									正确答案
								</div>
							</div>
							<div id="j_right_answer" class="source-img plrb15 right-answer img clearfix" style="display:none;"></div>
						<%}else{%>
							<!--客观题-->
							<div id="j_option" class="option plr15 clearfix">
								<%for(var i = 0; i < html_json.question_answer_length; i++){%>
									<dl class="clearfix" answerOption="<%=html_json.question_answer_first[i]%>">
										<dt><div><%=html_json.question_answer_first[i]%></div></dt>
										<dd>
											<%=#html_json.quetionOption[i]%>
											<img id="j_right_<%=html_json.question_answer_first[i]%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
											<img id="j_wrong_<%=html_json.question_answer_first[i]%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
										</dd>
									</dl>
								<%}%>
							</div>
							<div id="j_right_answer_title" class="answer-title clearfix" style="display:none;">
								<div>
									正确答案
								</div>
							</div>
							<div id="j_right_answer" class="source-img plrb15 right-answer img clearfix" style="display:none;"></div>
						<%}%>
					<% } else { %>
						<!--主观题-->
						<div class="answer-title clearfix">
							<div>
								他的作答
							</div>
						</div>
						<div class="source-img plr15 clearfix">
							<div id="j_no_data" class="no-data" style="display:none;">
								本题他没有作答
							</div>
							<ul id="add_answer"></ul>
						</div>
						<div id="j_right_answer_title" class="answer-title clearfix" style="display:none;">
							<div>
								正确答案
							</div>
						</div>
						<div id="j_right_answer" class="source-img plrb15 right-answer img clearfix" style="display:none;">
							
						</div>
						<div id="j_teacher_score_title" class="answer-title clearfix" style="display:none;">
							<div>
								该题正误
							</div>
						</div>
						<div id="j_teacher_score" class="source-img plrb15 right-answer clearfix" style="display:none;">
						</div>
						<div id="j_teacher_comment_title" class="answer-title clearfix" style="display:none;">
							<div>
								教师批语
							</div>
						</div>
						<div id="j_teacher_comment" class="source-img plrb15 right-answer clearfix" style="display:none;">
						</div>
					<% } %>
					<div class="answer-title clearfix">
						<div>
							题目解析
						</div>
					</div>
					<div id="j_analysis" class="source-img plrb15 img clearfix">
						<%=#html_json.question_analysis%>
					</div>
				<% }else{ %>
					<!--菁优网试题展示-->
					<div class="stem clearfix">
                        <%=#commonRemoveQuestionEdit(html_json.Content)%>
                    </div>
					<% if(qt_type == 1){ %>
						<% if(html_json.Answers == "√" || html_json.Answers == "×"){ %>
							<div id="j_option" class="option plr15 clearfix">
								<dl class="clearfix" answerOption="√">
									<dt><div>1</div></dt>
									<dd>正确
										<img id="j_right_1" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
										<img id="j_wrong_1" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
									</dd>
								</dl>
								<dl class="clearfix" answerOption="×">
									<dt><div>2</div></dt>
									<dd>错误
										<img id="j_right_2" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
										<img id="j_wrong_2" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
									</dd>
								</dl>
							</div>
						<%}else{%>
							<!--客观题-->
							<div id="j_option" class="option plr15 clearfix">
								<%for(var i = 0; i < html_json.Options.length; i++){%>
									<dl class="clearfix" answerOption="<%=i%>">
										<dt><div><%=html_json.Options_first[i]%></div></dt>
										<dd>
											<dd><%=#html_json.Options[i]%>
												<img id="j_right_<%=i%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/right.png" alt="对" />
												<img id="j_wrong_<%=i%>" class="judge" style="display:none;" src="../../../../../image/fun-module/iphone/zuoye/wrong.png" alt="对" />
											</dd>
										</dd>
									</dl>
								<%}%>
							</div>
						<%}%>
						 <div class="answer-title clearfix">
                            <div>
                              	  正确答案
                            </div>
                        </div>
                        <div class="source-img plrb15 right-answer img clearfix">
                            <%if(html_json.Answers == "√" || html_json.Answers == "×"){%>
                                <%if(html_json.Answers == "√"){%>
                                   	 正确
                                <%}else{%>
                                   	 错误
                                <%}%>
                            <%}else{%>
                                <%for(var i = 0; i < html_json.Answers.length; i++){%>
                                    <%=html_json.Options_first[html_json.Answers[i]]%>
                                <%}%>
                            <%}%>
                        </div>
                        <div class="answer-title clearfix">
                            <div>
                               	 题目解析
                            </div>
                        </div>
                        <div id="j_analysis" class="source-img plrb15 img clearfix"><%=#html_json.Method%></div>
					<% } else { %>
						<!--主观题-->
						<div class="answer-title clearfix">
							<div>
								他的作答
							</div>
						</div>
						<div class="source-img plr15 clearfix">
							<div id="j_no_data" class="no-data" style="display:none;">
								本题他没有作答
							</div>
							<ul id="add_answer"></ul>
						</div>
						<div id="j_teacher_score_title" class="answer-title clearfix" style="display:none;">
							<div>
								该题正误
							</div>
						</div>
						<div id="j_teacher_score" class="source-img plrb15 right-answer clearfix" style="display:none;">
						</div>
						<div id="j_teacher_comment_title" class="answer-title clearfix" style="display:none;">
							<div>
								教师批语
							</div>
						</div>
						<div id="j_teacher_comment" class="source-img plrb15 right-answer clearfix" style="display:none;">
						</div>
						<div class="answer-title clearfix">
                            <div>
                               	 题目解析
                            </div>
                        </div>
                        <div id="j_analysis" class="source-img plrb15 img clearfix"><%=#html_json.Method%></div>
					<% } %>
				<%}%>
			<%}else{%>
                <div class="no-question-data">该题目正在生成，请稍候查看</div>
            <%}%>	
		</script>
	</body>
	<script type="text/javascript" src="../../../../../script/api.js"></script>
	<script type="text/javascript" src="../../../../../script/base_config.js" ></script>
	<script type="text/javascript" src="../../../../../script/plug-in/template.js" ></script>
	<script type="text/javascript" src="../../../../../script/plug-in/base64.js" ></script>
	<script type="text/javascript" src="../../../../../script/assembly/Merge.js"></script>
	<script type="text/javascript" src="../../../../../script/common/common.js" ></script>
	<script type="text/javascript">
		var header_h;
		var BASE_URL_ACTION;
		var BASE_APP_TYPE;
		//横屏宽度
		var img_count = 0;
		//图片的个数
		var voice_count = 0;
		//语音的个数
		var q_cur_num = 0;
		//当前试题
		var q_sum = 0;
		//试题总数
		var q_json_str;
		//试题json
		var obj_scan;
		var answers_count = 0;//答案的个数
		var voice_duration=0;//音频的秒数
		var guid_amr;//音频的file_id
		var netAudio;//播放录音对象
		var qt_id;//题目的类型
		var zg_img_json={"list":[]};//主观题图片json数据，根据这个json数据图片进行排序
		apiready = function() {
		    commonSetTheme({"level":5,"type":0});
			header_h = api.pageParam.header_h;
			BASE_APP_TYPE = $api.getStorage('BASE_APP_TYPE');
			obj_scan = api.require('UIAlbumBrowser');
			netAudio = api.require('netAudio');
			var zy_id = api.pageParam.zy_id;
			var que_id = api.pageParam.que_id;
			var que_id_char = api.pageParam.que_id_char
			q_cur_num = 0;
			getAnswerByStuZyQueId();
		};
		/*
		 *author:zhaoj
		 *function:上传的图片
		 *date：20160325
		 */
		function uploadImg(file_id,ext) {
			var img_url;
			if(BASE_APP_TYPE == 1){
				img_url = BASE_IMAGE_PRE+"down/App/"+ file_id.substring(0, 2) + "/" + file_id + '.' + ext + commonReturnPhotoCutSize(0);
			}else{
				img_url = BASE_URL_ACTION + "/html/thumb/App/" + file_id.substring(0, 2) + "/" + file_id + '.' + ext + commonReturnPhotoCutSize(0);
			}
			uploadImgHtml(img_url,file_id,ext);
		}
		/*
		 *author:zhaoj
		 *function:图片的HTML
		 *date：20160408
		 */
		function uploadImgHtml(file_path,file_id,ext) {
			answers_count = answers_count + 1;
			var img_width = api.winWidth-30;
			var img_html = '<li class="j_img_li" style="margin-bottom:20px;" fileID="'+file_id+'" fileSrc="'+file_path+'">';
			img_html = img_html + '<img class="j_img" src=' + file_path + ' width='+img_width+' height="auto" />';
			img_html = img_html + '</li>';
			$api.append($api.byId('add_answer'), img_html);
			judgeLength(answers_count);
		}
		/*
		 *author:zhaoj
		 *function:判断有几张图片上传，如果有四张，按钮不能触发点击事件，成灰
		 *date：20160325
		 */
		function judgeLength(answers_count) {
			if(answers_count==0){
				api.hideProgress();
				$api.css($api.byId('j_no_data'),'display:block;');
			}else if(answers_count == 8) {
				$api.attr($api.byId('img_btn'), 'disabled', 'true');
				$api.addCls($api.byId('img_btn'), 'no-use');
				$api.css($api.byId('j_no_data'),'display:none;');
			} else {
				$api.removeAttr($api.byId('img_btn'), 'disabled');
				$api.removeCls($api.byId('img_btn'), 'no-use');
				$api.css($api.byId('j_no_data'),'display:none;');
			}
		}
		/*
		 *author:zhaoj
		 *function:打开图片
		 *date：20160328
		 */
		function openImage(src_url) {
			var openImgArray = [];
			var index;
			//打开的是第几张图片
			var liArray = $api.domAll($api.byId('add_answer'), '.j_img_li');
			for (var i = 0; i < liArray.length; i++) {
				openImgArray.push($api.attr($api.dom(liArray[i], '.j_img'), 'src'));
				if ($api.attr($api.dom(liArray[i], '.j_img'), 'src') == src_url) {
					index = i;
				}
			}
			var imageBrowser = api.require('imageBrowser');
			imageBrowser.openImages({
				imageUrls : openImgArray,
				//是否以九宫格方式显示图片
				showList : false,
				//showList : true,
				activeIndex : index
			});
		}
		function reWriteQuestion(q_cur) {
			var length = q_json_str.zy_info.list.length;
			zg_img_json={"list":[]};
			if(length>0){
				answers_count=0;
				q_sum = getJsonObjLength(q_json_str.zy_info.list) - 1;
				qt_id = q_json_str.zy_info.list[q_cur].qt_id;
				q_json_str.zy_info.list[q_cur].commonRemoveQuestionEdit=commonRemoveQuestionEdit;
				var html_type = template.render('q_script', q_json_str.zy_info.list[q_cur]);
				document.getElementById('q_div').innerHTML = html_type;
				judgeTextIndent();
				if(q_json_str.zy_info.qt_type==1){
					getAnswer(q_json_str.zy_info.qt_type,q_json_str.zy_info.rightanswer,q_json_str.zy_info.stu_answer,q_json_str.zy_info.score,'');
				}else{
					getAnswer(q_json_str.zy_info.qt_type,q_json_str.zy_info.list[q_cur].html_json.question_answer,q_json_str.zy_info.stu_answer,q_json_str.zy_info.score,q_json_str.zy_info.tea_notes);
				}
				$api.text($api.byId('student_name'), api.pageParam.student_name);
			}else{
				$api.html($api.byId('q_div'), '<div class="no-question-data">暂无题目</div>');
			}
		}
		/*
		*author:zhaoj
		*function:判断每个p标签的text-indent属性，解决这个属性过大导致整体页面变宽的问题
		*date：201604014
		*/
		function judgeTextIndent(){
			var pArray = $api.domAll($api.byId('body'), 'p');
			var widthValue = Math.floor(api.winWidth/2);
			for(var i = 0; i < pArray.length; i++){		
				var textIndentValue = $api.cssVal(pArray[i],'text-indent');
				textIndentValue = textIndentValue.substring(0,textIndentValue.length-2)*1;
				if(textIndentValue > widthValue || textIndentValue < -widthValue){
					$api.css(pArray[i],'text-indent:0em;');
				}
				var paddingLeftValue = $api.cssVal(pArray[i],'padding-left');
				paddingLeftValue = paddingLeftValue.substring(0,paddingLeftValue.length-2)*1;
				if(paddingLeftValue > widthValue || paddingLeftValue < -widthValue){
					$api.css(pArray[i],'padding-left:0;');
				}

			}
		}
		/*
		*author:zhaoj
		*function:获取检测
		*date：20160405
		*/
		function getAnswerByStuZyQueId(){
			api.showProgress({
				title : '加载中...',
				text : '请稍候...',
				modal : false
			});
			
			api.ajax({
				url : $api.getStorage('BASE_URL_ACTION') + '/xx/getAnswerByStuZyQueId',
				method : 'get',
				dataType : 'json',
				timeout : 30,
				data : {
					values : {
						"student_id" : api.pageParam.student_id,
						"zy_id" : api.pageParam.zy_id,
						"que_source" : $api.getStorage('que_source'),
						"jy_subject_en_name" : $api.getStorage('jy_subject_en_name'),
						"question_id_char" : $api.getStorage('question_id_char'),
						"identity_id" :$api.getStorage('identity'),
						"p_type" : 2
					}
				}
			}, function(ret, err) {
				if(err) {
					api.toast({
	                    msg:'获取学生答题情况失败'
                    });
                    api.hideProgress();
				} else {
					if(ret) {
						if(ret.qt_type ==1){
							q_json_str = {"zy_info" : {"list":[],"qt_type":ret.qt_type,"rightanswer":ret.right_answer,"stu_answer":ret.stu_answer,"score":ret.score}};
						}else{
							q_json_str = {"zy_info" : {"list":[],"qt_type":ret.qt_type,"stu_answer":ret.stu_answer,"score":ret.score,"tea_notes":ret.tea_notes}};
						}
						//判断题型，1：客观题，2：主观题
						var oparam = new Object();
						oparam.list_length = 1;
						oparam.qt_type = ret.qt_type;
						oparam.qt_id = ret.qt_id;
						oparam.que_source = ret.que_source;
						oparam.jy_subject_en_name = ret.jy_subject_en_name;
						if(ret.html_json){
							oparam.html_json={};
							if(ret.que_source == 1){
                                //东师理想本地试题
								var question_title = Base64.decode(ret.html_json.question_title);
								var key = '/dsideal_yy';
								var key_re = BASE_URL_ACTION;
								oparam.html_json.question_title = question_title;
								if(oparam.html_json.question_title.indexOf(key_re) == -1){
								    oparam.html_json.question_title = question_title.replaceAll(key, key_re);
								}
								oparam.html_json.question_analysis = Base64.decode(ret.html_json.question_analysis);
								oparam.html_json.question_analysis = oparam.html_json.question_analysis == ""?"略":oparam.html_json.question_analysis;
								oparam.html_json.question_answer= Base64.decode(ret.html_json.question_answer);
								if(oparam.html_json.question_answer.indexOf(key_re) == -1){
								    oparam.html_json.question_answer= Base64.decode(ret.html_json.question_answer).replaceAll(key, key_re);
								}
								if(ret.html_json.quetionOption != ''){
									var count_length = count(ret.html_json.quetionOption);
									oparam.html_json.question_answer_length = count_length;
									oparam.html_json.quetionOption=JSON.parse(commonQuetionOption(count_length,JSON.stringify(ret.html_json.quetionOption),key,key_re));
									oparam.html_json.question_answer_first = JSON.parse(commonQuetionOptionFirst(count_length))
								}else{
									oparam.html_json.question_answer_length = 0;
								}
							}else{
								//菁优网试题
                                oparam.html_json={};
                                oparam.html_json.Method= ret.html_json.Method;
                                oparam.html_json.Answers= ret.html_json.Answers;
                                oparam.html_json.Topics= ret.html_json.Topics;
                                oparam.html_json.Analyse= ret.html_json.Analyse;
                                oparam.html_json.Content=ret.html_json.Content;
                                oparam.html_json.Discuss= ret.html_json.Discuss;
                                oparam.html_json.Options= ret.html_json.Options;
                                oparam.html_json.Options_first = JSON.parse(commonQuetionOptionFirst(ret.html_json.Options.length));
                                oparam.html_json.Points= ret.html_json.Points;
                                oparam.html_json.Label= ret.html_json.Label;
							}
						}else{
							oparam.html_json = ret.html_json;
						}
						q_json_str.zy_info.list.push(oparam);
						
						reWriteQuestion(q_cur_num);
					}
				}				
			});
		}
		/*
		*author:zhaoj
		*function:获取对象长度
		*date：20160406
		*/
		function count(o){
		    var t = typeof o;
			if(t == 'object'){
	            var n = 0;
	            for(var i in o){
	                    n++;
	            }
		    }
		    return n;
		}; 
		/*
		*author:zhaoj
		*function:播放音频
		*date：20160407
		*/
		function playVoice(voice_path) {
			netAudio.stop();
			netAudio.play({
			    path: voice_path
			},function( ret, err ){   
				if(err){
					popToast('语音播放失败');
				}else{
					if( ret ){
				    }else{
				    	popToast('语音播放失败');
				    }
				}
			});
		}
		/*
		*author:zhaoj
		*function:获取学生答案
		*date：20160407
		*/
		function getAnswer(qt_type,rightanswer,stu_answer,score,tea_notes){
			if(qt_type == 1){
				api.hideProgress();
				//客观题
				//正确答案
				if(rightanswer){
					rightAnswer(rightanswer,0)
				}
				var dlArray = $api.domAll($api.byId('j_option'),'dl');
				var stuAnswerArray;//学生作答的答案
				var rightArray;
				if(stu_answer == "正确" || stu_answer == "错误" || stu_answer == "√" || stu_answer == "×"){
					//判断题
					stuAnswerArray = [stu_answer];
					rightArray = [rightanswer];
				}else{
					stuAnswerArray = stu_answer.split("");	
					rightArray = rightanswer.split("");
				}
				var stuAnswerLast=[];
				var stuAnswerRight=[];
				for(var i =0; i<stuAnswerArray.length;i++){
					var count = 0;
					for(var j=0; j<rightArray.length;j++){
						if(stuAnswerArray[i]==rightArray [j]){
							count++;
						}
					}
					if(count == 0){
						stuAnswerLast.push(stuAnswerArray[i]);
					}else{
						stuAnswerRight.push(stuAnswerArray[i]);
					}
				}
				for(var i=0; i <dlArray.length;i++){
					var answerOption = dlArray[i].getAttribute("answerOption");
					for(var j = 0; j<stuAnswerLast.length;j++){
						if(answerOption == stuAnswerLast[j]){
							$api.addCls(dlArray[i], 'wrong');
							if(answerOption == "正确" ||answerOption == "√" ){
								$api.css($api.byId('j_wrong_1'),'display:inline-block');
							}else if(answerOption == "错误" ||answerOption == "×"){
								$api.css($api.byId('j_wrong_2'),'display:inline-block');
							}else{
								$api.css($api.byId('j_wrong_'+answerOption),'display:inline-block');
							}
						}
					}
					for(var k = 0; k<stuAnswerRight.length;k++){
						if(answerOption == stuAnswerRight[k]){
							$api.addCls(dlArray[i], 'active');
							if(answerOption == "正确"||answerOption == "√" ){
								$api.css($api.byId('j_right_1'),'display:inline-block');
							}else if(answerOption == "错误" ||answerOption == "×"){
								$api.css($api.byId('j_right_2'),'display:inline-block');
							}else{
								$api.css($api.byId('j_right_'+answerOption),'display:inline-block');
							}
						}
					}
				}
			}else{
				//主观题
				//教师评分
				if(score != -2){
					teacherScore(score);
				}
				//教师评语
				if(tea_notes){
					teacherComment(tea_notes);
				}
				//正确答案
				if(rightanswer){
					rightAnswer(rightanswer,1)
				}
				var answer_list = stu_answer;
				//获取图片初始顺序
                for(var i = 0; i < answer_list.length; i++){
                    var oparam = new Object();
                    oparam.file_id = answer_list[i].file_id;
                    oparam.img_url = '';
                    zg_img_json.list.push(oparam);
                }
				if(getJsonObjLength(answer_list) > 0){
					for(var i = 0; i < getJsonObjLength(answer_list); i++){
						 if(answer_list[i].file_type==2){
                            var img_url;
                            if(BASE_APP_TYPE == 1){
                                img_url = BASE_IMAGE_PRE+"down/App/"+ answer_list[i].file_id.substring(0, 2) + "/" + answer_list[i].file_id + '.' + answer_list[i].ext + commonReturnPhotoCutSize(0);
                            }else{
                                img_url = BASE_URL_ACTION + "/html/thumb/App/" + answer_list[i].file_id.substring(0, 2) + "/" + answer_list[i].file_id + '.' + answer_list[i].ext + commonReturnPhotoCutSize(0);
                            }
                            zg_img_json.list[i].img_url = img_url;
                        }else if(answer_list[i].file_type==3){
                            voice_duration = answer_list[i].voice_duration;
                            uploadVoiceHtml(answer_list[i].file_path,answer_list[i].file_id);
                        }
					}
					showSelfProgress('答案加载中...');
					exePic(0,answer_list,function(flag){
						api.hideProgress();
                        if(flag){
                            for(var i = 0; i < zg_img_json.list.length; i++){
                                uploadImgHtml(zg_img_json.list[i].img_url,zg_img_json.list[i].file_id,zg_img_json.list[i].ext);
                            }
                        }
                    });
				}else{
					api.hideProgress();
					judgeLength(0);
				}
			}
		}

		/*
		*author:zhaoj
		*function:教师评分
		*date：20160414
		*/
		function teacherScore(score){
			var stu_score = score*100;
			if(stu_score == 100){
				$api.text($api.byId('j_teacher_score'), '正确');
			}else if(stu_score == 0){
				$api.text($api.byId('j_teacher_score'), '错误');
			}else{
				$api.text($api.byId('j_teacher_score'), '半对'+' ('+stu_score+'%)');
			}
			$api.css($api.byId('j_teacher_score'), 'display:block;');
			$api.css($api.byId('j_teacher_score_title'), 'display:block;');
		}
		/*
		*author:zhaoj
		*function:教师评语
		*date：20160414
		*/
		function teacherComment(comment){
			$api.html($api.byId('j_teacher_comment'), comment);
			$api.css($api.byId('j_teacher_comment'), 'display:block;');
			$api.css($api.byId('j_teacher_comment_title'), 'display:block;');
		}
		/*
		*author:zhaoj
		*function:正确答案
		*date：20160415
		*/
		function rightAnswer(question_answer,type){
			if(type){
				$api.html($api.byId('j_right_answer'), question_answer);
			}else{
				$api.text($api.byId('j_right_answer'), question_answer);
			}
			$api.css($api.byId('j_right_answer'), 'display:block;');
			$api.css($api.byId('j_right_answer_title'), 'display:block;');
		}
		/*
		*author:zhaoj
		*function:弹出Toast提示框
		*date：20160407
		*/
		function popToast(message){
			api.toast({
				msg : message,
				location : 'middle'
			});
		}
		//处理图片
		function exePic(index,answer_list,callback){
			if(index < answer_list.length){
				if(answer_list[index].piyue_file_path != null){
					api.download({
					    url: zg_img_json.list[index].img_url,
					    savePath: 'fs://lxjxt/yingyong/zuoye/'+answer_list[index].file_id+'.JPG',
					    report: false,
					    cache: true,
					    allowResume: true
					},function( ret, err ){
						if(err) {
							api.toast({
			                    msg:'服务器连接失败，未找到主观题检测'
		                    });
		                    callback(true);
						} else {
							if(ret.percent == 100) {
		                    		var savePath = ret.savePath;
						            MergePic(savePath, answer_list[index].piyue_file_path, function(result) {
					            		//调用这个方法合成试题和批阅痕迹,reslut为base64；建议用chrome查看该demo
										for(var i = 0; i < zg_img_json.list.length; i++){
											if(zg_img_json.list[i].file_id == answer_list[index].file_id){
												zg_img_json.list[i].img_url = result;
												index++;
												return exePic(index,answer_list,callback);
											}
										}
									});
		                    	} 
						}
					});
				}else{
					index++;
					return exePic(index,answer_list,callback);
				}
			}else{
				callback(true);
			}
		}
	</script>
</html>