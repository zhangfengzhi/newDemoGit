<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<!-- html5：在创建html时为了防止页面缩放等不兼容效果，要创建个viewport  -->
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<!-- 在IOS设备上，有时会将数字转为手机号，这里也要禁止下 -->
		<meta name="format-detection" content="telephone=no"/>
		<title>题本</title>
		<link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
		<link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
		<style>
			.menu{padding-right:20px;background:url(../../../../../image/fun-module/ipad/down-menu.png) right center no-repeat;background-size:15px auto;}
		</style>
	</head>
	<body class="common-iphone-tibenJy">
		<div id="wrap">
			<header class="aui-bar aui-bar-nav aui-bar-primary" id="aui-header">
				<div id="cloud" class="topbar activebar">
					<div id="back" class="back" onclick="back();" tapmode="">
						<i class="aui-iconfont aui-icon-left"></i>返回
					</div>
					<div  class="mTitle" id="mTitle">
						<div id="btn_title" class="btn-title">
							<div id="all" class="btn-l btn-top-active btn-top" onclick="changeBtnTitle(0,1);">
								做错的题
							</div>
							<div id="my" class="btn-r btn-top" onclick="changeBtnTitle(1,1);">
								收藏的题
							</div>
						</div>
					</div>
					<div class="win-menu">
						<a id='menu' class="menu"  onclick="openMenuFrame();"></a>
					</div>
				</div>
			</header>
			<div  class="aui-content aui-content-padded" id="message-content">
				<p class="aui-text-center history-date"></p>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../../../../script/api.js"></script>
	<script type="text/javascript" src="../../../../../script/common/common.js"></script>
	<script type="text/javascript" src="../../../../../script/assembly/tongjiData.js"></script>
	<script type="text/javascript">
		var header_h;//定位header位置，留出上面电池等空隙，苹果需要
		var back_type;//返回参数
		var flag = 0;
		var type=0;//0错题本，1好题本
		var id_fir_tiben = true;//判断是否第一次进入初始化页面
		var dic_type=-1; //错题标签：全部、态度类、知识点掌握类、技能类
		apiready = function() {
		    commonSetTheme({"level":5,"type":0});
			header_h = api.pageParam.header_h;
			//打开题本列表frame
			//initFrameGroup(0);
//			openCtbListFrame();
			initTibenFrameGroup();
			back_type = 'index';
			commonBackForAndroid();//安卓关闭
			commonIosAuiHeader();//定位header位置，留出上面电池等空隙，苹果需要
			commonOpenTjData($api.getStorage("identity")+'_'+api.winName);//记录统计
			changeTagType('全部',-1);
		};
		
		/**
		 * 错题本和好题本切换
		 * 周枫
		 * 2016.4.7
		 */
		function initFrameGroup(btn_type) {
			var frame_name;
			type = btn_type;
			btn_type == 0?frame_name = "tibenJy_wrong_frame":frame_name = "tibenJy_right_frame";
			var pageParamJson = {
			   'header_h' : header_h
			};
			commonOpenFrame(frame_name, frame_name+'.html', header_h+45, false, false, '#fff', pageParamJson);
		}
		/*
		*author:zhaoj
		*function:打开错题标签下拉菜单
		*date：20161209
		*/
		function openMenuFrame(){
			pageParamJson={"header_h":header_h,"type":type,"dic_type":dic_type};//打开frame页面json数据
			//打开错题标签下拉菜单
			commonOpenFrame("tibenJy_tag_menu_frame","tibenJy_tag_menu_frame.html",0,false,false,"rgba(0,0,0,0)",pageParamJson);
		}
		/**
		 * 切换按钮
		 * 周枫
		 * 2016.4.7
		 */
		function changeBtnTitle(btn_type,type) {
			
			flag = 1;
			var $btn_title = $api.byId('btn_title');
			var $btn_title_all = $api.domAll($btn_title, 'div');
			for (var j = 0; j < $btn_title_all.length; j++) {
				$api.removeCls($btn_title_all[j], 'btn-top-active');
			}
			//定义切换页面样式json
			var rect_json = {};
			if (btn_type == 0) {
				$api.addCls($api.byId('all'), 'btn-top-active');
				$api.addCls($api.byId('btn_title'), 't_display_b');
				$api.removeCls($api.byId('back'), 't_display_n');
				commonAddOrRemoveHideCss('menu',1);
				if(type==0){
					showSelfProgress('加载中...');
					setTimeout(function(){
						commonExecScript('tibenJy_index_window','tibenJy_wrong_frame','initData();',1);
						api.hideProgress();
					},500);
				}
			} else {
				$api.addCls($api.byId('my'), 'btn-top-active');
				$api.removeCls($api.byId('btn_title'), 't_display_b');
				$api.removeCls($api.byId('back'), 't_display_n');
				commonAddOrRemoveHideCss('menu',0);
				if(type==0){
					showSelfProgress('加载中...');
					commonExecScript('tibenJy_index_window','tibenJy_right_frame','initData();',1);
					api.hideProgress();
				}
			}
			if(type || id_fir_tiben){
				api.setFrameGroupIndex({
					name : 'tibenJy_index_group',
					index : btn_type,
					scroll : true,
					rect : {
						'x' : 0,
						'y' : header_h+45 ,
						'w' : 'auto',
						'h' : api.winHeight - header_h - 45
					}
				});
				id_fir_tiben = false;
			}
		}

		/*
		*author:zhaoj
		*function:打开错题本列表的frame
		*date：20160307
		*/
		function openCtbListFrame() {
		    var pageParamJson ={
		        'header_h' : header_h
		    };
commonOpenFrame("tibenJy_index_frame","tibenJy_index_frame.html",header_h+55,true,true,"#fff",pageParamJson);
		}
		/*
		*author:zhaoj
		*function:打开添加检测列表的frame
		*date：20160307
		*/
		function openAddZuoyeFrame() {
			reBackType('add');
			commonOpenFrame("zuoye_old_js_add_frame","zuoye_old_js_add_frame.html",header_h,false,true,"#fff",pageParamJson);
		}
		/*
		*author:zhaoj
		*function:返回页面
		*date：20160307
		*/
		function back() {
			switch(back_type) {
				case 'index':
					commonCloseTjData($api.getStorage("identity")+'_'+api.winName);//记录统计
					api.closeWin();
					break;	
				case 'add':
					commonCloseFrame('zuoye_old_js_add_frame');
					reBackType('index');
					break;
			}
		}
		/*
		*author:zhaoj
		*function:判断添加检测是否显示
		*date：20160307
		*/
		function isAddDisplay(flag){
			if(flag){
				$api.css($api.byId('add'),'display:inline;');
			} else {
				$api.css($api.byId('add'),'display:none;');
			}
		}
		/*
		*author:zhaoj
		*function:重置从哪个页面返回
		*date：20160307
		*/
		function reBackType(type) {
			switch(type) {
				//如果列表页面退出
				case 'index':
					commonSetWindowName('检测');
					isAddDisplay(true);
					back_type = 'index';
					break;
				//如果添加内容页面退出
				case 'add':
					commonSetWindowName('添加检测');
					isAddDisplay(false);
					back_type = 'add';
					break;
			}
		}
		
		/**
		 * 
		 */
		function initTibenFrameGroup(){
			api.openFrameGroup({
				name : 'tibenJy_index_group',
				scrollEnabled : true,
				rect : {
					'x' : 0,
					'y' : header_h+45 ,
					'w' : 'auto',
					'h' : api.winHeight - header_h - 45
				},
				index : 0,
				//预加载
				preload : 1,
				scrollToTop : true,
				bounces : true,
				scrollEnabled : true,
				frames : [{
					name : 'tibenJy_wrong_frame',
					scrollToTop : true,
					allowEdit : false,
					url : 'tibenJy_wrong_frame.html',
					bgColor : '#f7f9f8',
					pageParam : {
						header_h : header_h
					},
					vScrollBarEnabled : true,
					hScrollBarEnabled : true,
					//页面是否弹动 为了下拉刷新使用
					bounces : false
				}, {
					name : 'tibenJy_right_frame',
					scrollToTop : true,
					allowEdit : false,
					url : 'tibenJy_right_frame.html',
					bgColor : '#f7f9f8',
					pageParam : {
						header_h : header_h
					},
					vScrollBarEnabled : true,
					hScrollBarEnabled : true,
					//页面是否弹动 为了下拉刷新使用
					bounces : false
				}]
			}, function(ret, err) {
				var btn_index = ret.index;
				switch(btn_index){
					case 0:
						changeBtnTitle(0,0);
					break;
					case 1:
						changeBtnTitle(1,0);
					break;
				}
			});
		}
		
		function changeTagType(name,type){
			dic_type = type;
//			var uiMode = api.uiMode;
//			if(api.uiMode == 'pad'){
//				$api.text($api.byId('menu'),name);
//				$api.removeCls($api.byId('menu'), 'aui-iconfont');
//				$api.removeCls($api.byId('menu'), 'aui-icon-menu');
//				$api.removeCls($api.byId('menu'), 'back');
//				$api.addCls($api.byId('menu'), 'menu');
//			}else{
				$api.removeCls($api.byId('menu'), 'menu');
				$api.addCls($api.byId('menu'), 'aui-iconfont');
				$api.addCls($api.byId('menu'), 'aui-icon-menu');
				$api.addCls($api.byId('menu'), 'back');
//			}
		}
	</script>
</html>