<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<!-- html5：在创建html时为了防止页面缩放等不兼容效果，要创建个viewport  -->
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<!-- 在IOS设备上，有时会将数字转为手机号，这里也要禁止下 -->
		<meta name="format-detection" content="telephone=no"/>
		<title>学业报告</title>
		<link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../../../../css/module/common/cjfxXs.css" />
		<link id="j_theme_base" rel="stylesheet" type="text/css" href="" />   
	    <style>
			.menu{padding-right:30px;background:url(../../../../../image/fun-module/ipad/xybg/down-menu.png) right center no-repeat;background-size:15px auto;}
		</style>
	</head>
	<body class="common-iphone-xybgstu">
		<div id="wrap">
			<header class="aui-bar aui-bar-nav aui-bar-primary" id="aui-header">
				<div id="cloud" class="topbar activebar">
					<div id="back" class="back" onclick="back();" tapmode="">
						<i class="aui-iconfont aui-icon-left"></i>返回
					</div>
					<div class="mTitle" id="mTitle">
						
					</div>
					<div class="win-menu">
						<div id="j_term" class="aui-iconfont aui-icon-menu back" onclick="openTermFrame(1);">&nbsp;</div>
						<div>
						  <a id="j_rl" style="font-size:12px;margin-right:-10px;" onclick="claimExam()">去认领</a>
						  <a id='menu1' class="aui-iconfont aui-icon-menu back display-none" style="margin-right:-10px;"onclick="openMenuFrame();"></a>
						</div>
						<a id='menu2' class="aui-iconfont aui-icon-check back display-none" onclick="screenTest();"></a>
					</div>
				</div>
				<div class="aui-searchbar-wrap demo" id="search">
			        <div class="aui-searchbar aui-border-radius" tapmode onclick="commonDoSearch();">
			            <i class="aui-iconfont aui-icon-search"></i>
			            <div class="aui-searchbar-text">请输入搜索内容</div>
			            <div class="aui-searchbar-input">
			            	<form action="javascript:startSearch(1);">
			            	<input oninput="commonRemoveExpression(this)" type="text" placeholder="按标题搜索,最多支持20个字符" id="search-input" maxlength ='20'>
			            	</form>
			            </div>
			            <i class="aui-iconfont aui-icon-roundclosefill" tapmode onclick="commonClearInput()"></i>
			        </div>
			        <div class="aui-searchbar-cancel aui-text-info" tapmode onclick="commonCancelSearch()">取消</div>
			    </div>
			</header>
			<div  class="aui-content aui-content-padded" id="message-content">
				<p class="aui-text-center history-date"></p>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../../../../script/api.js"></script>
	<script type="text/javascript" src="../../../../../script/base_config.js" ></script>
	<script type="text/javascript" src="../../../../../script/common/common.js"></script>
	<script type="text/javascript" src="../../../../../script/assembly/tongjiData.js"></script>
	<script type="text/javascript" src="../../../../../script/module/common/cjfxXs.js"></script>
	<script type="text/javascript" src="../../../../../script/plug-in/base64.js" ></script>
	<script type="text/javascript" src="../../../../../script/init/init_config.js" ></script>
	<script type="text/javascript">
		var back_type = 'index';//定义从哪个页面退出
		var open_type = 1;//打开的是成绩分析还是学业报告
		var type = 1;
		var header_h = 0;	
		var is_hhcj = false;
		var is_cjfx = false;
		apiready = function() {
		    commonSetTheme({"level":5,"type":0});
		    getCrmInfoByPerson('hxx_hhycj',function(flag,data){
		      if(flag){
		          is_hhcj = true;
		      }
		      getCrmInfoByPerson('hxx_lxycj',function(flag_hxx_lxycj,data){
                  if(flag_hxx_lxycj){
                      is_cjfx = true;
                  }
                  $api.setStorage('cjfx_ys',0);//初始化进来不是演示功能
                  header_h = api.pageParam.header_h;
                  var pageParamJson={"header_h":header_h,'winName':api.winName};//打开frame页面所需参数
                  commonOpenFrame('xybg_index_frame', 'xybg_index_frame.html',header_h, true, false,"#ffffff",pageParamJson);//打开index页面
                  if((is_cjfx || is_hhcj) && !(is_cjfx && is_hhcj)){
                    commonSetWindowName('<div id="btn_title" class="btn-title"><div id="index_title"><div id="xxbg" class="btn-l btn-top-active btn-top" onclick="changeBtnTitle(1);">学习轨迹</div><div id="cjfx" class="btn-r btn-top" onclick="changeBtnTitle(0);">成绩分析</div></div><span id="menu_title" style="display:none">选择章节</span></div>');
                    changeBtnTitle(1);
                  }else{
                    commonSetWindowName('学习轨迹');
                  }
                  commonBackForAndroid();//安卓关闭
                  commonIosAuiHeader();//定位header位置，留出上面电池等空隙，苹果需要
                  commonOpenTjData($api.getStorage("identity")+'_'+api.winName);//记录统计
                });
		    });
		};
		/*
		*作者:zhaoj
		*功能:开始搜索
		*日期：20161024
		*/
		function startSearch(type){
			commonSearch(type,function(data){
				commonExecScript('','cjfxXs_index_frame','setKeyword("'+data+'");',2);
			})
		}
		
		/*
		*author:zhaoj
		*function:返回页面
		*date：20170118
		*/
		function back() {
			switch(back_type) {
				case 'index':
					changePersonInfo(true);
					commonCloseTjData($api.getStorage("identity")+'_'+api.winName);
					api.closeWin();
					break;
				case 'rlks':
					commonCloseFrame('cjfxXs_rlks_frame');
					reBackType('index');
					break;
				case 'qrrl':
					commonCloseFrame('cjfxXs_qrrl_frame');
					reBackType('rlks');
					break;
				case 'menu':
					commonCloseFrame('cjfxXs_menu_frame');
					$api.addCls($api.byId('menu2'), 'display-none');
					reBackType('menu_index');
					break;
			}
		}
		/**
		 * 重置window标题
		 * 周枫
		 * 2015.12.17
		 */
		function reWindowName(win_name) {
			$api.html($api.byId('mTitle'), win_name);
		}
		/**
		 * 重置从哪个页面退出
		 * 周枫
		 * 2015.12.17
		 */
		function reBackType(type) {
			switch(type) {
				case 'index':
					var name_html = '<div id="btn_title" class="btn-title"><div id="xxbg" class="btn-l btn-top" onclick="changeBtnTitle(1);">学习轨迹</div><div id="cjfx" class="btn-r btn-top btn-top-active" onclick="changeBtnTitle(0);">成绩分析</div></div>';
					$api.removeCls($api.byId('btn_title'), 't_display_b');
					$api.removeCls($api.byId('back'), 't_display_n');
					reWindowName(name_html);
					if($api.getStorage("identity") == 6){
						$api.css($api.byId('j_rl'), 'display:inline-block;');
					}
					$api.removeCls($api.byId('menu1'), 'display-none');
					back_type = 'index';
					break;
				case 'rlks':
					reWindowName('考试认领');
					$api.css($api.byId('j_rl'), 'display:none');
					$api.addCls($api.byId('menu1'), 'display-none');
					$api.addCls($api.byId('menu2'), 'display-none');
					back_type = 'rlks';
					break;
				case 'qrrl':
					reWindowName('考试认领');
					$api.css($api.byId('j_rl'), 'display:none');
					$api.addCls($api.byId('menu1'), 'display-none');
					$api.addCls($api.byId('menu2'), 'display-none');
					back_type = 'qrrl';
					break;
				case 'menu':
					reWindowName('考试筛选');
					$api.css($api.byId('j_rl'), 'display:none');
					$api.addCls($api.byId('menu1'), 'display-none');
					$api.removeCls($api.byId('menu2'), 'display-none');
					back_type = 'menu';
					break;
				case 'menu_index':
					var name_html = '<div id="btn_title" class="btn-title"><div id="xxbg" class="btn-l btn-top" onclick="changeBtnTitle(1);">学习轨迹</div><div id="cjfx" class="btn-r btn-top btn-top-active" onclick="changeBtnTitle(0);">成绩分析</div></div>';
					$api.removeCls($api.byId('btn_title'), 't_display_b');
					$api.removeCls($api.byId('back'), 't_display_n');
					reWindowName(name_html);
					if($api.getStorage("identity") == 6){
						$api.css($api.byId('j_rl'), 'display:inline-block;');
					}
					$api.removeCls($api.byId('menu1'), 'display-none');
					back_type = 'index';
					break;
			}
		}
		
	    /*
		 * 功能：打开切换学期按钮
		 * 作者：张自强
		 * 时间：20171018
		 */
		function openTermFrame(type){
			$api.attr($api.byId('j_term'),'onclick',  'openTermFrame('+((type+1)%2)+');');
            commonExecScript(api.winName,'xybg_index_frame','showOrhideXq('+type+');',1)
		}
		
		/*
		 * 功能：隐藏或显示成绩分析认领等功能
		 * 作者：张自强
		 * 时间：20171028
		 */
		function hideOrShowCjMenu(type){
			open_type = type;
			if(type==1){
				$api.addCls($api.byId('menu1'), 'display-none');
				$api.removeCls($api.byId('j_term'), 'display-none');
			}else{
				$api.removeCls($api.byId('menu1'), 'display-none');
				$api.addCls($api.byId('j_term'), 'display-none');
			}
		}
		
		/*
		 * 功能：切换成绩分析和学习轨迹
		 * 作者：张自强
		 * 时间：20171023
		 */
		function changeBtnTitle(btn_type) {
		    if(!is_hhcj){
		      hideOrShowCjMenu(btn_type);
		    }
			//如果当前资源，不需要更新
			if (type != btn_type) {
				type = btn_type;
				$api.setStorage('cjfx_ys',0);//初始化进来不是演示功能
				var $btn_title = $api.byId('btn_title');
				var $btn_title_all = $api.domAll($btn_title, 'div');
				for (var j = 0; j < $btn_title_all.length; j++) {
					$api.removeCls($btn_title_all[j], 'btn-top-active');
				}
				if (btn_type == 1) {
					$api.addCls($api.byId('xxbg'), 'btn-top-active');
					$api.addCls($api.byId('btn_title'), 't_display_b');
					$api.removeCls($api.byId('back'), 't_display_n');
					if(!is_hhcj){
					   commonCloseFrame('cjfxXs_index_frame');
					}
					var pageParamJson={"header_h":header_h};//打开frame页面所需参数
					commonOpenFrame('xybg_index_frame', 'xybg_index_frame.html',header_h, true, false,"#ffffff",pageParamJson);//打开index页面
				} else {
					$api.addCls($api.byId('cjfx'), 'btn-top-active');
					$api.removeCls($api.byId('btn_title'), 't_display_b');
					$api.removeCls($api.byId('back'), 't_display_n');
					commonCloseFrame('xybg_index_frame');
					var pageParamJson={"header_h":header_h,'winName':api.winName};//打开frame页面所需参数
					if(is_hhcj){
					   commonOpenWin('hhcj_index_window', '../hhcj/hhcj_index_window.html', false, false, pageParamJson)
					}else{
					   commonOpenFrame('cjfxXs_index_frame', 'cjfxXs/cjfxXs_index_frame.html',header_h+50, false, false,"#ffffff",pageParamJson);  //打开index页面
					}
				}
			}
		}
		
			/*
		*author:zhaoj
		*function:认领考试
		*date：20170321
		*/
		function claimExam(){
			reBackType('rlks');
			var header_h = api.pageParam.header_h;
			var pageParamJson={"header_h":header_h,'winName':api.winName};//打开frame页面所需参数
			commonOpenFrame('cjfxXs_rlks_frame', 'cjfxXs/cjfxXs_rlks_frame.html',header_h, false, false,"#ffffff",pageParamJson);	//打开index页面
		}
		
				/*
		*author:zhaoj
		*function:打开菜单页面
		*date：20170421
		*/
		function openMenuFrame(){
			api.execScript({
                name : 'xybg_index_window',
                frameName:"cjfxXs_index_frame",
                script : 'openMenuFrame();'
            });
		}
		
	   /*
		*author:zhaoj
		*function:筛选考试
		*date：20170424
		*/
		function screenTest(){
			api.execScript({
                name : 'xybg_index_window',
                frameName:"cjfxXs_menu_frame",
                script : 'screenTest();'
            });
		}
	</script>
</html>