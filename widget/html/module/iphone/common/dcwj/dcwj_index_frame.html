<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<!-- html5：在创建html时为了防止页面缩放等不兼容效果，要创建个viewport  -->
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<!-- 在IOS设备上，有时会将数字转为手机号，这里也要禁止下 -->
		<meta name="format-detection" content="telephone=no"/>
		<title>调查问卷页面</title>
		<link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
		<link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
		<style>
			body{background:#efefef;}
			.content{padding:10px;}
			.content li{border-radius:5px;background:#ffffff;position:relative;margin-top:10px;}
			.content li:first-child{margin-top:0;}
			.content li .title-phone{padding:15px 20px 0 10px;}
			.content li .bottom{padding:15px 10px 15px 10px;color:#808080;}
			.content li .bottom .status{font-size:13px;}
			.content li .bottom .status0{/*color:#808080;*/}
			.content li .bottom .status2{/*color:#FA4848;*/}
			.content li .bottom .sjsj{display:inline-block;font-size:13px;padding-right:8px;}
			.content li .bottom .sjsj font{display:inline-block;padding:0 3px;}
			.content li .bottom .time{display:inline-block;font-size:13px;}
			.content li .tip{position:absolute;right:0;top:0;width:50px;height:50px;}
			.jg-tip{display:inline-block;padding:1px 7px;border-radius:13px;background:#79aca2;color:#ffffff;font-size:12px;float:left;margin-right:7px;}
			.content li .tip.sjz{background:url(../../../../../image/fun-module/iphone/dcwj.png) 0 0 no-repeat;background-size:50px 250px;}
			.content li .tip.yjs{background:url(../../../../../image/fun-module/iphone/dcwj.png) 0 -50px no-repeat;background-size:50px 250px;}
			.content li .tip.wfb{background:url(../../../../../image/fun-module/iphone/dcwj.png) 0 -100px no-repeat;background-size:50px 250px;}
			.content li .tip.wzd{background:url(../../../../../image/fun-module/iphone/dcwj.png) 0 -150px no-repeat;background-size:50px 250px;}
			.content li .tip.yzd{background:url(../../../../../image/fun-module/iphone/dcwj.png) 0 -200px no-repeat;background-size:50px 250px;}
			.title{border-left:0px !important;}
		</style>
	</head>
	<body class="common-Iphone-dcwjIphone-common">
		<ul id="j_create" class="content">
			<!--<li onclick="haveOpt(0,6,'5YWz5LqO6Ieq6KGM6L2m55qE5pyq5p2l5raI6LS56ZyA5rGC55qE6Zeu5Y23');">
				<div class="title ellipsis">关于自行车的未来消费需求的问卷</div>
				<div class="bottom">
					<span class="sjsj">数据收集<font>0</font>份</span>
					<span class="time">2017-10-29 15:25:25</span>
				</div>
				<div class="tip sjz"></div>
			</li>
			<li onclick="haveOpt(0,6,'5YWz5LqO6Ieq6KGM6L2m55qE5pyq5p2l5raI6LS56ZyA5rGC55qE6Zeu5Y23');">
				<div class="title ellipsis">关于自行车的未来消费需求的问卷</div>
				<div class="bottom">
					<span class="sjsj">数据收集<font>12</font>份</span>
					<span class="time">2017-10-29 15:25:25</span>
				</div>
				<div class="tip yjs"></div>
			</li>
			<li onclick="haveOpt(0,6,'5YWz5LqO6Ieq6KGM6L2m55qE5pyq5p2l5raI6LS56ZyA5rGC55qE6Zeu5Y23');">
				<div class="title ellipsis"><span class="jg-tip">机构</span>关于自行车的未来消费需求的问卷</div>
				<div class="bottom">
					<span class="sjsj">数据收集<font>0</font>份</span>
					<span class="time">2017-10-29 15:25:25</span>
				</div>
				<div class="tip sjz"></div>
			</li>
			<li onclick="openDetailWindow(1)">
				<div class="title ellipsis">关于自行车的未来消费需求的问卷</div>
				<div class="bottom">
					<span class="sjsj">数据收集<font>12</font>份</span>
					<span class="time">2017-10-29 15:25:25</span>
				</div>
				<div class="tip wfb"></div>
			</li>
			<li onclick="haveOpt(0,6,'5YWz5LqO6Ieq6KGM6L2m55qE5pyq5p2l5raI6LS56ZyA5rGC55qE6Zeu5Y23');">
				<div class="title ellipsis"><span class="jg-tip">机构</span>关于自行车的未来消费需求的问卷</div>
				<div class="bottom">
					<span class="sjsj">数据收集<font>12</font>份</span>
					<span class="time">2017-10-29 15:25:25</span>
				</div>
				<div class="tip yjs"></div>
			</li>-->
		</ul>
		<script type="text/html" id="create_script">
			<%if(list.length == 0){%>
				<div class="no-data">暂无问卷</div>
			<%}else{%>
				<%for(var i = 0; i < list.length; i++){%>
					<%if(list[i].status==0){%>
						<li onclick="openDetailWindow(1,'',<%=list[i].id%>,'<%=list[i].name_base64%>')">
							<div class="title-phone ellipsis">
								<%if(list[i].source == 1){%>
									<span class="jg-tip">机构</span>
								<%}%>
								<%=list[i].title%>
							</div>
							<div class="bottom">
								<span class="sjsj">数据收集<font><%=list[i].answer_num%></font>份</span>
								<span class="time"><%=list[i].release_time%></span>
							</div>
							<div class="tip wfb"></div>
						</li>
					<%}else{%>
						<li onclick="haveOpt(0,'',<%=list[i].id%>,'<%=list[i].name_base64%>')">
							<div class="title-phone ellipsis">
								<%if(list[i].source == 1){%>
									<span class="jg-tip">机构</span>
								<%}%>
								<%=list[i].title%>
							</div>
							<div class="bottom">
								<span class="sjsj">数据收集<font><%=list[i].answer_num%></font>份</span>
								<span class="time"><%=list[i].release_time%></span>
							</div>
							<div class="tip <%if(list[i].status==1){%>sjz<%}else{%>yjs<%}%>"></div>
						</li>
					<%}%>
				<%}%>
			<%}%>
		</script>
		<ul id="j_invitation" class="content" style="display: none">
			<!--<li onclick="openDetailWindow(0,<%=list[i].s_u_id%>,6,'5YWz5LqO6Ieq6KGM6L2m55qE5pyq5p2l5raI6LS56ZyA5rGC55qE6Zeu5Y23')">
				<div class="title ellipsis">关于自行车的未来消费需求的问卷</div>
				<div class="bottom">
					<span class="time">2017-10-29 15:25:25</span>
				</div>
				<div class="tip wzd"></div>
			</li>
			<li onclick="haveOpt(1,6,'5YWz5LqO6Ieq6KGM6L2m55qE5pyq5p2l5raI6LS56ZyA5rGC55qE6Zeu5Y23');">
				<div class="title ellipsis">关于自行车的未来消费需求的问卷</div>
				<div class="bottom">
					<span class="status status1">[收集中]</span>
					<span class="sjsj">数据收集<font>132</font>份</span>
					<span class="time">2017-10-29 15:25:25</span>
				</div>
				<div class="tip yzd"></div>
			</li>
			<li onclick="openDetailWindow(0,<%=list[i].s_u_id%>,6,'5YWz5LqO6Ieq6KGM6L2m55qE5pyq5p2l5raI6LS56ZyA5rGC55qE6Zeu5Y23')">
				<div class="title ellipsis">关于自行车的未来消费需求的问卷</div>
				<div class="bottom">
					<span class="time">2017-10-29 15:25:25</span>
				</div>
				<div class="tip wzd"></div>
			</li>
			<li onclick="haveOpt(1,6,'5YWz5LqO6Ieq6KGM6L2m55qE5pyq5p2l5raI6LS56ZyA5rGC55qE6Zeu5Y23');">
				<div class="title ellipsis">关于自行车的未来消费需求的问卷</div>
				<div class="bottom">
					<span class="time">2017-10-29 15:25:25</span>
				</div>
				<div class="tip yzd"></div>
			</li>-->
		</ul>
		<script type="text/html" id="invitation_script">
			<%if(list.length == 0){%>
				<div class="no-data">暂无问卷</div>
			<%}else{%>
				<%for(var i = 0; i < list.length; i++){%>
					<%if(list[i].is_answer==0){%>
						<li onclick="openDetailWindow(0,'',<%=list[i].id%>,'<%=list[i].name_base64%>')">
							<div class="title-phone ellipsis">
								<%=list[i].title%>
							</div>
							<div class="bottom">
								<span class="status status<%=list[i].status%>">[<%=list[i].status_name%>]</span>
								<span class="sjsj">数据收集<font><%=list[i].answer_num%></font>份</span>
								<span class="time"><%=list[i].release_time%></span>
							</div>
							<div class="tip wzd"></div>
						</li>
					<%}else{%>
						<li <%if(list[i].is_query_res){%>onclick="haveOpt(1,<%=list[i].s_u_id%>,<%=list[i].id%>,'<%=list[i].name_base64%>')"<%}else{%>onclick="haveOpt(2,<%=list[i].s_u_id%>,<%=list[i].id%>,'<%=list[i].name_base64%>')"<%}%>>
							<div class="title-phone ellipsis">
								<%=list[i].title%>
							</div>
							<div class="bottom">
								<span class="status status<%=list[i].status%>">[<%=list[i].status_name%>]</span>
								<span class="sjsj">数据收集<font><%=list[i].answer_num%></font>份</span>
								<span class="time"><%=list[i].release_time%></span>
							</div>
							<div class="tip yzd"></div>
						</li>
					<%}%>
				<%}%>
			<%}%>
		</script>
	</body>
	<script type="text/javascript" src="../../../../../script/api.js" ></script>
	<script type="text/javascript" src="../../../../../script/base_config.js" ></script>
	<script type="text/javascript" src="../../../../../script/plug-in/base64.js" ></script>
	<script type="text/javascript" src="../../../../../script/plug-in/template.js" ></script>
	<script type="text/javascript" src="../../../../../script/common/common.js" ></script>
	<script type="text/javascript" src="../../../../../script/common/iphone/dcwj_common.js" ></script>
	<script type="text/javascript">
		var header_h;//定义头高度
		var totalPages = 0;// 定义一个变量存储第一次加载返回来的总页数
		var keyword = '';//菜单关键字
		var currentPage;//当前页面为第一页
		var totalPages;//数据的总页数
		var BASE_URL_ACTION;
		var m_type = 1;//1代表我创建的，2代表邀请我的
		var status;//分类id
		apiready = function() {
			commonSetTheme({"level":5,"type":0});
			header_h = api.pageParam.header_h;
			BASE_URL_ACTION = $api.getStorage('BASE_URL_ACTION');
			currentPage = 1;
			showSelfProgress('加载中...');
			openMyNavigationBar(api.pageParam.type);
			//加载上拉加载数据方法
			scrollBottomReload();
			//下拉刷新
			refreshDataInfo();
		};
		/*
		*作者:zhaoj
		*功能:滑动条点击回调函数
		*日期：20160929
		*/
		function callBackNew(id, index) {
			currentPage = 1;
			status = id;
			if(m_type == 1){ 
				$api.css($api.byId('j_invitation'),'display:none;');
				$api.css($api.byId('j_create'),'display:block;');
			}else{
				$api.css($api.byId('j_create'),'display:none;');
				$api.css($api.byId('j_invitation'),'display:block;');
			}
			initData(currentPage);
		}
		/*
		*作者:zhaoj
		*功能:获取列表数据
		*日期：20161008
		*/
		function initData(current_page){
			currentPage = current_page;
			if(m_type == 1){
				getSurveyList(current_page,function(flag,ret){
					api.hideProgress();
					if(flag){
						totalPages = ret.total_page;
						for(var i = 0; i < ret.list.length; i++){
							ret.list[i].name_base64 = Base64.encode(ret.list[i].title);
						}
						addTemplateHtml('j_create', 'create_script', ret)
					}else{
						popToast('获取问卷失败，请稍候再试！');
					}
				});
			}else{
				getPermission(current_page,function(flag,ret){
					api.hideProgress();
					if(flag){
						totalPages = ret.total_page;
						for(var i = 0; i < ret.list.length; i++){
							ret.list[i].name_base64 = Base64.encode(ret.list[i].title);
							if(ret.list[i].status == 0){
								ret.list[i].status_name = '未发布';
							}else if(ret.list[i].status == 1){
								ret.list[i].status_name = '收集中';
							}else{
								ret.list[i].status_name = '已结束';
							}
						}
						addTemplateHtml('j_invitation', 'invitation_script', ret)
					}else{
						popToast('获取问卷失败，请稍候再试！');
					}
				})
			}
		}
		/*
		*作者:zhaoj
		*功能:打开详情页面
		*日期：20161103
		*/
		function openDetailWindow(type,answer_id,id,name_base64){
			commonOpenWin('dcwj_detail_window', 'dcwj_detail_window.html', false, false, {'header_h':header_h,'id':id,'type':type,'name_base64':name_base64,'answer_id':answer_id})
		}
	</script>
</html>