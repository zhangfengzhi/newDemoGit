<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>另存为</title>
    <link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
    <link id="j_theme_base" rel="stylesheet" type="text/css" href="" /><style>
    	body{background:transparent;}
    	.shadow{position:absolute;left:0;top:0;width:100%;height:100%;z-index: -1;background:transparent;}
    	.shadow{position:absolute;left:0;top:0;width:100%;height:100%;z-index: 1;background:#000000;opacity:0;}
    	.main{position:absolute;z-index:2;width:86%;height:234px;left:50%;top:50%;margin-left:-43%;margin-top:-117px;z-index: 2;background:#ffffff;box-shadow: 0 2px 5px 3px #666666;}   
    	.title-save{ height:63px;line-height:63px; padding-left:4%;font-weight:bold;font-size:20px;}	
    	.button{height:47px;border-top:1px solid #e6e6e6;}
    	.smt-btn,.cnl-btn{width:50%;height:47px;border:0;background:#ffffff;float: left;}
    	.smt-btn{border-right:1px solid #e6e6e6 !important;}
    	.content{position:relative;height:122px;}
    	.bdr-rdu{border-radius:2px;}
    	.bdr-rdu-top{border-radius:2px 2px 0 0;}
    	.bdr-rdu-bottom{border-radius:0 0 2px 2px;}
    	.bdr-rdu-bottom-left{border-radius:0 0 0 2px;}
    	.bdr-rdu-bottom-right{border-radius:0 0 2px 0;}
    	.btn-click{background : #50b350;}
    	.name{float:left;top:24px;padding-left:5%;padding-top:10px;min-width:80px;width:30%;}
    	.input-div{position:relative;display:inline-block;margin-right:5%;float:right;padding-top:12px;width:90%;}
    	.input-div input{border:1px solid #cccccc;border-radius:3px;line-height:16px;padding:9px 5px;width:100%;}
    	.tip{position:absolute;right:0;bottom:-12px;height:20px;line-height:20px;font-size:12px;color:#bbbbbb;}
    </style>
</head>
<body class="common-iphone-zuoye-tea">	
	<div id="j_shadow" class="shadow" tapmode></div>
	<div class="main bdr-rdu">
		<div id="title" class="title-save bdr-rdu-top">另存为</div>
		<div class="content">
			<div class="name">检测名称</div>
			<div class="input-div">
				<input id="fl_val" type="text" oninput='showTip(this.value.length,this);' maxlength="30" />
				<div id="tip" class="tip">30</div>
			</div>
		</div>
		<div class="button bdr-rdu-bottom">
			<button class="smt-btn bdr-rdu-bottom-left" tapmode="btn-click" onclick="closeFrame();">取消</button>
			<button class="cnl-btn bdr-rdu-bottom-right" tapmode="btn-click" onclick="saveAsZy();">确定</button>
		<div>
	</div>
</body>
<script type="text/javascript" src="../../../../../script/api.js"></script>
<script type="text/javascript" src="../../../../../script/base_config.js" ></script>
<script type="text/javascript" src="../../../../../script/plug-in/base64.js" ></script>
<script type="text/javascript" src="../../../../../script/common/common.js" ></script>
<script type="text/javascript" src="../../../../../script/common/jszy_jy_common.js"></script>
<script type="text/javascript">
	apiready = function(){
		commonSetTheme({"level":5,"type":0});	
		$api.val($api.byId('fl_val'), Base64.decode(api.pageParam.zy_name_base64));
		showTip(Base64.decode(api.pageParam.zy_name_base64).length,"");
	};
	/*
	*author:zhaoj
	*function:提示问题描述或课堂评价描述剩余多少字符
	*date：20160315
	*/
	function showTip(length,self){
        var count = 30 - length;
        $api.text($api.byId('tip'),count);
        if(self !=""){
            commonRemoveExpression(self);
        }
    }
	/*
	*author:zhaoj
	*function:关闭当前frame
	*date：20160315
	*/
	function closeFrame(){
		commonExecScript('zuoyeJsJy_index_window','','reBackType("index");',0);
		api.closeFrame({name:'zuoyeJsJy_save_frame'});
	}
	/*
	*作者:zhaoj
	*功能:另存为检测
	*日期：20160920
	*/
	function saveAsZy(){
		$api.css($api.byId('j_shadow'),'z-index:3');
		var value = $api.trimAll($api.val($api.byId('fl_val')));
		if(value.length == 0){
			popAlert('检测名称不可以为空');
			$api.css($api.byId('j_shadow'),'z-index:-1');
			return;
		}
		showSelfProgress('另存检测中...');
		api.ajax({
			url : BASE_URL_ACTION + '/xx/saveAsZy',
			method : 'get',
			timeout : 30,
			dataType : 'json',
			data : {
				values : {
					"random_num" : creatRandomNum(),
					"zy_id" : api.pageParam.zy_id,
					"zy_type" : 1,
					"person_id" : $api.getStorage("person_id"),
					"identity_id" : $api.getStorage("identity"),
					"zy_name":$api.val($api.byId('fl_val'))
				}
			},
			headers : {
	'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
}
		}, function(ret, err) {
			api.hideProgress();
			if (err) {
				popToast('检测另存为失败');
				$api.css($api.byId('j_shadow'),'z-index:-1');
			} else {
				if(ret.success){
					popToast(ret.info);
					commonExecScript('zuoyeJsJy_index_window','zuoyeJsJy_index_frame','accordCommonBarIdGetData();',1);
					setTimeout(function(){
						commonExecScript('zuoyeJsJy_index_window','','reBackType("index");',0);
						api.closeFrame({name:'zuoyeJsJy_save_frame'});
					},2000);
				}else{
				 popToast('检测另存为失败');
				 $api.css($api.byId('j_shadow'),'z-index:-1');
				}
			}
		});
	}
</script>
</html>