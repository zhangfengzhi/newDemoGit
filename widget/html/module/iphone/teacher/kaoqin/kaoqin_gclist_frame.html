<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no" />
    <title>我的考勤</title>
    <link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css"/>
    <link rel="stylesheet" type="text/css" href="../../../../../css/module/common/aui-list-swipe.css" />
    <link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
    <style>
    	.person-name{display:inline-block;max-width:29%;margin-right:1%;}
    	.reason{display:inline-block;max-width:29%;margin-right:1%;}
    	.tip{display:inline-block;max-width:40%;color:#ff0000;}
    	.ellipsis{white-space: nowrap;overflow: hidden;text-overflow: ellipsis;}
    	.leave-reason{max-width:100%;}
    	.tip-image{position:absolute;top:-12px;right:-15px;width:38px;}
    	.aui-swipe-div{position:relative;}
    	.aui-list-view:before{height:0;}
    /*.aui-list-view:after{height:0;}*/
    	.aui-user-view-cell:last-child:after {position: absolute;left: 15px;right: 0;bottom: 0;height: 1px;content: '';background-color: #c8c7cc;-webkit-transform: scaleY(.5);transform: scaleY(.5);}
    	.aui-list-view::after{height:0;}
    	.no-data{color:#666666;text-align:center;line-height:45px;}
    	.aui-list-view .aui-img-object{width:60px;}
    	.fl{float:left}
    </style>
</head>
<body class="common-iphone-kaoqin">
	<section class="aui-content" id="banner">
		<ul id="gc_body" class="aui-list-view">
<!--            <li class="aui-list-view-cell aui-img" tapmode onclick="showMsg(this);">
            	<div class="aui-swipe-handle">
	                <img class="aui-img-object aui-pull-left" onerror="this.src='../../../../../image/fun-module/iphone/kaoqin/default.png'"  src="../../../../../image/fun-module/iphone/kaoqin/default.png" />
	                <div class="aui-img-body">
	                    <div class="person-name ellipsis">张晓萌</div>
	                    <div class="reason">[出差]</div>
	                    <p>6-20 15:15&nbsp;&nbsp;3小时</p>
	                    <p class="leave-reason ellipsis">去云南楚雄部署程序并调试问题。</p>
	                </div>
                </div>
            	<div class="aui-swipe-right-btn aui-bg-danger" a="1">撤销</div>
            	<div class="aui-swipe-right-btn aui-bg-warning" a="2">补充</div>
            </li>
            <li class="aui-list-view-cell aui-img" tapmode onclick="showMsg(this);">
            	<div class="aui-swipe-handle">
	                <img class="aui-img-object aui-pull-left" onerror="this.src='../../../../../image/fun-module/iphone/kaoqin/default.png'"  src="../../../../../image/fun-module/iphone/kaoqin/default.png" />
	                <div class="aui-img-body">
	                    <div class="person-name ellipsis">张晓萌</div>
	                    <div class="reason">[公出]</div>
	                    <p>6-20 15:15&nbsp;&nbsp;1天</p>
	                    <p class="leave-reason ellipsis">去外国语学院做理想人人通的技术支持。</p>
	                </div>
	                <img class="tip-image" src="../../../../../image/fun-module/iphone/kaoqin/shenpi.png" />
                </div>
              	<div class="aui-swipe-right-btn aui-bg-warning" a="2">补充</div>
            </li>
            <li class="aui-list-view-cell aui-img" tapmode onclick="showMsg(this);">
            	<div class="aui-swipe-handle">
	               <img class="aui-img-object aui-pull-left" onerror="this.src='../../../../../image/fun-module/iphone/kaoqin/default.png'"  src="../../../../../image/fun-module/iphone/kaoqin/default.png" />
	                <div class="aui-img-body">
	                    <div class="person-name ellipsis">张晓萌</div>
	                    <div class="reason">[公出]</div>
	                    <p>6-20 15:15&nbsp;&nbsp;1天3小时</p>
	                    <p class="leave-reason ellipsis">去外国语学院做理想人人通的技术支持。</p>
	                </div>
	                 <img class="tip-image" src="../../../../../image/fun-module/iphone/kaoqin/pass.png" />
                </div>
              	<div class="aui-swipe-right-btn aui-bg-warning" a="2">补充</div>
            </li>-->
        </ul>
        <script type="text/html" id="gc_script">
			<% if(list.length == 0){ %>
				<div class="no-data"><span>暂无公出</span></div>
			<% }else{ %>
				<%for(var i=0; i<list.length; i++) {%>
					<li class="aui-user-view-cell aui-img" tapmode onclick="openXq(this,'<%=list[i].leave_id%>',<%=list[i].status_id%>,<%=list[i].status_id%>);">
		            	<div  class="aui-swipe-div <%if(list[i].status_id!=4 && list[i].status_id!=3 && list[i].status_id!=5){%>aui-swipe-handle<%}%>">
			               <img class="aui-img-object aui-pull-left" onerror="this.src='../../../../../image/fun-module/iphone/kaoqin/<%=list[i].type_id%>.png'"  src="../../../../../image/fun-module/iphone/kaoqin/<%=list[i].type_id%>.png" />
			                <div class="aui-img-body">
			                    <div class="person-name ellipsis <%if(list[i].cancel_status==1){%>fl<%}%>"><%=list[i].person_name%></div>
			                    <!--<div class="reason <%if(list[i].cancel_status==1){%>fl<%}%>">[<%=list[i].type_name%>]</div>-->
			                    <%if(list[i].cancel_status==1){%>
									<div class="tip">*撤回被驳回</div>
			               		<%}%>
			                    <p><%=list[i].start_time%>&nbsp;&nbsp;<%=list[i].time%></p>
			                    <p class="leave-reason ellipsis"><%=list[i].content%></p>
			                </div>
			                <%if(list[i].status_id==1){%>
			                 	<img class="tip-image" src="../../../../../image/fun-module/iphone/kaoqin/shenpi.png" />
			                <%}else if(list[i].status_id==2){%>
			                	<img class="tip-image" src="../../../../../image/fun-module/iphone/kaoqin/pass.png" />
			                <%}else if(list[i].status_id==3){%>
			                	<img class="tip-image" src="../../../../../image/fun-module/iphone/kaoqin/no-pass.png" />
			                <%}else if(list[i].status_id==4){%>
			                	<img class="tip-image" src="../../../../../image/fun-module/iphone/kaoqin/yichexiao.png" />
			                <%}else{%>
			                	<img class="tip-image" src="../../../../../image/fun-module/iphone/kaoqin/undo.png" />
			                <%}%>
		                </div>
		              <!--  <%if(list[i].status_id==1 || list[i].status_id==2){%>
		                	<div class="aui-swipe-right-btn aui-bg-danger" ruleType="2" type="1" levelId=<%=list[i].leave_id%> tapmode onclick="rightBtn(this);">撤回<br />公出</div>
		                 	<div class="aui-swipe-right-btn aui-bg-warning" ruleType="2" type="2" levelId=<%=list[i].leave_id%> tapmode onclick="rightBtn(this);">补充<br />附件</div>
		                <%}%>-->
		            </li>
				<% } %>
			<% } %>
		</script>
	</section>
</body>
<script type="text/javascript" src="../../../../../script/api.js"></script>
<!--<script type="text/javascript" src="../../../../../script/zepto_list.min.js"></script>-->
<script type="text/javascript" src="../../../../../script/plug-in/aui-list-swipe.js"></script>
<script type="text/javascript" src="../../../../../script/base_config.js" ></script>
<script type="text/javascript" src="../../../../../script/plug-in/template.js" ></script>
<script type="text/javascript" src="../../../../../script/common/common.js"></script>
<script type="text/javascript" src="../../../../../script/common/kaoqin_common.js"></script>
<script type="text/javascript">
	var header_h;
	var swipe;
	apiready = function(){
		commonSetTheme({"level":5,"type":0});
		header_h = api.pageParam.header_h;
		initData(1);
		//下拉刷新
		refreshDataInfo();
	};
	/*
	 *author:zhaoj
	 *function:初始化数据
	 *date：20160622
	 */
	function initData(is_show){
		getMyLeave(is_show,2,function(ret,flag){
			if(flag){
				dealData(ret,function(flag){
					api.parseTapmode();
					// 初始化
//					swipe = new ListSwipe();
					//initSwipe();
				})
			}
		})
	}
	/*
	 *author:zhaoj
	 *function:处理数据
	 *date：20160622
	 */
	function dealData(ret,callback){
		for(var i = 0; i < ret.list.length; i++){
			ret.list[i].start_time = ret.list[i].start_time.substring(0,16);
			var time='';
			if(ret.list[i].days*1>0){
				time = ret.list[i].days+'天';
			}
			if(ret.list[i].hours*1>0){
				time = time + ret.list[i].hours+'小时';
			}
			if(ret.list[i].minutes*1>0){
				time = time + ret.list[i].minutes+'分钟';
			}
			if(time){
				time = '共'+time;
			}
			ret.list[i].time = time;
		}
		addTemplateHtml('gc_body', 'gc_script', ret,1);
		callback(true);
	}
//	function rightBtn(obj){
//		var type = obj.getAttribute('type') * 1;
//		var levelId = obj.getAttribute('levelId');
//		switch(type) {
//			case 1:
//				cancelLeave(levelId);
//				break;
//			case 2:
//				openMybcWin(obj.getAttribute('ruleType') * 1, levelId, 1)
//				break;
//			default:
//				break;
//
//		}
//	}

	/*
	 * 功能：打开选择页面
	 * 作者：张自强
	 * 时间：20171109
	 */
	function openXq(el,leave_id,status_id,status_id){
		if(status_id == 1 || status_id == 2){
			var  buttons = ['查看详情','补充附件','撤回公出'];
			commonOpenActionSheet('','取消', '', buttons, function(index){
				if(index == 1){
					openKqxqWin(1,leave_id,'kaoqin_myKqxq_window',status_id);
		         }
		         if(index == 2){
		         	openMybcWin(2,leave_id,'kaoqin_myKqxq_window',status_id);
		         }
		         if(index == 3){
		         	cancelLeave(leave_id);
		         }
			});
		}else{
			openKqxqWin(0,leave_id,'kaoqin_myKqxq_window',status_id);	
		}
	}
</script>
</html>