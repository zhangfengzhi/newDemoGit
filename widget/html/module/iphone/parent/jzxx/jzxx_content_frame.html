<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <!-- html5：在创建html时为了防止页面缩放等不兼容效果，要创建个viewport  -->
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
        <!-- 在IOS设备上，有时会将数字转为手机号，这里也要禁止下 -->
        <meta name="format-detection" content="telephone=no"/>
        <title>新闻资讯数据页面</title>
        <link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
        <link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
        <style>
            .h1 {
                height: 1px;
                background: #f0f0f0;
            }
            .title {
                font-size: 20px;
                padding: 5px 15px 15px 15px;
                line-height: 30px;
                color: #484848;
                word-break: break-all;
                word-wrap: break-word;
            }
            .create-time {
                display: inline-block;
                float: right;
                color: #C7C7C7;
                font-size: 12px;
            }
            .aui-img-body {
                display: inline-block;
                max-width: 50%;
                color: #C7C7C7;
                font-size: 12px;
            }
            .ellipsis {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .content {
                color: #3A3A3A;
                padding: 10px 15px;
                word-break: break-all;
                word-wrap: break-word;
                font-size: 16px;
            }
            .content table, .content p, .content div {
                max-width: 100% !important;
                word-break: break-all;
                word-wrap: break-word;
                height: auto !important;
                color: #3A3A3A;
                font-size: 16px;
            }
            .ima_notice {
                padding: 12px 0;
            }
        </style>
    </head>
    <body class="common-iphone-jzxx-par">
        <div class="aui-content">
            <div id="notice_title_div" class="title"></div>
            <div style="padding: 5px 15px; " id="notice_sec_title"></div>
            <div id="notice_con_div" class="content"></div>
            <!--<ul class="aui-list-view aui-grid-view">
            <li class="aui-list-view-cell aui-img aui-col-xs-12">
            <img class="aui-img-object" src="../../../../../image/cs.png">
            <p class="aui-img-body">
            2015年3月13日，伊拉克辛加尔山区，一名库尔德女兵站在一个安全据点。
            </p>
            </li>
            </ul>-->
            <!--<ul class="aui-list-view aui-grid-view">
            <li class="aui-list-view-cell aui-img aui-col-xs-12">
            <img class="aui-img-object" src="http://photocdn.sohu.com/20151119/Img427129326.jpg">
            <p class="aui-img-body">
            截止去年，"库尔德自由斗士第二营"已保持18年零阵亡记录。
            </p>
            </li>
            </ul>-->
        </div>
    </body>
    <script type="text/javascript" src="../../../../../script/api.js" ></script>
    <script type="text/javascript" src="../../../../../script/base_config.js" ></script>
    <script type="text/javascript" src="../../../../../script/plug-in/template.js" ></script>
    <script type="text/javascript" src="../../../../../script/base_config.js" ></script>
    <script type="text/javascript" src="../../../../../script/plug-in/base64.js" ></script>
    <script type="text/javascript" src="../../../../../script/common/common.js"></script>
    <script type="text/javascript" src="../../../../../script/assembly/photoBrowser.js"></script>
    <script type="text/javascript">
        var image_array=[];//所有图片路径
        apiready = function() {
            commonSetTheme({"level":5,"type":0});
            initData();
        };
         /*
        *author:zhaoj
        *function:初始换数据
        *date：201710231
        */
        function initData(){
            showSelfProgress('加载中...');
            if(api.pageParam.type == 1 || api.pageParam.type == 2){
                loadNoticeContentData()
            }else{
                loadWzContentData();
            }
        }
        /**
         * 加载新闻资讯内容
         * zhaoj
         * 2015.11.24
         */
        function loadNoticeContentData() {
            api.ajax({
                url : BASE_URL_ACTION + '/notice/getNoticeById?notice_id=' + api.pageParam.id,
                method : 'get',
                timeout : 30,
                dataType : 'json',
                cache : false
            }, function(ret, err) {
                api.hideProgress();
                if (ret.success) {
                    var notice_con = ret.notice.content;
                    var notice_str1 = '';
                    var notice_str2 = '';
                    var notice_str11 = '';
                    var  onerror_img="this.src='../../../../../image/common/tpsx.png'";
                    if (BASE_APP_TYPE == 1) {
                        notice_str1 = 'src=\"down\/Material\/';
                        notice_str11 = 'src=\"' + url_path_down + 'down\/Material\/';
                        //解决云版图片不缩放问题
                        notice_str5 = '<img';
                        notice_str2 = '<img class="ima_notice" onerror='+onerror_img+' onclick="openImage(this)"';
                        //解决网络图片不缩放问题
                        notice_str6 = '<img src=';
                        notice_str7 = '<img class="ima_notice" src=';
                    } else {
                        notice_str1 = 'src=\"/dsideal_yy/';
                        notice_str2 = 'class="ima_notice" src=\"' + BASE_URL_ACTION + '\/';
                        notice_str6 = '<img';
                        notice_str7 = '<img class="ima_notice" onerror='+onerror_img+' onclick="openImage(this)"';
                    }
                    var notice_str3 = '<p>';
                    var notice_str4 = '<p style="font-size: 16px; color: #000000;">'
                    if (BASE_APP_TYPE == 1) {
//                      notice_con = notice_con.replaceAll(notice_str1, notice_str2);
//                      notice_con = notice_con.replaceAll(notice_str11, notice_str2);
//                      notice_con = notice_con.replaceAll(notice_str5, notice_str2);
//                      notice_con = notice_con.replaceAll(notice_str6, notice_str7);
//                      // notice_con = notice_con.replaceAll(notice_str3,notice_str4);
                        notice_con = notice_con.replaceAll(notice_str1, notice_str11);
                        notice_con = notice_con.replaceAll(notice_str5, notice_str2);
                        notice_con = notice_con.replaceAll(notice_str6, notice_str7);
                    } else {
                        notice_con = notice_con.replaceAll(notice_str1, notice_str2);
                        notice_con = notice_con.replaceAll(notice_str6, notice_str7);
                    }
                    var notice_title = ret.notice.title;
                    var notice_person_name = ret.notice.person_name;
                    var notice_create_time = ret.notice.create_time.substring(0, 16);
                    var notice_sec_title = '<span class="aui-img-body ellipsis">' + notice_person_name + '</span><span class="create-time">' + notice_create_time + '</span>';
                    notice_con = commonTransferBrStr(notice_con);
                    notice_con.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi, function (match, capture) {
                      image_array.push(capture);
                    });
                    $api.html($api.byId('notice_title_div'), notice_title);
                    $api.html($api.byId('notice_sec_title'), notice_sec_title);
                    $api.html($api.byId('notice_con_div'), notice_con);
                } else {
                    api.alert({
                        msg : '对不起，获取新闻资讯内容失败'
                    });
                }
            });
        }
        /*
        *author:zhaoj
        *function:打开图片预览
        *date：20171026
        */
        function openImage(self){
            //图片
            var res_url=$api.attr(self, 'src');
            //打开图片
            var index = 0;
            for(var i = 0; i <image_array.length;i++){
                if(image_array[i] == res_url){
                    index = i;
                }
            }
            photoBrowser.open(image_array, index);
        }
        /**
         * 加载数据
         * 周枫
         * 2016.2.29
         */
        function loadWzContentData() {
            showSelfProgress('加载中...');
            addBrowseNum( function(is_true, data) {
                var typeUrl ='http://www.edusoa.com/dsideal_yy/ypt/blog/getArticleById?id=' + api.pageParam.id + '&expand_id=' + api.pageParam.expand_id;
                api.ajax({
                    url : typeUrl,
                    method : 'get',
                    timeout : 30,
                    dataType : 'json',
                    headers : {
                        'Cookie' : 'person_id=284494; identity_id=5; token=9da6005cc0e6acabdf681254edf39ea4;'
                    }
                }, function(ret, err) {
                     api.hideProgress();
                    if (err) {
                        popToast('获取家长讲堂失败，请稍候重试');
                    } else {
                        if(ret.success){
                            if(ret.is_del*1){
                                api.hideProgress();
                                $api.html($api.byId('notice_con_div'),'<p style="width:100%;text-align:center;">该家长讲堂已被作者删除！</p>');
                            }else{
                                $api.css($api.byId('abc'),'display:block;');
                                $api.css($api.byId('footer_div'),'display:block;');
    
                                article_person_id = ret.person_id;
                                //该篇文章的详细显示
                                var div_html='';
                                var notice_con = ret.content;
                                notice_con = commonTransferBrStr(notice_con);
                                
                                if (BASE_APP_TYPE == 1) {
                                    var notice_str1 = '<img';
                                    var notice_str2 = '<img class="ima_notice" onclick="openImage(this)"' ;
                                    notice_con = notice_con.replaceAll(notice_str1, notice_str2);
                                    var key = url_path_down+url_path_suffix;
                                    var key_re = BASE_IMAGE_PRE+url_path_suffix;
                                    if(notice_con.indexOf(key) == -1){
                                        var key = '/dsideal_yy';
                                        var key_re = BASE_URL_ACTION;
                                        notice_con = notice_con.replaceAll(key, key_re);
                                    }
                                } else {
                                        var key = '/dsideal_yy';
                                        var notice_str3 = '<img';
                                        var notice_str4 = '<img class="ima_notice" onclick="openImage(this)"';
                                        notice_con = notice_con.replaceAll(notice_str3, notice_str4);
                                        if (notice_con.indexOf(key) != -1) {
                                            var key_re = BASE_URL_ACTION;
                                            notice_con = notice_con.replaceAll(key, key_re);
                                        }
                                }
                                api.hideProgress();
                                $api.html($api.byId('notice_title_div'), ret.title);
                                $api.html($api.byId('notice_con_div'), notice_con);
                                notice_con = commonTransferBrStr(notice_con);
                                notice_con.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi, function (match, capture) {
                                  image_array.push(capture);
                                });
                                var notice_sec_title = '<span class="aui-img-body ellipsis"></span><span class="create-time">' + ret.create_time.substring(0,16) + '</span>';
                                $api.html($api.byId('notice_sec_title'), notice_sec_title);
                            }
                        }else{
                            popToast('获取家长讲堂失败，请稍候重试');
                        }
                    }
                });
            });
        }
        /**
         * 添加浏览次数
         * 周枫
         * 2016.2.29
         */
        function addBrowseNum(callback) {
            api.ajax({
                url : 'http://www.edusoa.com/dsideal_yy/blog/addBrowseNum',
                method : 'post',
                timeout : 30,
                dataType : 'json',
                cache : false,
                data : {
                    values : {
                        "article_id" : api.pageParam.id,
                        "identity_id" : $api.getStorage('identity'),
                        "person_id" : $api.getStorage('person_id')
                    }
                }
            }, function(ret, err) {
                if (err) {
                    callback(false, '添加浏览次数失败');
                } else {
                    if (ret.success) {
                        callback(true, ret.info);
                    } else {
                        callback(false, '添加浏览次数失败');
                    }
                }
            });
        }
    </script>
</html>