<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<!-- html5：在创建html时为了防止页面缩放等不兼容效果，要创建个viewport  -->
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<!-- 在IOS设备上，有时会将数字转为手机号，这里也要禁止下 -->
		<meta name="format-detection" content="telephone=no"/>
		<title>通知数据页面</title>
		<link rel="stylesheet" type="text/css" href="../../../../../css/aui/aui.css" />
		 <link rel="stylesheet" type="text/css" href="../../../../../css/aui_css_new/aui.css" />
		<link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
		<style>
			.clearfix:after {content: ' ';display: block;clear: both;visibility: hidden;line-height: 0;height: 0;}
			.ellipsis {white-space: nowrap;overflow: hidden;text-overflow: ellipsis;}
			.title {font-size: 20px;padding: 5px 15px 15px 15px;line-height: 30px;color: #484848;word-break: break-all;}
			.content {color: #3A3A3A;padding: 10px 15px;word-break: break-all;}
			.content table,.content p,.content div{max-width:100% !important;word-break: break-all;word-wrap:break-word;height:auto !important;}
			.comment {position:relative;color: #3A3A3A;font-size: 16px;margin:0 15px;background:#eeeeee;margin-top:10px;}
			.comt-btn {border: 1px solid #E6E6E6;height: 40px;line-height: 40px;text-align: center;border-radius: 3px;color: #c0c0c0;}
			.comt-btn-img {width: 20px;vertical-align: middle;}
			.comment-content{padding-left:35px;}
			.comment-content i{display: block;width: 35px;height: 20px;position: absolute;left: 5px;overflow: hidden;background: url(../../../../../image/fun-module/common/praise-comment.png) center -18px no-repeat;background-size: auto 35px;top: 10px;}
			.comment-content li {padding-bottom :8px;margin:0 5px 0 5px;border-bottom:1px solid #dedede;}
			.comment-content li:last-child{border-bottom:none;}
			.comment-content .header-img {display: inline-block;width: 34px;height: 34px;margin-right: 8px;border-radius: 17px;vertical-align: middle;}
			.comment-content .details {padding-top:10px;height: 40px;color: #CACACA;font-size: 14px;margin-bottom:10px;}
			.comment-content .comt-person-name {display: inline-block;width: 100%;color:#777777;height:45px;position:relative;}
			.comment-content .comt-person-name span {position:absolute;bottom:0;left:0;}
			.comment-content .comment-text {color: #474747;font-size: 15px;word-break: break-all;}
			.comt-opt {margin-top: 7px;}
			.comt-opt div {width: 40px;float: right;text-align: right;color: #0062CC;font-size: 14px;}
			.shadow {position: absolute;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;background: #000000;opacity: 0;}
			.no-data {color: #c0c0c0;font-size:14px;padding:10px 0;line-height:18px;text-align:left !important;}
			.hr{height:10px;background:#f0f0f0;}
			.zan-content{padding:9px 8px 8px 35px;line-height:21px;font-size:14px;color:#777777;border-bottom: 1px solid #ffffff;}
			.zan-content span{word-break: break-all;}
			.footer{height:60px;}
			.triangle-down { position:absolute;width: 0; top:-8px;left:10px; height: 0;border-left: 8px solid transparent;border-right: 8px solid transparent;border-bottom: 8px solid #eeeeee; }
			.ima_notice{padding-left:0;padding-right:0;padding-top:5px;padding-bottom:0;margin-bottom:5px;}
			.quanzi-title{font-size: 16px;width:100%;text-align:center;padding: 0 20px}
			.header-quanzi{margin-bottom:10px}
			.pinglun-person-name{display:inline-block;width:45%;}
			.reply{background: url(../../../../../image/fun-module/ipad/zthd/comment-bg.png) 0 2px no-repeat; background-size: auto 13px;height:20px;}
			.delete-comt{background: url(../../../../../image/fun-module/ipad/zthd/delete.png) 4px 2px no-repeat; background-size: auto 13px;height:20px;}
			.left-dianzan{background: url(../../../../../image/fun-module/common/praise-comment.png) 5px 0px no-repeat; background-size: auto 35px;height:20px;width:40px;position:absolute;top:9px;}
			/*.left-pinglun{background: url(../../../image/fun-module/common/praise-comment.png) 5px -18px no-repeat; background-size: auto 35px;height:40px;width:40px;position:absolute;top:47px;border:1px solid red}*/
			.details-no-huifu{padding-top:10px;height: 32px;color: #CACACA;font-size: 14px;}
			.delete{float:right;background:url(../../../../../image/fun-module/common/delete.png) 1px 3px  no-repeat;background-size:auto 16px;font-size:10px;color:#8f8f94;padding-top:5px;display:none}
			.w-dianzan{float:right;background:url(../../../../../image/fun-module/ipad/zthd-praise.png) 2px 2px  no-repeat;background-size:auto 35px;font-size:10px;color:#8f8f94;margin-right:10px;height:35px;padding-top:5px}
			.y-dianzan{float:right;background:url(../../../../../image/fun-module/ipad/zthd-praised.png) 2px 3px  no-repeat;background-size:auto 35px;font-size:10px;color:#8f8f94;margin-right:10px;height:35px;padding-top:5px}
			.pinglun{float:right;background:url(../../../../../image/fun-module/common/praise-comment.png) 0 -16px  no-repeat;background-size:auto 35px;font-size:10px;color:#8f8f94;margin-right:10px;height:35px;padding-top:5px}
			.content-img{width:90%;margin:10px auto;}
			.content-img img{width:100%}
			.zan-del-pl-div{width:100%;overflow: auto;margin-bottom:10px;padding-right:10px;}
			.zan-del-pl-div span{margin-left:20px}
			.boutique-tu{float:right;background:url(../../../../../image/fun-module/ipad/zthd/boutique.png) 0 0  no-repeat;background-size:auto 35px;width:30px;height:40px;top:2px;display:none}
			.clear-boutique{float:right;text-align: center; font-size: 12px;padding:8px 8px;line-height:12px; margin-top: 4px;border-radius:50%;width:40px;height:40px;color: #fff;background: #ED1C24;display:none}
			.set-boutique{float:right;text-align: center; font-size: 12px;padding:8px 8px;line-height:12px; margin-top: 4px;border-radius:50%;width:40px;height:40px;color: #000000;background: #eeeeee;display:none}
		</style>
	</head>
	<body id="j_body" class="common-Iphone-zthdIphone-par">
		<div class="aui-user-view-cell aui-img header-zthd">			
            <img id="touxiang" class="aui-img-object aui-pull-left" style="border-radius:8px"  onerror="this.src='../../../../../image/common/header.png'" src='../../../../../image/common/header.png'>
            <div id="boutique" class="boutique-tu"></div>
            <div id="clear_boutique" class="clear-boutique" onclick="clearBoutique();">取消精品</div>
            <div id="set_boutique" class="set-boutique" onclick="setBoutique();">设置精品</div>
             <div id="boutique" class="boutique-tu"></div>
            <div class="aui-img-body" style="margin-top:5px">
                <span id="person-name" class="person-name-font"></span>
                <p class='aui-ellipsis-1'><em id="create-time"></em></p>
            </div>
        </div>
		<div id="shadow" class="shadow"></div>
		<div class="aui-content">
			<div id="j_content" class="clearfix" style="padding-top:10px">
		        <div class="quanzi-title"><span id="quanzi-title"></span></div>
			</div>
			<div id="notice_con_div" class="content clearfix"></div>
			<!--<div class="content-img">
				<img src="http://10.10.6.199/dsideal_yy/html/thumb/Material/5A/5A07E70C-245E-291A-44E9-128A5B08E978.jpg@360w_640h_100Q_1x.jpg" >
			</div>-->
			<div class="zan-del-pl-div"> 
				<div id="dianzan" class="w-dianzan" onclick="addPraiseInfo();"></br>点赞</div>
				<div class="pinglun" onclick="openCommentWindow(0,'','','','','');"></br>评论</div>	
			</div>
			<div id="abc" class="comment" style="display:none;">
				<div class="triangle-down"></div>
				<div id="zan_body" class="zan-content">
				</div>
				<div class="left-dianzan"></div>
				<script type="text/html" id="zan_script">
					<% if(praise_list.length == 0){ %>
						<span class="no-data">
							暂无点赞
						</span>
					<% }else{ %>
						<%for(var i=0; i < praise_list.length; i++) {%>
							<span style="padding:1px;margin-bottom:5px">
								<%=praise_list[i].person_name %>
								<%if(i != praise_list.length-1){%> , <%}%>
							</span>
						<% } %>
					<%}%>
				</script>
				<ul id="div_body" class="comment-content" style="position:relative;"></ul>
				<!--<div class="left-pinglun"></div>-->
				<script type="text/html" id="div_script">
					<!--<i></i>-->
					<% if(reply_list.length == 0){ %>
						<li class="no-data" style="margin-left:-35px;padding-left:35px;background: url(../../../../../image/fun-module/ipad/zthd-comment.png) 5px -10px no-repeat; background-size: auto 35px;">
							暂无评论
						</li>
						<% }else{ %>
							<%for(var i=0; i < reply_list.length; i++) {%>
							<li style="padding-left:45px;position:relative;">
							<img style="position:absolute;left:0;top:10px;width:40px;height:40px;" onerror="this.src='../../../../../image/common/header.png'" src="<%=reply_list[i].icon_url%>" margin/>
									<div class="details-no-huifu">

									<div class="comt-person-name" >
										<%if(reply_list[i].has_reply){%>
										<font class="person-name-font"><%=reply_list[i].person_name%></font>&nbsp;<font>回复</font>&nbsp;<font class="person-name-font"><%=reply_list[i].parent_person_name%></font>
											
										<%}else{%>
										<font class="person-name-font"><%=reply_list[i].person_name%></font>
											
										<%}%>
										</br>
									</div>
								</div>
								<div class="comment-text">
									<%=#reply_list[i].content %>
								</div>
								<div class="comt-opt clearfix">
									<div style="color:#a3a3a3;width:70%;float: left;text-align:left;font-size: 14px;">
										<%=reply_list[i].time%>
									</div>
									<%if(reply_list[i].b_delete){%>
									<div class="delete-comt" style="width:25px;" onclick="messageBoard_deletePost(<%=pageSize %>,<%=reply_list[i].topic_id %>,<%=reply_list[i].id %>);"></div>
									<%}%>
									<div class="reply" style="width:20px;" onclick="openCommentWindow(1,'<%=reply_list[i].id%>','<%=reply_list[i].topic_id%>',<%=reply_list[i].person_id%>,'<%=reply_list[i].person_name%>');">
									</div>
								</div>
							</li>
							<% } %>
						<%}%>
				</script>
			</div>
			<div class="footer">
				&nbsp;
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../../../../script/api.js"></script>
	<script type="text/javascript" src="../../../../../script/base_config.js" ></script>
	<script type="text/javascript" src="../../../../../script/plug-in/template.js" ></script>
	<script type="text/javascript" src="../../../../../script/common/common.js"></script>
	<script type="text/javascript" src="../../../../../script/plug-in/base64.js" ></script>
	<script type="text/javascript" src="../../../../../script/assembly/UIAlbumBrowser.js"></script>
	<script type="text/javascript" src="../../../../../script/assembly/getPicture.js"></script>
	<script type="text/javascript" src="../../../../../script/assembly/photoBrowser.js"></script>
	<script type="text/javascript" src="../../../../../script/assembly/openResource.js" ></script>
	<script type="text/javascript" src="../../../../../script/assembly/scrollPicture.js" ></script>
	<script type="text/javascript">
		var BASE_URL_ACTION;
		var BASE_APP_TYPE;
		var totalPages = 0;
		var zanTotalPages = 0;//赞总页数
		var totalData;//总页数
		var zanTotalData;
		var currentPage = 1;
		var zanCurrentPage = 1;//当前页面为第一页
		var article_person_id;//发表文章的人的id
		var header_h;
		var netAudio;//播放录音对象
		var imageArray=[];//图片路径
		var header_h;
		var is_dianzanComplete = true;
		apiready = function() {
			commonSetTheme({"level":5,"type":0});
			header_h = api.pageParam.header_h;
			netAudio = api.require('netAudio');
			header_h = api.pageParam.header_h;
			$api.attr($api.byId('touxiang'),'src',api.pageParam.avatar_fileid);
//			loadZpContentData(api.pageParam.id);
			isExistsPraise();
//			getPraiseinfoList(1);//获取评论数据
//			scrollBottomReload(); //上拉加载数据
			initData();
			commonRefreshHeaderInfo(); 
		};
		
		function initData(){
			loadZpContentData(api.pageParam.id);
			getPraiseinfoList(1);
			getCommentInfo(1);
		}
		
		
		/*
		 * 功能：加载作品详情数据
		 * 作者：张自强
		 * 时间：20171025
		 * 接口提供人：张海
		 */
		function loadZpContentData(id) {
			imageArray = [];
			showSelfProgress('加载中...');
			api.ajax({
				url:BASE_URL_ACTION+'/ypt/space/topic/get_works_by_id?works_id='+id+'&person_id='+$api.getStorage('person_id')+'&identity_id='+$api.getStorage("identity"),
				method : 'get',
				timeout : 30,
				dataType : 'json',
				headers : {
		'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				if (err) {
					popToast('获取作品详情失败，请稍候重试');
				} else {
					if(ret.success){
						$api.css($api.byId('abc'),'display:block;');
						$api.html($api.byId('person-name'),ret.person_name);
						$api.html($api.byId('create-time'),ret.create_time.substring(0,16));
						$api.html($api.byId('quanzi-title'),ret.name);
						article_person_id = ret.person_id;
						ret.content = commonTransferBrStr(ret.content);
						//缩略图
						var thumb_ids=JSON.parse(ret.thumb_ids);
						for(var j = 0; j < thumb_ids.length; j++){
						      var  onerror_img="this.src='../../../../../image/common/tpsx.png'";
						      var index = thumb_ids[j].indexOf('.');
						      var file_id=thumb_ids[j].substring(0,index);
                              var ext = thumb_ids[j].substring(index+1,thumb_ids[j].length);
						      var click_html='displayResource("'+thumb_ids[j]+'",this)';
                              img_html+='<img onclick='+click_html+' class="ima_notice" src="'+gertImageUrl(file_id,ext,1)+'" onerror='+onerror_img+' >';                    
                        }
						//附件
						ret.thumbs=[];
						var attachment=ret.attachment;
						var img_html='';
						var other_html = '';
						var imgIndex = 0;
						if(attachment != "[]"){
							for(var j = 0; j < attachment.length; j++){
								var ext = attachment[j].resource_format;
								var oparam = new Object();
								oparam.file_id = attachment[j].file_id;
								oparam.resource_id_int = attachment[j].resource_id_int;
	                            oparam.resource_format = attachment[j].resource_format;
								oparam.image_url = gertImageUrl(attachment[j].file_id,ext,1);
								oparam.image_url_yt = gertImageUrl(attachment[j].file_id,ext,0);
								oparam.ext=ext.toLowerCase();;
								
								var click_html='openAttachment("'+attachment[j].resource_id_int+'","'+attachment[j].resource_format+'",this,event)';
								if(ext=='png' || ext=='jpg'|| ext=='bmp'|| ext=='gif'){
									oparam.imgIndex = imgIndex;
									imgIndex++;
									var imgUrl = gertImageUrl(attachment[j].file_id,ext,1);
									imageArray.push(imgUrl);
									var  onerror_img="this.src='../../../../../image/common/tpsx.png'";
									click_html='openAttachment("'+attachment[j].resource_id_int+'","'+attachment[j].resource_format+'",this,event,'+oparam.imgIndex+')';
									img_html+='<img onclick='+click_html+' class="ima_notice" src="'+imgUrl+'" onerror='+onerror_img+' >';	
								}else{
									var wid_a = $api.cssVal($api.byId("notice_con_div"),"width");
									var wid_a_num = wid_a.substring(0,wid_a.length-2) - 30;
									if(ext=='flv' || ext=='mp4' || ext=='avi' || ext=='wmv'){  //视频
									    if (parseInt(attachment[j].m3u8_status)===2 || parseInt(attachment[j].m3u8_status)===0){
									    	var height_div = wid_a_num * 0.33 * 0.9 * 0.75;
									    	wid_a_num = wid_a_num * 0.33 * 0.9 - 6;
									    	var thumb_url = BASE_URL_ACTION+"/html/down/Thumbs/" + attachment[j].thumb_id.substr(0,2)+"/"+attachment[j].thumb_id+".thumb";
									    	other_html+='<div style="width:33%;float:left;margin-bottom: 5px;margin-top:5px;height:'+height_div+'px !important;"><table style="height: 100% !important"><tbody><tr><td><img class="production-play-img" onclick='+click_html+' style="width:'+wid_a_num+'px;background-color: black;opacity: 0.7;position: absolute;" src="../../../../../image/fun-module/ipad/zthd/play.png"><img style="width:'+wid_a_num+'px;float:left;" onclick='+click_html+' src="'+thumb_url+'" ></td></tr></tbody></table></div>';	
//									    	other_html+='<div style="width:150px;float:left;"><img class="production-play-img" onclick='+click_html+' style="width:150px;background-color: black;opacity: 0.7;position: absolute;" src="../../../../../image/fun-module/ipad/zthd/play.png"><img style="width:150px;float:left;" onclick='+click_html+' src="'+thumb_url+'" ></div>';	
									    }else{
									    	other_html+='<div style="width:33%;float:left;margin-bottom: 5px;margin-top:5px;height:'+height_div+'px !important;"><img style="width:90%;float:left;" onclick='+click_html+' src="'+gertImageUrl(attachment[j].file_id,ext,1)+'" ></div>';	
									    }
									}else{  //音频
										var wid_a = $api.cssVal($api.byId("notice_con_div"),"width");
										var wid_a_num = wid_a.substring(0,wid_a.length-2) - 30;
										var height_div = wid_a_num * 0.33 * 0.9 * 0.75;
										other_html+='<div style="width:33%;float:left;margin-bottom: 5px;margin-top:5px;height:'+height_div+'px !important;"><table style="height: 100% !important"><tbody><tr><td><img style="width:90%;float:left;vertical-align:middle;" onclick='+click_html+' src="'+gertImageUrl(attachment[j].file_id,ext,1)+'" ></td></tr></tbody></table></div>';	
									}
								}
								
								ret.thumbs.push(oparam);
							}
						}
						//作品详情
						img_html = img_html + other_html;
						ret.content = '<div class="clearfix">' +　ret.content　+ '</div>' +img_html;
						$api.html($api.byId('notice_con_div'),ret.content);
						getCommentInfo(1);
						if($api.getStorage("person_id") * 1 == article_person_id * 1){
							if(ret.is_boutique == 1){
								$api.css($api.byId('clear_boutique'),'display:block');
							}else{
								$api.css($api.byId('set_boutique'),'display:block');
							}
							$api.css($api.byId('delete-quanzi'),'display:block');	
						}else{
							if(ret.is_boutique == 1){
								$api.css($api.byId('boutique'),'display:block');
							}else{
								$api.css($api.byId('boutique'),'display:none');
							}	
							$api.css($api.byId('delete-quanzi'),'display:none');
						}
						
						api.hideProgress();
					}else{
						popToast('获取圈子详情失败，请稍候重试');
					}
				}
			});
		}
		//替换所有的回车换行
		function transferBrStr(content) {
			var string = content;
			try {
				string = string.replace(/\r\n/g, "<br />")
				string = string.replace(/\n/g, "<br />");
			} catch(e) {
				popAlert(e.message);
			}
			return string;
		}
		
	   /*
	    *author:zhaoj
	    *function:打开附件
	    *date：20171023
	    */
	     function openAttachment(resource_id_int,resource_format,self,e,imgIndex){
	    	if (resource_format=='png' || resource_format=='jpg' || resource_format == 'bmp' || resource_format =='gif'){
	    		openPictureShowWin(imageArray,imgIndex);
	    		return;
	    	}
	    	
	        var param_json = {"is_show_tip":1,"resource_id_int":resource_id_int};
	        commonGetResInfo(param_json,function(flag,ret){
	            api.hideProgress();
	            if(flag){
	                if(resource_format != "mp3"){
	                    //不是音频的播放方式
	                    var oparam ={"res_type":ret.resource_format, "res_path":ret.file_id, "res_title":ret.resource_title,"m3u8_status":ret.m3u8_status,"winName":api.winName,"setBackFun":'reBackType("voice");',"backFun":'back();',"res_id":'open_picture',"pic_back":'picture_content'};
	                     common_openResource.open_new(JSON.stringify(oparam));
	                }else{
	                    //音频的播放方式
	                    var res_url='';
	                    if (BASE_APP_TYPE == 1) {
	                        res_url = BASE_IMAGE_PRE+"down/Material/" + ret.file_id.substring(0, 2) + "/" + ret.file_id+'.'+ret.resource_format;        
	                    } else {
	                        res_url = BASE_URL_ACTION + "/html/thumb/Material/" + ret.file_id.substring(0, 2) + "/" + ret.file_id+'.'+ret.resource_format;
	                    }
	                    if($api.hasCls(self, 'is_play')){
	                        //停止播放
	                        $api.removeCls(self, 'is_play');
	                        var img_dom = $api.dom(self, 'img');
	                        $api.attr(img_dom, 'src','../../../../../image/fun-module/ipad/zthd/voice-bg.png');
	                        stopVoice(self);
	                    }else{
	                        //正在播放
	                        $api.addCls(self, 'is_play');
	                        openAudio(res_url,self);
	                    }
	                }
	            }else{
	                popToast('打开失败，请稍候重试');
	            }
	        });
	        e.stopPropagation();
	    }
		
	   /*
	    *author:zhaoj
	    *function:播放音频
	    *date：20171024
	    */
	    function openAudio(voice_url,self){
	    	commonShowProgress('加载中...',false);
	    	netAudio.play({
			    path: voice_url
			},function( ret, err ){    
			    if( ret ){
			    	if(ret.current == 0){
			    		api.hideProgress();
			    		$api.attr(self, 'src','../../../../../image/fun-module/ipad/zthd/voice-bg.gif');
			    	}
			    	if(ret.complete==true){
						popToast('播放完毕');
						$api.removeCls(self, 'is_play');
						$api.attr(self, 'src','../../../../../image/fun-module/ipad/zthd/voice-bg.png');		
			    	}
			    }else{
			    	api.hideProgress();
			    	popToast('加载失败');
			    }
			});
	    }
		
	   /*
	    *author:zhaoj
	    *function:获取缩率图路径
	    *date：20171023
	    */
		function gertImageUrl(file_id,ext,type){
			var img_url='';//图片路径
			if(ext == 'png' || ext == 'PNG'|| ext == 'jpg'|| ext == 'JPG'|| ext == 'gif'|| ext == 'GIF'|| ext == 'bmp'|| ext == 'BMP'){
				image_hz = type?commonReturnPhotoCutSize(0):'';
				if (BASE_APP_TYPE == 1) {
					img_url = BASE_IMAGE_PRE+"down/Material/" + file_id.substring(0, 2) + "/" + file_id+'.'+ext+ image_hz;		
				} else {
					img_url = BASE_URL_ACTION + "/html/thumb/Material/" + file_id.substring(0, 2) + "/" + file_id+'.'+ext+image_hz;
				}
			}else if(ext == 'mp3'||ext == 'wav'){
				img_url = '../../../../../image/fun-module/ipad/zthd/voice-bg.png';
			}else if(commonContainsArray(support_extension,ext)){
				img_url = '../../../../../image/fun-module/ipad/zthd/vedio-bg.png';
			}else if(ext == 'doc'||ext == 'docx'){
			  img_url = '../../../../../image/fun-module/ipad/zthd/doc.png';
			}else if(ext == 'xls'||ext == 'xlsx'){
			  img_url = '../../../../../image/fun-module/ipad/zthd/xls.png';
			}else if(ext == 'txt'){
			  img_url = '../../../../../image/fun-module/ipad/zthd/txt.png';
			}else if(ext == 'sb2'){
			  img_url = '../../../../../image/fun-module/ipad/zthd/sb2.png';
			}else if(ext == 'ppt' || ext == 'pptx'){
			  img_url = '../../../../../image/fun-module/ipad/zthd/ppt.png';
			}
			return img_url;
		}
		
	   /*
		*author:zhaoj
		*function:停止录音
		*date：20171024
		*/
		function stopVoice(self){
			api.hideProgress();
			netAudio.stop();
		}
	   /*
	    *author:zhaoj
	    *function:预览上传的图片、视频以及音频
	    *date：20171020
	    */
	   function displayResource(url,self){
	        var res_url='';
	        if (BASE_APP_TYPE == 1) {
	            res_url = BASE_IMAGE_PRE+"down/Material/" + url.substring(0, 2) + "/" + url;        
	        } else {
	            res_url = BASE_URL_ACTION + "/html/thumb/Material/" + url.substring(0, 2) + "/" + url;
	        }
	        //图片
	        openPictureShowWin([res_url],0);
	    }
		
		/*
		 *author:zhaoj
		 *function:打开书写评论的页面
		 *date：20160318
		 */
		function openCommentWindow(d,id,topic_id,person_id,person_name) {
			if(d == 0){
				var pageParamJson = {'id':api.pageParam.id,"header_h":api.pageParam.header_h,'type':'hd_2','d':0,'topic_id':api.pageParam.id,'parent_id':""}
			}else{
				var pageParamJson = {'id':api.pageParam.id,"header_h":api.pageParam.header_h,'type':'hd_2','d':1,'topic_id':topic_id,'parent_id':id}
			}
			commonOpenWin('zthd_comment_window', 'zthd_comment_window.html', false, false, pageParamJson)
		}
		/*
		*author:zhaoj
		*function:评论点赞置顶
		*date：20160603
		*/
		function scrollTop(){
			document.getElementById("abc").scrollIntoView();
		}

		/*
		 * 功能：获取评论
		 * 作者：张自强
		 * 时间：20171025
		 */
		function getCommentInfo(page) {
			currentPage = page;
			api.ajax({
				url : BASE_URL_ACTION + '/bbs/topic/view',
				method : 'post',
				dataType : 'json',
				timeout : 30,
				cache : false,
				data : {
					values : {
						'message_type':2,
						'pageNumber' :currentPage,
						'pageSize':BASE_PAGE_SIZE,
						'sort':1,
						'type_id':'space_topic_works_'+api.pageParam.id
					}
				},
				headers : {
					'Cookie' : 'person_id=' + $api.getStorage("person_id") + ';identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
				}
			}, function(ret, err) {
				if(err){
					popToast('获取评论失败，请稍候重试');
				}else{
					if (ret.success) {
						totalPages = ret.totalPage;
						if (ret.reply_list.length > 0) {
							var list = ret.reply_list;
							//对数据进行处理
							for (var i = 0; i < list.length; i++) {
								//评论时间显示的处理
								list[i]["time"] = list[i].create_time.substring(0, 16);
								list[i]["content"] = transferBrStr(list[i]["content"]);
								if (list[i].parent_person_id * 1) {
									list[i]["has_reply"] = 1
								} else {
									list[i]["has_reply"] = 0;
								}
								//是自己发表的文章，可以删除评论，不是自己发表的文章，不能删除
								if ($api.getStorage("person_id") * 1 == article_person_id * 1 || $api.getStorage("person_id") * 1 == list[i].person_id * 1) {
									list[i]["b_delete"] = 1;
								} else {
									list[i]["b_delete"] = 0;
								}
								//处理头像路径
								if(ret.reply_list[i].icon_url != ""){
									if(BASE_APP_TYPE == 1){
										ret.reply_list[i].icon_url = BASE_IMAGE_PRE + url_path_suffix + ret.reply_list[i].icon_url.substring(0, 2) + "/" +ret.reply_list[i].icon_url + commonReturnPhotoCutSize(1,96,96,ret.reply_list[i].icon_url.substring((ret.reply_list[i].icon_url.length)-3),0);
									}else{
										ret.reply_list[i].icon_url = BASE_URL_ACTION + BASE_IMAGE_BEGIN + ret.reply_list[i].icon_url.substring(0, 2) + "/" + ret.reply_list[i].icon_url + commonReturnPhotoCutSize(1,96,96,ret.reply_list[i].icon_url.substring((ret.reply_list[i].icon_url.length)-3),0);
									}	
								}else{
									ret.reply_list[i].icon_url = '../../../image/common/header.png';
								}
							}
							commonAddManyHtml('div_body', 'div_script', ret);
						} else {
							var data = {
								"reply_list" : []
							};
							commonAddManyHtml('div_body', 'div_script', ret)
						}
					} else {
						popToast('获取评论失败，请稍候重试');
						var data = {
							"reply_list" : []
						};
						commonAddManyHtml('div_body', 'div_script', ret)
					}	
				}
				$api.css($api.byId('shadow'), "z-index:-1;");
				//reloadListData();//重新加载列表数据
				//通知顶部下拉刷新数据加载完毕，组件会恢复到默认状态
				api.hideProgress();
				commonControlRefresh();
			});
		}
		/*
		 *author:zhaoj
		 *function:删除留言
		 *date：20160319
		 */
		function messageBoard_deletePost(pageSize, topic_id, postid) {
			api.confirm({
				title : '提示',
				msg : '确定删除该评论内容？',
				buttons : ['确定', '取消']
			}, function(ret, err) {
				if (ret) {
					if (ret.buttonIndex == 1) {
						$api.css($api.byId('shadow'), "z-index:2;");
						api.ajax({
							url : BASE_URL_ACTION + '/ypt/bbs/post/delete',
							method : 'get',
							dataType : 'json',
							timeout : 30,
							cache : false,
							data : {
								values : {
									"topic_id" : topic_id,
									"post_id" : postid
								}
							},
							headers : {
								'Cookie' : 'person_id=' + $api.getStorage("person_id") + ';identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
							}
						}, function(ret, err) {
							api.hideProgress();
							if (ret.success) {
								subCommentNum();
							} else {
								popAlert("删除评论失败，" + ret.info);
								$api.css($api.byId('shadow'), "z-index:-1;");
							}
							if (err) {
								popAlert("删除评论失败");
								$api.css($api.byId('shadow'), "z-index:-1;");
							}
						});
					}
				}
			});
		}

		/*
		 *author:zhaoj
		 *function:删除留言数
		 *date：20160319
		 */
		function subCommentNum() {
			api.ajax({
				url : BASE_URL_ACTION + '/ypt/space/topic/sub_comment_num',
				method : 'post',
				dataType : 'json',
				timeout : 30,
				cache : false,
				data : {
					values : {
						'works_id' : api.pageParam.id
					}
				},
				headers : {
					'Cookie' : 'person_id=' + $api.getStorage("person_id") + ';identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
				}
			}, function(ret, err) {
				api.hideProgress();
				showSelfProgress('删除中...');
				setTimeout(function() {
					getCommentInfo(1);
				}, 2000);
			});
		}

		/**
		 * 上拉刷新页面数据
		 * 周枫
		 * 2015.11.24
		 */
		function scrollBottomReload() {
			//下移到底部：
			api.addEventListener({
				name : 'scrolltobottom',
				extra : {
					threshold : 100 //设置距离底部多少距离时触发，默认值为0，数字类型
				}
			}, function(ret, err) {
				if ((currentPage + 1) <= totalPages) {
					currentPage = currentPage + 1;
					getCommentInfo(currentPage);
					// 页码+1
				} else {
					popBottomToast('已加载全部数据');
				}
			});
		}

		/*
		 * 功能：获取点赞数据
		 * 作者：张自强
		 * 时间：20170918
		 * 接口提供人：张海
		 */
		function getPraiseinfoList(page){
			api.ajax({
				url : BASE_URL_ACTION + '/space/praise/get_praiseinfo_list?business_type=6&business_id='+api.pageParam.id+'&page_num='+page+'&page_size=10',
				method : 'get',
				timeout : 30,
				dataType : 'json',
				headers : {
		'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				//通知顶部下拉刷新数据加载完毕，组件会恢复到默认状态
				commonControlRefresh();
				if (err) {
					var data= {"page_size":9999,"page_num":1,"success":true,"total_page":1,"total_row":"2","praise_list":[]};
					addZanTemplateHtml('zan_body','zan_script',data);
				} else {
					if(ret.success){
						zanTotalPages = ret.total_page;
						addZanTemplateHtml('zan_body','zan_script',ret);
					}else{
						var data= {"page_size":9999,"page_num":1,"success":true,"total_page":1,"total_row":"2","praise_list":[]};
					addZanTemplateHtml('zan_body','zan_script',data);
					}
				}
			});
		}
		/*
		 *author:zhaoj
		 *function:渲染html
		 *date：20160602
		 */
		function addZanTemplateHtml(div_id, script_id, data) {
			var html_type = template.render(script_id, data);
			if (zanCurrentPage == 1) {
				document.getElementById(div_id).innerHTML = html_type;
			} else {
				$api.append($api.byId(div_id), html_type);
			}
		}
	

		
		/*
		 * 功能：获取点赞数据
		 * 作者：张自强
		 * 时间：20170918
		 */
		function useGetPraiseinfoList(){
			getPraiseinfoList(zanCurrentPage);
		}
		
		/*
		 * 功能：跳转到页面下方评论点赞的区域
		 * 作者：张自强
		 * 时间：20170919
		 */
		function turnToBottom(){
			document.getElementById("abc").scrollIntoView();
			api.hideProgress();
		}
		
		/*
		 * 功能：取消精品
		 * 作者：张自强
		 * 时间：20171024
		 * 接口提供人：张海
		 */
		function clearBoutique(){
			 api.ajax({
				url : BASE_URL_ACTION + '/ypt/space/topic/cancel_works_boutique',
				method : 'post',
				dataType : 'json',
				timeout : 30,
				cache : false,
				data : {
					values : {
						'works_id':api.pageParam.id
					}
				},
				headers : {
					'Cookie' : 'person_id=' + $api.getStorage("person_id") + ';identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
				}
			}, function(ret, err) {
				if(err){
					popToast('取消精品失败，请稍候重试');
				}else{
					if(ret.success){
						$api.css($api.byId('clear_boutique'),'display:none');
						$api.css($api.byId('set_boutique'),'display:block');
					}else{
						popToast('取消精品失败，请稍候重试');
					}
				}
			});
		}
		
		/*
		 * 功能：设置精品
		 * 作者：张自强
		 * 时间：20171024
		 * 接口提供人：张海
		 */
		function setBoutique(){
			 api.ajax({
				url : BASE_URL_ACTION + '/ypt/space/topic/set_works_boutique',
				method : 'post',
				dataType : 'json',
				timeout : 30,
				cache : false,
				data : {
					values : {
						'works_id':api.pageParam.id
					}
				},
				headers : {
					'Cookie' : 'person_id=' + $api.getStorage("person_id") + ';identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
				}
			}, function(ret, err) {
				if(err){
					popToast('设置精品失败，请稍候重试');
				}else{
					if(ret.success){
						$api.css($api.byId('clear_boutique'),'display:block');
						$api.css($api.byId('set_boutique'),'display:none');
					}else{
						popToast('设置精品失败，请稍候重试');
					}
				}
			});
		}
		
		
		/*
		 * 功能：点赞
		 * 作者：张自强
		 * 时间：20171025
		 * 接口提供人：张海
		 */
		function addPraiseInfo() {
			if (!is_dianzanComplete){
				return;
			}
			is_dianzanComplete = false;
			api.ajax({
				url : BASE_URL_ACTION + '/ypt/space/topic/praise_works',
				method : 'post',
				timeout : 0,
				dataType : 'json',
				data : {
					values : {
						'works_id' : api.pageParam.id,
						'identity_id'	 : $api.getStorage("identity"),
						'person_id' :$api.getStorage("person_id")
	
					}
				},
				headers : {
		'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				if (err) {
					popToast('点赞失败');
				} else {
					if(ret.success){
						popToast('点赞成功');
						useGetPraiseinfoList();
						var tip = "cancelPraise()";
						$api.attr($api.byId('dianzan'), 'onclick', tip);
						$api.html($api.byId('dianzan'),'</br>已赞');
						$api.removeCls($api.byId('dianzan'), 'w-dianzan');
						$api.addCls($api.byId('dianzan'), 'y-dianzan');
					}else{
						popToast('点赞失败');
					}
				}
				is_dianzanComplete = true;
			});
		}
		
		/*
		 * 功能：验证本人是否已经点赞
		 * 作者：张自强
		 * 时间：20171025
		 * 接口提供人：张海
		 */
		function isExistsPraise() {
			api.ajax({
				url:BASE_URL_ACTION+'/ypt/space/praise/isexists_praise?business_type=6&business_id='+api.pageParam.id+'&person_id='+$api.getStorage('person_id')+'&identity_id=' + $api.getStorage('identity'),
				method : 'get',
				timeout : 30,
				dataType : 'json',
				headers : {
		'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				if (err) {
					
				} else {
					if(ret.success){
						if(ret.is_exists_praise){
							var tip = "cancelPraise()";
							$api.attr($api.byId('dianzan'), 'onclick', tip);
							$api.html($api.byId('dianzan'),'</br>已赞');
							$api.removeCls($api.byId('dianzan'), 'w-dianzan');
							$api.addCls($api.byId('dianzan'), 'y-dianzan');
						}
					}else{
						
					}
				}
			});
		}
		
		/*
		 * 功能：取消点赞
		 * 作者：张自强
		 * 时间：20171025
		 * 接口提供人：张海
		 */
		function cancelPraise(){
			if (!is_dianzanComplete){
				return;
			}
			is_dianzanComplete = false;
			api.ajax({
				url : BASE_URL_ACTION + '/ypt/space/topic/cancel_praise_works',
				method : 'post',
				timeout : 30,
				dataType : 'json',
				data : {
					values : {
						'works_id' : api.pageParam.id,
						'identity_id' : $api.getStorage("identity"),
						'person_id' :$api.getStorage("person_id")
					}
				},
				headers : {
		'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				if (err) {
					popToast('取消失败');
				} else {
					if(ret.success){
						var tip = "addPraiseInfo()";
						$api.attr($api.byId('dianzan'), 'onclick', tip);
						$api.removeCls($api.byId('dianzan'), 'y-dianzan');
						$api.addCls($api.byId('dianzan'), 'w-dianzan');
						$api.html($api.byId('dianzan'),'</br>点赞');
	                    useGetPraiseinfoList();
					}else{
						popToast('取消失败');
					}
				}
				is_dianzanComplete = true;
			});
		}
		
		/*
		 * 功能：删除作品
		 * 作者:张自强
		 * 时间：20171025
		 */
		function deleteZuopin(){
			 api.ajax({
				url : BASE_URL_ACTION + '/ypt/space/topic/delete_works_by_id',
				method : 'post',
				timeout : 30,
				dataType : 'json',
				data : {
					values : {
						'works_id' : api.pageParam.id,
					}
				},
				headers : {
		'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				if (err) {
					popToast('删除失败，请稍候重试');
				} else {
					if(ret.success){
						commonExecScript('zthd_hd_window','','back();',0);
					}else{
						popToast('删除失败，请稍候重试');
					}
				}
			});
		}
		
	</script>
</html>