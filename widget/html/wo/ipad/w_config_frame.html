<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<!-- html5：在创建html时为了防止页面缩放等不兼容效果，要创建个viewport  -->
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<!-- 在IOS设备上，有时会将数字转为手机号，这里也要禁止下 -->
		<meta name="format-detection" content="telephone=no"/>
		<title>关于软件frame</title>
		<link rel="stylesheet" type="text/css" href="../../../css/aui/aui.css" />
		<link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
		<style>
			.h20 {
				height: 20px;
				background: #f7f9f8;
			}
			.h1 {
				height: 1px;
				background: #CCCCCC;/*margin:0 15px;*/
			}
			.fr {
				float: right;
			}
			.firstblock, .secondblock, .thirdblock {
				background-color: #fff;
			}
			/* 设置条目 */
			.item {height: 60px;line-height: 60px;background-color: #fff; font-size:18px;}
			.presshover {
				background-color: #FAFAFA;
			}
			.banben {
				text-align: center;
				padding-bottom: 15px;
				padding-top: 5px;
			}
			.banben div {
				color: #696969;
			}
			/* 设置条目 */
			.item {
				height: 50px;
				line-height: 50px;
				padding-left: 15px;
				background-color: #fff;
			}
			.presshover {
				background-color: #FAFAFA;
			}
			.item_right {
				color: #696969;
				font-size: 14px;
				padding-right: 15px;
			}
			.top{height:80px;position:relative;text-align: center;}
            .top hr {height: 1px;background: #e0e0e0;top: 50%;position: absolute;left: 20px;right: 20px;z-index:-1;}
            .top span { display: inline-block; background: #fff; z-index: 1;top: 30px; color: #333; height:80px;line-height: 80px; font-size:18px;}
            .body-p{padding:0px 50px;}
            .thirdblock{text-align:center;}
            .thirdblock .item{color: #fff;display: inline-block;padding: 0px 15px;height: 40px;line-height: 40px; min-width:100px; text-align:center;}
            .item_btn{float:right;color: #fff;display: inline-block;padding: 0px 15px;height: 30px;line-height: 30px;margin-top: 10px;min-width: 95px;text-align: center; border-radius:2px;}
            .h50{height:20px;}
            .footer{
             position:fixed;
             bottom:0;
             width:100%;
             padding:10px 15px;
             line-height:25px;
             font-size:16px;
             text-align:center;
             color:#696969;
             z-index: -1;
            }
            .firstblock, .secondblock, .thirdblock{
            	background:rgba(0,0,0,0);
            }
		</style>
	</head>
	<body class="w-ipad-common">
		<div class="top">
			<hr />
			<span id="j_name" class="plr20">关于软件</span>
		</div>
		<div class="body-p">
			<div class="banben">
				<div><img src="../../../icon/icon.png" height="64" width="64">
				</div>
				<div id="j_app_name"></div>
			</div>
			<div class="h50"></div>
			<div class="firstblock display-none">
				<div class="item">
					<div class="item_btn" onclick="openConfigSafeWin();">修改密码</div>
				</div>
				<div class="h1"></div>
			</div>
			<div class="secondblock">
				<div class="item">
					<span>会话记录：<font id="hh_size"></font></span>
					<div class="item_btn" onclick="clearConversations();">清理</div>
				</div>
				<div class="h1"></div>
				<div class="item">
					<span>缓存：<font id="hc_size"></font></span>
					<div class="item_btn" onclick="clearCache()">清理</div>
				</div>
			</div>
			<div class="h1"></div>
			<!--<div class="h50"></div>
			<div class="thirdblock">
				<div class="item" tapmode="presshover" onclick="logout();">
					退出登录
				</div>
			</div>-->
		</div>
		<div class="footer" id="j_version"></div>
	</body>
	<script type="text/javascript" src="../../../script/api.js"></script>
	<script type="text/javascript" src="../../../script/base_config.js"></script>
	<script type="text/javascript" src="../../../script/huihua/sqlite_db.js"></script>
	<script type="text/javascript" src="../../../script/huihua/hh_db.js"></script>
	<script type="text/javascript" src="../../../script/common/common.js"></script>
	<script type="text/javascript" src="../../../script/assembly/fs.js"></script>
	<script type="text/javascript" src="../../../script/wo/w_index_window.js"></script>
	<script type="text/javascript">
		var header_h;
		var BASE_URL_ACTION;
		var version;
		apiready = function() {
			commonSetTheme({"level":3,"type":0});
			jbDisShowXgmm();
			header_h = api.pageParam.header_h;
			BASE_URL_ACTION = $api.getStorage('BASE_URL_ACTION');
			version = api.appVersion;
			$api.text($api.byId('j_app_name'), appName);
			//alert('appVersion='+api.appVersion+','+'systemVersion='+api.systemVersion+','+'versio='+api.version)
			var versionDiv = document.getElementById('j_version');
			$api.html(versionDiv, '软件版本:' + version+'<br/>东北师大理想软件股份有限公司');
			getAppCache();
			getDbSize();
		}
		/**
		 * 打开账号与安全设置页面
		 * 周枫
		 * 2016.5.10
		 */
		function openConfigSafeWin() {
			api.openWin({
				name : 'w_config_safe_window',
				url : 'w_config_safe_window.html',
				pageParam : {
					header_h : header_h,
				},
				bounces : false,
				opaque : false,
				showProgress : false,
				vScrollBarEnabled : false,
				hScrollBarEnabled : false,
				slidBackEnabled : false,
				delay : 0,
				animation : {
					type : "reveal", //动画类型（详见动画类型常量）
					subType : "from_right", //动画子类型（详见动画子类型常量）
					duration : 300
				},
			});
		}

		/**
		 * 打开通用设置页面
		 * 周枫
		 * 2016.5.10
		 */
		function openConfigCommonWin() {
			api.openWin({
				name : 'w_config_common_window',
				url : 'w_config_common_window.html',
				pageParam : {
					header_h : header_h,
				},
				bounces : false,
				opaque : false,
				showProgress : false,
				vScrollBarEnabled : false,
				hScrollBarEnabled : false,
				slidBackEnabled : false,
				delay : 0,
				bgColor : 'rgba(0,0,0,0)',
				animation : {
					type : "reveal", //动画类型（详见动画类型常量）
					subType : "from_right", //动画子类型（详见动画子类型常量）
					duration : 300
				},
			});
		}

		/**
		 * 局版没有修改密码方法
		 * 周枫
		 * 2016.08.23
		 */
		function jbDisShowXgmm() {
			var base_name = parseInt($api.getStorage('BASE_APP_TYPE'));
			if (base_name == 1) {
				$api.removeCls($api.dom('.firstblock'), 'display-none');
			}
		}

		/**
		 * 获取app缓存文件大小
		 * 周枫
		 * 2016.12.10
		 */
		function getAppCache() {
			//异步返回结果：
			api.getCacheSize(function(ret) {
				var size = ret.size;
				var size_zj = commonBytesToSize(size);
				$api.text($api.byId('hc_size'), '' + size_zj + '');
			});
		}

		/**
		 * 获取app数据库文件大小
		 * 周枫
		 * 2016.12.10
		 */
		function getDbSize() {
			var file_path = BASE_FS_NEW_SQDB_PATH + BASE_FS_SQDB_NAME;
			fsFile.getAttribute(file_path, function(data) {
				var size = data.attribute.size;
				var size_zj = commonBytesToSize(size);
				if($api.getStorage('huanchun_'+$api.getStorage('person_id')) == 1){
					$api.text($api.byId('hh_size'), '0 B');
				}else{
					$api.text($api.byId('hh_size'), size_zj);
				}
			});
		}

		function clearCache() {
			updateAllGroupMd5Null(function(is_true){
				api.clearCache(function() {
					api.toast({
						msg : '清理完成'
					});
					getAppCache();
					getDbSize();
				});
			});
		
			
		}
	</script>
</html>