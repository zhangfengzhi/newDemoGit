<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
        <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
        <title>绑定页面</title>
        <link rel="stylesheet" type="text/css" href="../../../css/aui/aui.css"/>
        <link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
        <style>
            body {
                background: #f6f6f6;
                color: #333;
                padding: 0 15px;
            }
            .fa-div {
                border-bottom: 1px solid #efefef
            }
            .bd-title {
                height: 45px;
                line-height: 45px;
                font-size: 14px;
                color: #696969
            }
            .name {
                height: 60px;
                line-height: 60px;
                font-size: 16px;
                width: 100%
            }
            .fl {
                float: left;
            }
            .fr {
                float: right;
            }
            .fl-width{
                max-width: 40%;
            }
            .fr-width{
                max-width: 80%;
            }
            .content{
                height: 100%;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-line-clamp: 1;
                -webkit-box-orient: vertical;
                word-break: break-all;
                text-align: left;
            }
        </style>
    </head>
    <body class="w-iphone-common">
        <div class="name fa-div">
            <div class="fl" id="bd_title">
                                            手写板已绑定
            </div>
        </div>
        <div class="name fa-div">
            <div class="fl">
                                            学生姓名
            </div>
            <div id="stu_name" class="fr fl-width content clearfix">
                                              张三
            </div>
        </div>
        <div class="name fa-div">
            <div class="fl">
                                            设备码
            </div>
            <div id="sxb_mac" class="fr fr-width content clearfix">
                
            </div>
        </div>
        <button class="aui-btn aui-btn-primary aui-btn-block" style="height:40px;padding-top:6px;margin-top:50px;" name="btn" tapmode onclick="edit(1);">
                修改
        </button>
        <button id="re_sys" class="aui-btn aui-btn-primary aui-btn-block" style="height:40px;padding-top:6px;margin-top:20px;" name="btn" tapmode onclick="edit(2);">
                解除绑定
        </button>
    </body>
    <script type="text/javascript" src="../../../script/api.js"></script>
    <script type="text/javascript" src="../../../script/base_config.js" ></script>
    <script type="text/javascript" src="../../../script/plug-in/template.js" ></script>
    <script type="text/javascript" src="../../../script/common/common.js" ></script>
    <script type="text/javascript" src="../../../script/init/init_config.js" ></script>
    <script type="text/javascript" src="../../../script/assembly/tongjiData.js"></script>
    <script type="text/javascript">
        var header_h = 45;
        var edit_btn = false;//按钮是否点击
        apiready = function() {
            commonSetTheme({"level" : 3,"type" : 0});
            header_h = api.pageParam.header_h;
            $api.html($api.byId('sxb_mac'),api.pageParam.sxbMac);
            $api.html($api.byId('stu_name'),api.pageParam.name);
            if(api.systemType != "android"){
                var dom = $api.domAll($api.byId('body'), '.aui-btn-primary');
                for(var i = 0; i < dom.length; i++){
                    $api.css(dom[i],'background-color: #34a8f6 !important;border: 1px solid #34a8f6 !important;');
                }
            }
        };
       
       /*
        * 功能：修改或解除绑定
        * 作者：张自强
        * 时间：20190313
        * 接口：陈续刚
        */
       function edit(type){
         if(edit_btn){
            return;
         }else{
            edit_btn = true;
         }
         if(type == 1){//修改
            setTimeout(function(){
                edit_btn = false;
            },500);
            commonExecScript(api.winName,'','openBdFinishWindow(1,"'+api.pageParam.sxbMac+'");',0);
         }else{//解除绑定
            api.confirm({
                title : '提示',
                msg : "确定要解除绑定吗？",
                buttons : ["确定", "取消"]
            }, function(ret, err) {
                if (1 == ret.buttonIndex) {
                     api.ajax({
                         url: BASE_URL_ACTION + '/xx/hwt/unBoundMac?mac=' + api.pageParam.sxbMac + '&unbound_type=0&student_id=' + api.pageParam.id,
                         method:'get',
                         dataType:'json',
                         timeout:30
                     },function(ret,err){
                        if(err){
                             edit_btn = false;
                             popToast("解除绑定失败！");
                        }else{
                            if(ret.success){
                                $api.removeAttr($api.byId('re_sys'), 'onclick');
                                api.hideProgress();
                                popToast("解除绑定成功！");
                                commonExecScript('w_sxb_class_window','w_sxb_class_frame','changeBd();',1);
                                commonExecScript('w_sxb_stu_window','w_sxb_stu_frame','changeBd();',1);
                                setTimeout(function(){
                                    edit_btn = false;
                                    commonExecScript(api.winName,'','openBdFinishWindow(2,"未绑定");',0);
                                },2000);
                            }else{
                                edit_btn = false;
                                popToast(ret.msg);
                            }
                        }
                     });  
                }else{
                    edit_btn = false;
                }
            });
         }
       }
       
       /*
        * 功能：改变设备码
        * 作者：张自强
        * 时间：20190222
        */
       function changeMac(num){
         api.pageParam.sxbMac = num;
         $api.html($api.byId('sxb_mac'),api.pageParam.sxbMac);
       }
    </script>
</html>