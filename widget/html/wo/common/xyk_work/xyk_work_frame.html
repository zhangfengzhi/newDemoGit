<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>试题统计</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/aui/aui.css"/>
    <link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
    <style>
    	body{background:#f6f6f6;color:#333;}
    	.content li{list-style:none;border-bottom:1px solid #efefef;padding:10px 10px;background:#ffffff;}
    	.left-name{width:95%;max-width:95%;overflow:hidden;text-overflow:ellipsis;display:inline-block;}
    	.float-div{overflow:auto;margin-top:5px;}
    	.font-css{font-size:14px;color:#696969}
    	.num{float:left;width:33%;padding-right:0.1%;}
    	.num-div{width:100%;font-size:12px;color:#696969;}
    	.num-div .font{float:left;width:auto;max-width:50%;overflow:hidden;text-overflow:ellipsis;}
    	.num-div .long-font{float:left;width:auto;max-width:50%;overflow:hidden;text-overflow:ellipsis;}
    	.num-div .content{float:left;height:100%;max-width:60%;overflow:hidden;text-overflow:ellipsis;}
    	.num-div .short-content{float:left;height:100%;max-width:30%;overflow:hidden;text-overflow:ellipsis;}
    	.person-name1{float:left;max-width:70%;overflow:hidden;text-overflow:ellipsis;}
    	
    	.content-stu li{list-style:none;border-bottom:1px solid #efefef;padding:10px 10px;background:#ffffff;}
        .left-name-stu{width:100%;max-width:100%;overflow:hidden;text-overflow:ellipsis;display:inline-block;}
        .float-div-stu{overflow:auto;margin-top:5px;}
        .font-css-stu{font-size:14px;color:#696969}
        .num-stu{float:left;width:50%;}
        .num-div-stu{width:100%;font-size:12px;color:#696969;}
        .num-div-stu .font-stu{float:left;width:auto;max-width:30%;overflow:hidden;text-overflow:ellipsis;}
        .num-div-stu .content-stu{float:left;height:100%;max-width:70%;overflow:hidden;text-overflow:ellipsis;center:left}
        .person-name1-stu{float:left;max-width:100%;overflow:hidden;text-overflow:ellipsis;}
    </style>
</head>
<body id="m_body" class="w-iphone-common">
	<ul id="div_body_class" class="content"></ul>
	<script type="text/html" id="div_script">
		<%if(list.length == 0){%>
			<div class="no-data"><span>暂无数据</span></div>
		<%}else{%>
			<%for(var i=0;i<list.length;i++){%>
				<li onclick="selectClass('<%=list[i].class_id%>',<%=list[i].ybd_count%>,<%=list[i].wbd_count%>,'<%=list[i].class_name%>');">
					<div class="float-div">
						<div class="left-name clearfix">
							<div class="person-name1"><%=list[i].class_name%></div>
						</div>
					</div>
					<div class="float-div">
					    <div class="num">
					       <div class="num-div clearfix">
					           <div class="long-font">共：</div>
					           <div class="short-content clearfix"><%=list[i].stu_count%></div>
					           <div class="font">人</div>
					       </div>
					    </div>
					    <div class="num aui-hide">
                           <div class="num-div clearfix">
                               <div class="long-font">已绑定：</div>
                               <div class="short-content clearfix"><%=list[i].ybd_count%></div>
                               <div class="font">人</div>
                           </div>
                        </div>
                        <div class="num aui-hide">
                           <div class="num-div clearfix">
                               <div class="long-font">未绑定：</div>
                               <div class="short-content clearfix"><%=list[i].wbd_count%></div>
                               <div class="font">人</div>
                           </div>
                        </div>
					</div>
				</li>
			<%}%>
		<%}%>
	</script>
	<ul id="div_body_stu" class="content-stu aui-hide"></ul>
    <script type="text/html" id="div_script_stu">
        <%if(data.student_list.length == 0){%>
            <div class="no-data"><span>暂无数据</span></div>
        <%}else{%>
            <%for(var i=0;i<data.student_list.length;i++){%>
                <li onclick="selectStu(<%=data.student_list[i].person_id%>,'<%=data.student_list[i].student_name%>','<%=data.student_list[i].mac%>',<%=data.student_list[i].class_id%>);">
                    <div class="float-div-stu">
                        <div class="num-stu">
                           <div class="left-name-stu clearfix">
                               <div class="person-name1-stu"><%=data.student_list[i].student_name%></div>
                            </div>
                        </div>
                        <div class="num-stu">
                           <div class="num-div-stu clearfix">
                               <div class="font-stu">班级：</div>
                               <div class="content-stu clearfix"><%=data.student_list[i].class_name%></div>
                           </div>
                        </div>
                    </div>
                    <div class="float-div-stu">
                        <div class="num-stu">
                           <div class="num-div-stu clearfix">
                               <div class="font-stu">用户名：</div>
                               <div class="content-stu clearfix"><%=data.student_list[i].login_name%></div>
                           </div>
                        </div>
                        <div class="num-stu aui-hide">
                           <div class="num-div-stu clearfix">
                               <div class="font-stu">设备码：</div>
                               <div class="content-stu clearfix"><%=data.student_list[i].mac%></div>
                           </div>
                        </div>
                    </div>
                </li>
            <%}%>
        <%}%>
    </script>
</body>
<script type="text/javascript" src="../../../../script/api.js"></script>
<script type="text/javascript" src="../../../../script/base_config.js" ></script>
<script type="text/javascript" src="../../../../script/plug-in/template.js" ></script>
<script type="text/javascript" src="../../../../script/common/common.js" ></script>
<script type="text/javascript" src="../../../../script/plug-in/base64.js" ></script>
<script type="text/javascript">
	var currentPage = 1;//当前分页数
	var totalPages = 0;//总页数
	var totalData = 0;//定义一个变量存储第一次加载返回来的总记录数
	var stage_id = -1;
	var keyword = "";
	var now_type = 1;//1.正常载入数据，2，通过搜索关键字加载数据中
	apiready = function (){
		commonSetTheme({"level":3,"type":0});
		commonRefreshHeaderInfo();
		commonScrollBottomReload();
		stage_id = api.pageParam.id;
		initData(1);
	};
	
	/*
	 * 功能：获取班级数据
	 * 作者：张自强
	 * 时间：20190219
	 * 接口：陈续刚
	 * class_type:0 获取全部班级 1获取行政班级 2获取教学班级 默认传1,后期会有教学班，现在传1就行
	 */
	function initData(current_page,change_type){
	    if(now_type == 1){
	        currentPage = current_page;
            showSelfProgress('加载中...');
            api.ajax({
                url:BASE_URL_ACTION + '/xx/hwt/getClassBySchoolStageID?randomNum=' + creatRandomNum()+'&bureau_id='+$api.getStorage('bureau_id')+'&class_type=1&pageNumber='+currentPage+'&pageSize='+BASE_PAGE_SIZE+'&stage_id='+stage_id,
                method : 'get',
                dataType : 'json',
                cache : false,
                timeout : 30,
               headers : {
                'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
            }
            },function(ret,err){
                if(err){
                    popToast('获取班级信息失败！');
                }else{
                    if(ret.success){
                        totalData = ret.data.totalRow;
                        totalPages = ret.data.totalPage;
                        data = {'list':[]};
                        if(ret.data.class_list){
                          data.list = ret.data.class_list;
                        }
                        commonAddManyHtml('div_body_class','div_script',data);
                    }else{
                        popToast('获取班级信息失败！');
                    }
                }
                api.hideProgress();
                commonControlRefresh();
                if (currentPage == 1){
		       		$api.byId("m_body").scrollTop = 0;
		       	}
            });
	    }else{
	       searchStuOrSb();
	    }
	}
	
	/*
	 * 功能：选择某个班级
	 * 作者：张自强
	 * 时间：20190219
	 */
	function selectClass(id,ybd_count,wbd_count,class_name){
	   commonOpenWin('xyk_work_stu_window', 'xyk_work_stu_window.html', false, false, {'header_h' : api.pageParam.header_h,'id':id,'ybd_count':ybd_count,'wbd_count':wbd_count,'class_name':class_name,'class_type':1,'stage_id':stage_id})
	}
	
	/*
     * 功能:选择学生
     * 作者：张自强
     * 时间：20190219
     */
    function selectStu(id,name,sxbMac,classId){
       var stu_type = 1;
       if(sxbMac == "未绑定"){
         stu_type = 2;
       }
       var param = {
           'header_h' : api.pageParam.header_h,
           'id':id,
           'stu_type':stu_type,
           'name':name,
           'sxbMac':sxbMac,
           'class_id':classId,
           'class_type':1,
           'stage_id':stage_id
       }
//     if(stu_type == 1){
//       commonOpenWin('xyk_work_bdfinish_window', 'xyk_work_bdfinish_window.html', false, false, param)   
//     }else{
//       commonOpenWin('xyk_work_bd_window', 'xyk_work_bd_window.html', false, false, param)   
//     }

		commonOpenWin('xyk_work_content_window', 'xyk_work_content_window.html', false, false, param);   
    }
	
	/*
	 * 功能：修改学段id
	 * 作者：张自强
	 * 时间：20190220
	 */
	function changeXdId(id){
	   stage_id = id;
	   if(now_type == 1){
	       initData(1);
	   }else{
	       searchStuOrSb();
	   }
	   
	}
	
   /*
    *作者:zhaoj
    *功能:设置搜索值，并根据搜索条件加载相关数据数据
    *日期：20161024
    */
    function setKeyword(type,data){
        if(type){
            currentPage = 1;//当前分页数
            totalPages = 0;//总页数
            totalData = 0;//定义一个变量存储第一次加载返回来的总记录数
            keyword = data;
            now_type = 2;
            if(keyword !=''){
                if (api.systemType == 'ios') {
                    keyword = keyword.replace(/%2B/g, "+");
                }
                keyword = Base64.decode(keyword);
            }
            searchStuOrSb()
        }else{
            now_type = 1;
            commonAddOrRemoveHideCss("div_body_stu",0);
            commonAddOrRemoveHideCss("div_body_class",1);
            initData(1);
        }
    }
    
    /*
     * 功能：搜索学生
     * 作者：张自强
     * 时间：20190221
     */
    function searchStuOrSb(){
        showSelfProgress('加载中...');
        api.ajax({
	        url:BASE_URL_ACTION + '/xx/hwt/getBoundInfo?bound_type=0&bureau_id='+$api.getStorage('bureau_id')+'&class_id=-1&class_type='+1+'&key_word='+keyword+'&o_type=1'+'&stage_id='+stage_id,
	        method:'post',
	        dataType : 'json',
	        timeout:30 
        },function(ret,err){
        	if(err){
        	   popToast('查找失败！');
        	}else{
        	   if(ret.success){
        	       console.log(JSON.stringify(ret));
        	       commonAddOrRemoveHideCss("div_body_stu",1);
        	       commonAddOrRemoveHideCss("div_body_class",0);
        	       commonAddManyHtml('div_body_stu','div_script_stu',ret);
        	   }else{
        	       popToast('查找失败！');
        	   }
        	}
        	api.hideProgress();
            commonControlRefresh();
            if (currentPage == 1){
	       		$api.byId("m_body").scrollTop = 0;
	       	}
        });
    }
    
    /*
     * 功能：修改已绑定未绑定人员信息
     * 作者:张自强
     * 时间：20190222
     */
    function changeBd(){
        initData(1);
    }
</script>
</html>