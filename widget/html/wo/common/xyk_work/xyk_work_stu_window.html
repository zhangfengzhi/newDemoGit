<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <!-- html5：在创建html时为了防止页面缩放等不兼容效果，要创建个viewport  -->
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
        <!-- 在IOS设备上，有时会将数字转为手机号，这里也要禁止下 -->
        <meta name="format-detection" content="telephone=no"/>
        <title>我的考勤</title>
        <link rel="stylesheet" type="text/css" href="../../../../css/aui/aui.css" />
        <link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
        <style>
            .history-date {
                font-size: 12px;
            }
            #message-content {
                overflow-y: auto;
                display: none;
            }
            
            
            .t_display_n {
                display: none;
            }
            .t_display_b {
                display: block;
            }
            .tag-title{height:45px; line-height:43px;background:#ffffff ;border-bottom:2px solid #E6E6E6;}
            .tag-title div{width:50%;text-align:center;color:#62656A;}
            .float-clear{overflow:auto}
            .tag-title-button{height:55px; line-height:43px;background:#f6f6f6;}
            .tag-title-button button{float:right}
            .menu{display:inline-block;width:28px;height:100%;background:url(../../image/fun-module/iphone/kaoqin/static.png) center center no-repeat;background-size: 16px 16px;}
    .win-menu{height:100%;}
            .fl{float:left;}
            .fr{float:right;}
            .button-reset{margin-right:5px;margin-top:16px;background:#3498db;height:30px;padding-top:5px;}
            .button-all-selected{margin-right:5px;margin-top:16px;background:#2ecc71;height:30px;padding-top:5px;}
.aui-searchbar-text-sys{width:30px;height:30px;background:url(../../../../image/wo/sys_logo.png) center center no-repeat;background-size:20px 20px;float:right;}
        </style>
    </head>
    <body class="w-iphone-common">
        <div id="wrap">
            <header class="aui-bar aui-bar-nav aui-bar-primary" id="aui-header" style="border-bottom:1px solid #efefef">
                <div id="cloud" class="topbar activebar">
                    <div id="back" class="back" onclick="back();" tapmode="">
                        <i class="aui-iconfont aui-icon-left"></i>返回
                    </div>
                    <div  class="mTitle" id="mTitle">
                        
                    </div>
                </div>
                <div class="tag-title aui-hide" id="change_sand_pdiv">
                    <div id="type_1" class="fl active" onclick="changeSandP(1);">已绑定（<span id="ybd_count"></span>）</div>
                    <div id="type_2" class="fr" onclick="changeSandP(2);">未绑定（<span id="wbd_count"></span>）</div>
                </div>
                <div class="aui-searchbar-wrap demo" id="search">
                    <div class="aui-searchbar aui-border-radius" tapmode onclick="doSearchClass();">
                        <i id="sys_first_logo" class="aui-iconfont aui-icon-search aui-hide"></i>
                        <div class="aui-searchbar-text clearfix" style="width:100%;text-align: center;"><i class="aui-iconfont aui-icon-search"></i>请输入学生姓名、用户名<div id="search_sys" tapmode onclick="nowOpenScanner(event);">&nbsp;</div></div>
                        <div class="aui-searchbar-input">
                            <form action="javascript:startSearch(1);">
                            <input oninput="commonRemoveExpression(this)" type="text" placeholder="最多支持20个字符" id="search-input" maxlength ='20'>
                            </form>
                        </div>
                        <i class="aui-iconfont aui-icon-roundclosefill" tapmode onclick="commonClearInput()"></i>
                    </div>
                    <div class="aui-searchbar-cancel aui-text-info" tapmode onclick="sxbCancelSearch()">取消</div>
                </div>
            </header>
            <div  class="aui-content aui-content-padded" id="message-content">
                <p class="aui-text-center history-date"></p>
            </div>
        </div>
    </body>
    <script type="text/javascript" src="../../../../script/api.js"></script>
    <script type="text/javascript" src="../../../../script/common/common.js"></script>
    <script type="text/javascript" src="../../../../script/base_config.js" ></script>
    <script type="text/javascript" src="../../../../script/init/init_config.js" ></script>
    <script type="text/javascript" src="../../../../script/assembly/tongjiData.js"></script>
    <script type="text/javascript" src="../../../../script/plug-in/base64.js" ></script>
    <script type="text/javascript">
        //顶部header高度
        var header_h;
        var wbdNum = 0;//未绑定
        var ybdNum = 0;//已绑定
        apiready = function() {
            commonSetTheme({"level":4,"type":0});
            header_h = api.pageParam.header_h;
            commonSetWindowName(api.pageParam.class_name);
            commonBackForAndroid();//安卓关闭
            commonIosAuiHeader();//定位header位置，留出上面电池等空隙，苹果需要
            wbdNum = api.pageParam.wbd_count;
            ybdNum = api.pageParam.ybd_count;
            changeStuNum(wbdNum,ybdNum)
            openStuListFrame(1);
        };
        /*
        *author:zhaoj
        *function:返回页面
        *date：20160307
        */
        function back() {
            api.closeWin();
        }
        
        /*
         * 功能：打开学生列表
         * 作者：张自强
         * 时间：20171011
         */
        function openStuListFrame(){
            var pageParamJson = {
                'id' : api.pageParam.id,
                'type' : 1,//全部
                'class_type':api.pageParam.class_type,
                'header_h':header_h,
                'stage_id':api.pageParam.stage_id
            };
            commonOpenFrame('xyk_work_stu_frame', 'xyk_work_stu_frame.html', header_h+96 - 45, true, false, '#f6f6f6', pageParamJson);
        }
        
        /*
         * 功能：切换家长和学生列表
         * 作者：张自强
         * 时间：20171011
         */
        function changeSandP(type){
            var domAll = $api.domAll($api.byId('change_sand_pdiv'), 'div');
            for(var i = 0; i < domAll.length; i++){
                $api.removeCls(domAll[i], 'active');
            }
            $api.addCls($api.byId('type_'+type), 'active');
            api.execScript({
                frameName : 'xyk_work_stu_frame',
                script: 'changeType('+type+');'
            });
        }
        
        /*
         * 功能：修改已绑定及未绑定的学生个数
         * 作者：张自强
         * 时间：20190219
         */
        function changeStuNum(wbd_count,ybd_count){
            $api.html($api.byId('wbd_count'), wbd_count);
            $api.html($api.byId('ybd_count'), ybd_count);
        }
        
        /*
        *作者:zhaoj
        *功能:开始搜索
        *日期：20161024
        */
        function startSearch(type){
            if(commonRemoveHTMLTag($api.trimAll($api.val($api.byId("search-input")))) == ''){
                api.execScript({
                    name : api.winName,
                    frameName : 'xyk_work_stu_frame',
                    script : 'setKeyword(0,"");'
                });
            }else{
                commonSearch(type,function(data){
                    if(!((data == null || typeof(data) == undefined || data == "") && type == 1)){
                        api.execScript({
                            name : api.winName,
                            frameName : 'xyk_work_stu_frame',
                            script : 'setKeyword('+type+',"'+data+'");'
                        });
                    }
                })
            }
        }
        
     /*
      *作者:zhaoj
      *功能:点击搜索
      *日期：20161024
      */
     function doSearchClass() {
         commonAddOrRemoveHideCss('sys_first_logo',1);
         $api.addCls($api.dom(".aui-searchbar-wrap"), "focus");
         $api.dom('.aui-searchbar-input input').focus();
         $api.removeAttr($api.byId('search_sys'), 'onclick');
     }
     
     /*
     * 功能：获取扫一扫返回的数据
     * 作者：张自强
     * 时间：20190221
     */
    function openBdFrame(type,content){
        content = Base64.encode(content);
        api.execScript({
            name : api.winName,
            frameName : 'xyk_work_stu_frame',
            script : 'setKeyword(1,"'+content+'");'
        });
    }
    
    /*
     * 功能:打开扫一扫
     * 作者：张自强
     * 时间：20190221
     */
    function nowOpenScanner(e){
        openScanner('sxb',2);
        e.stopPropagation();
    }
    
    /*
     * 功能：修改已绑定未绑定人员信息
     * 作者:张自强
     * 时间：20190222
     */
    function changeBd(type,num){
        if(type == 1){
            wbdNum = wbdNum + ybdNum - num;
            ybdNum = num;
        }else if(type == 2){
            ybdNum = wbdNum + ybdNum - num;
            wbdNum = num;
        }
        changeStuNum(wbdNum,ybdNum);
    }
    
    /*
     * 功能：扫描学生二维码并搜索
     * 作者：张自强
     * 时间：20190301
     */
    function　searchStuSys(login_name){
        $api.val($api.byId("search-input"),login_name);
        $api.addCls($api.dom(".aui-searchbar-wrap"), "focus");
        $api.removeAttr($api.byId('search_sys'), 'onclick');
        startSearch(1);
    }
    
    /*
     * 功能：取消搜索
     * 作者：张自强
     * 时间：20190301
     */
    function sxbCancelSearch(){
        startSearch(0);
        commonAddOrRemoveHideCss('sys_first_logo',0);
        var content = $api.val($api.byId("search-input"));
        $api.val($api.byId("search-input"), '');
        $api.removeCls($api.dom(".aui-searchbar-wrap.focus"), "focus");
        $api.val($api.byId("search-input"), '');
        $api.dom('.aui-searchbar-input input').blur();
    }
    </script>
</html>