<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<!-- html5：在创建html时为了防止页面缩放等不兼容效果，要创建个viewport  -->
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<!-- 在IOS设备上，有时会将数字转为手机号，这里也要禁止下 -->
		<meta name="format-detection" content="telephone=no"/>
		<title>通知数据页面</title>
		<link rel="stylesheet" type="text/css" href="../../../css/aui/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../../css/aui_css_new/aui.css" />
		<link id="j_theme_base" rel="stylesheet" type="text/css" href="" />
		<style>
			.footer-div {position: fixed;height: 45px;background:#ffffff;color: #8E8E8E;display: block;bottom: 0px;width: 100%;border-top: 1px solid #DBDBDB;}
			.footer-div .btn {width: 50%;display: inline-block;text-align: center;height: 55px;border-right: 1px solid #DBDBDB;float:left;}
			.footer-div .zan {width: 50%;display: inline-block;text-align: center;height: 30px;float:left;}
			.footer-div .btn .span,.footer-div .zan .span{display:inline-block;line-height:20px;height:55px;display: inline-block;float: left;width: 50%;padding-right: 7px;}
			.footer-div .zan .span{line-height:23px;}
			.footer-div .btn .span img,.footer-div .zan .span img{display:inline;height:32px;float:right;margin-right:0px;padding-top:12px;}
			.footer-div .btn .span img{padding-top:14px;}
			.footer-div .btn .num,.footer-div .zan .num{float: left;display: inline-block;width: 50%;text-align: left;height: 55px;padding-top: 12px;padding-left: 7px;}
			.footer-div .zan .num{padding-top: 13px;}
			.clearfix:after {content: ' ';display: block;clear: both;visibility: hidden;line-height: 0;height: 0;}
			.ellipsis {white-space: nowrap;overflow: hidden;text-overflow: ellipsis;}
			.title {font-size: 20px;padding: 5px 15px 15px 15px;line-height: 30px;color: #484848;word-break: break-all;}
			.preview {padding: 0 15px 10px 15px;color: #C7C7C7;font-size: 12px;}
			.preview .wid50 {width: 45%;}
			.preview .wid100 {width: 100%;}
			.fl{float:left;}
			.fr{float:right;}
			.pre-num, .time {text-align: right;}
			.content-frame {color: #3A3A3A;padding: 10px 15px;word-break: break-all;}
			.content-frame table,.content-frame p,.content-frame div{max-width:100% !important;word-break: break-all;word-wrap:break-word;height:auto !important;}
			.comment {position:relative;color: #3A3A3A;font-size: 16px;margin:0 15px;background:#eeeeee;margin-top:10px;}
			.comt-btn {border: 1px solid #E6E6E6;height: 40px;line-height: 40px;text-align: center;border-radius: 3px;color: #c0c0c0;}
			.comt-btn-img {width: 20px;vertical-align: middle;}
			.comment-content li {padding-bottom :8px;margin:0 8px 0 35px;border-bottom:1px solid #dedede;}
			.comment-content li:last-child{border-bottom:none;}
			.comment-content .header-img {display: inline-block;width: 34px;height: 34px;margin-right: 8px;border-radius: 17px;vertical-align: middle;}
			.comment-content .details {padding-top:10px;height: 40px;color: #CACACA;font-size: 14px;margin-bottom:10px;}
			.comment-content .comt-person-name {display: inline-block;width: 100%;color:#777777;height:45px;position:relative;}
			.comment-content .comt-person-name span {bottom:0;left:0;}
			.comment-content .comt-time {width: 130px;position: absolute;right:0;top:0;color:#a3a3a3;}
			.comment-content .comment-text {color: #474747;font-size: 15px;word-break: break-all;}
			.comt-opt {margin-top: 7px;}
			.comt-opt div {width: 40px;float: right;text-align: right;color: #0062CC;font-size: 14px;}
			.shadow {position: absolute;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;background: #000000;opacity: 0;}
			.no-data {color: #c0c0c0;font-size:14px;padding:10px 0;line-height:18px;text-align:left !important;}
			.hr{height:10px;background:#f0f0f0;}
			.zan-content{padding:9px 8px 8px 35px;line-height:21px;font-size:14px;color:#777777;border-bottom: 1px solid #ffffff;}
			.zan-content span{word-break: break-all;}
			.footer{height:60px;}
			.triangle-down { position:absolute;width: 0; top:-8px;left:10px; height: 0;border-left: 8px solid transparent;border-right: 8px solid transparent;border-bottom: 8px solid #eeeeee; }
			.ima_notice{padding-left:0;padding-right:0;padding-top:10px;padding-bottom:0;}
			.video_notice{padding:0 5% 10px 5%;width: 100%;}
			.quanzi-title{font-size: 16px;width:100%;text-align:center;padding: 0 20px}
			.header-quanzi{margin-bottom:10px}
			.pinglun-person-name{display:inline-block;width:45%;}
			.reply{background: url(../../../image/fun-module/common/praise-comment.png) 20px -18px no-repeat; background-size: auto 35px;height:20px;}
			.delete-comt{background: url(../../../image/fun-module/common/delete.png) 20px 0px no-repeat; background-size: auto 16px;height:20px;}
			.left-dianzan{background: url(../../../image/fun-module/common/praise-comment.png) 5px 0px no-repeat; background-size: auto 35px;height:20px;width:40px;position:absolute;top:10px;}
			.left-pinglun{background: url(../../../image/fun-module/common/praise-comment.png) 5px -18px no-repeat; background-size: auto 35px;height:40px;width:40px;position:absolute;top:47px;}
			.details-no-huifu{padding-top:10px;height: 32px;color: #CACACA;font-size: 14px;}
			.reply-text{padding-top:3px;}
		</style>
	</head>
	<body id="j_body" class="init-iphone-body">
		<div id="shadow" class="shadow"></div>
		<div class="aui-content">
			<div id="j_content" class="clearfix" style="padding-top:10px">
		        <div class="quanzi-title"><span id="quanzi-title"></span></div>
			</div>
			<div id="notice_con_div" class="content-frame"></div>
			<div id="abc" class="comment">
				<div class="triangle-down"></div>
				<div id="zan_body" class="zan-content">
				</div>
				<div class="left-dianzan"></div>
				<script type="text/html" id="zan_script">
					<% if(praise_list.length == 0){ %>
						<span class="no-data">
							暂无点赞
						</span>
					<% }else{ %>
						<%for(var i=0; i < praise_list.length; i++) {%>
							<span>
								<%=praise_list[i].person_name %>
								<%if(i != praise_list.length-1){%> , <%}%>
							</span>
						<% } %>
					<%}%>
				</script>
				<ul id="div_body" class="comment-content aui-hide" style="position:relative;"></ul>
				<div id="pinglun-icon" class="left-pinglun aui-hide"></div>
				<script type="text/html" id="div_script">
					<% if(reply_list.length == 0){ %>
						<li class="no-data">
							暂无评论
						</li>
						<% }else{ %>
							<%for(var i=0; i < reply_list.length; i++) {%>
							<li style="padding-left:45px;position:relative;">		
								<img style="position:absolute;left:0;top:10px;width:40px;height:40px;" onerror="this.src='../../../image/common/header.png'" src="<%=reply_list[i].icon_url%>" margin/>
									<%if(reply_list[i].has_reply){%>
										<div class="details">
									<%}else{%>
										<div class="details-no-huifu">
									<%}%>
									<div class="comt-person-name" >
										<%if(reply_list[i].has_reply){%>
										<div class="pinglun-person-name ellipsis">
											<%=reply_list[i].person_name%>
										</div>	
										<div class="comt-time">
											<%=reply_list[i].time %>
										</div>
										</br>
										<span>
											<font>回复</font>&nbsp;<font class="person-name-font"><%=reply_list[i].parent_person_name%></font>
										<span>
										<%}else{%>
										<font class="person-name-font"><%=reply_list[i].person_name%></font>
											<div class="comt-time">
												<%=reply_list[i].time %>
											</div>
										<%}%>
										</br>
									</div>
								</div>
								<%if(reply_list[i].has_reply){%>
                                    <div class="comment-text reply-text">
                                <%}else{%>
                                    <div class="comment-text">
                                <%}%>
									<%=#reply_list[i].content %>
								</div>
								<div class="comt-opt clearfix">
									<%if(reply_list[i].show_delete){%>
									<div class="delete-comt" onclick="messageBoard_deletePost(<%=pageSize %>,<%=reply_list[i].topic_id %>,<%=reply_list[i].id %>);"></div>
									<%}%>
									<div class="reply" onclick='openCommentWindow(1,<%=reply_list[i].id %>,0,<%=reply_list[i].person_id %>,<%=reply_list[i].identity_id %>,"<%=reply_list[i].person_name %>");'>
									</div>
								</div>
							</li>
							<% } %>
						<%}%>
				</script>
			</div>
			<div class="footer">
				&nbsp;
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../../script/api.js" ></script>
	<script type="text/javascript" src="../../../script/base_config.js" ></script>
	<script type="text/javascript" src="../../../script/plug-in/template.js" ></script>
	<script type="text/javascript" src="../../../script/plug-in/base64.js" ></script>
	<script type="text/javascript" src="../../../script/common/common.js"></script>
	<script type="text/javascript" src="../../../script/assembly/photoBrowser.js"></script>
	<script type="text/javascript" src="../../../script/assembly/openResource.js"></script>
	<script type="text/javascript" src="../../../script/init/iphone/init_quanzi.js"></script>
	<script type="text/javascript" src="../../../script/assembly/openResource.js" ></script>
	<script type="text/javascript">
		var totalPages = 0;
		var zanTotalPages = 0;//赞总页数
		var totalData;//总页数
		var zanTotalData;
		var wz_id;
		var currentPage = 1;
		var zanCurrentPage = 1;//当前页面为第一页
		var article_person_id;//发表文章的人的id
		var speechRecognizer;
		var BASE_SERVER_NAME;//个人分类id
		var login_name="";//登录名
		var article_title = "";//文章名称
		var business_type;
		var height;
		var win_height;
		var header_h;
		var type;//0我的文章,1代表班级以及机构文章
		var wz_name;//文章标题
		var image_array=[];//所有图片路径
		var json_data;//存储文章数据
		apiready = function() {
			commonSetTheme({"level":3,"type":0});
			wz_id = api.pageParam.wz_id;
			win_height=api.winHeight*1;
			header_h = api.pageParam.header_h;
			type = api.pageParam.type;
			if(api.pageParam.menu_type == 105){
				business_type = 3;
			}else{
				business_type = 1;
			}
			$api.html($api.byId('quanzi-title'),api.pageParam.title);
			loadWzContentData(wz_id, api.pageParam.expand_id);
			getPraiseinfoList(1);//获取评论数据
			speechRecognizer = api.require('speechRecognizer');
			scrollBottomReload(); //上拉加载数据
			refreshHeaderInfo();
		};
		/**
		 * 加载数据
		 * 周枫
		 * 2016.2.29
		 */
		function loadWzContentData(wz_id, expand_id) {
			showSelfProgress('加载中...');
			var typeUrl;
			if(api.pageParam.menu_type == 105){
				typeUrl = BASE_URL_ACTION + '/blog_expand/get_article_expand?id=' + wz_id + '&expand_id=' + expand_id+ '&business_type=3&business_id=' + api.pageParam.menu_id+ '&business_iid=105';
			}else{
				typeUrl = BASE_URL_ACTION + '/ypt/blog/getArticleById?id=' + wz_id + '&expand_id=' + expand_id;
			}
			api.ajax({
				url : typeUrl,
				method : 'get',
				timeout : 30,
				dataType : 'json',
				headers : {
		'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				if (err) {
					popToast('获取圈子详情失败，请稍候重试');
				} else {
					if(ret.success){
						var show_quanzi_info = $api.getStorage('show_quanzi_info');
						show_quanzi_info.browse_num++;
						$api.setStorage('show_quanzi_info',show_quanzi_info);
						json_data = ret;
						$api.css($api.byId('abc'),'display:block;');
						$api.css($api.byId('footer_div'),'display:block;');

						article_person_id = ret.person_id;
						setTimeout(function (){
							getCommentInfo(1);
						},1000);

						var notice_con = ret.content;
						notice_con = transferBrStr(notice_con);
						var onerror_html = "this.src='../../../image/common/tpsx.png'";
						if (BASE_APP_TYPE == 1) {
//							var notice_str1 = '<img src="http://dsideal-yy';
//							var notice_str2 = '<img onclick="openPicture(this);" onerror='+onerror_html+' class="ima_notice" src="http://dsideal-yy';
							var notice_str1 = '<img ';
							var notice_str2 = '<img onclick="openPicture(this);" onerror='+onerror_html+' class="ima_notice"';
							notice_con = notice_con.replaceAll(notice_str1, notice_str2);
						} else {
//							var notice_str3 = '<img src="/dsideal_yy/html';
//							var notice_str4 = '<img onclick="openPicture(this);"  onerror='+onerror_html+' class="ima_notice" src="/dsideal_yy/html';
							var notice_str3 = '<img';
							var notice_str4 = '<img onclick="openPicture(this);"  onerror='+onerror_html+' class="ima_notice"';
							notice_con = notice_con.replaceAll(notice_str3, notice_str4);
						}
						
						var key = '/dsideal_yy';
                        if (notice_con.indexOf(key) != -1) {
                            var key_re = BASE_URL_ACTION;
                            notice_con = notice_con.replaceAll(key, key_re);
                        }
						
						wz_name = ret.title;
						$api.html($api.byId('notice_title_div'), ret.title);
						notice_con.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi, function (match, capture) {
							if (capture.indexOf('Material') != -1){
								image_array.push(capture);
							}
						});
						
						var temp_str = notice_con;
						if (temp_str.indexOf('<iframe') != -1){
							var ary = temp_str.split('dsideal_yy');
							temp_str = '';
							for (var i = 0; i < ary.length; i++){
								if (ary[i].indexOf('file_id=') != -1){
									var url = "'" + ary[i].slice(ary[i].indexOf("=") + 1,ary[i].indexOf('"'))+"'";
									temp_str ='<img src="../../../image/quanzi/video_play.png" class="video_notice" onclick="openVideo('+url+')"/>';
									var start_str = notice_con.slice(0,notice_con.indexOf("<iframe"));
									var end_str = notice_con.slice(notice_con.indexOf("</iframe>") + 9,notice_con.length);
									notice_con = start_str.concat(temp_str,end_str);
								}
							}
						}
						$api.html($api.byId('notice_con_div'), notice_con);
						login_name = ret.login_name;
						article_title = ret.title;
						//播放内容需要加密
	                    var voice_content = $api.text($api.byId('notice_con_div'));
			             commonVoiceContent(voice_content);
					}else{
						popToast('获取圈子详情失败，请稍候重试');
					}
				}
			});
		}
		//替换所有的回车换行
		function transferBrStr(content) {
			var string = content;
			try {
				string = string.replace(/\r\n/g, "<br />")
				string = string.replace(/\n/g, "<br />");
			} catch(e) {
				popAlert(e.message);
			}
			return string;
		}

		/*
		 *author:zhaoj
		 *function:打开书写评论的页面
		 *date：20160318
		 */
		function openCommentWindow(d, pid, pagesize, person_id, identity_id, person_name) {
			var fb = "fb";
//			api.execScript({
//	            name : 'root',
//	            script: 'reBackType("'+fb+'");'
//          });
			api.openWin({
				name : 'init_comment_window',
				url : 'init_comment_window.html',
				pageParam : {
					header_h : api.pageParam.header_h,
					d : d,
					pid : pid,
					pagesize : pagesize,
					person_id : json_data.person_id,
					identity_id : json_data.identity_id,
					person_name : json_data.person_name,
					wz_id : wz_id,
					expand_id : api.pageParam.expand_id,
					login_name : login_name,
					article_title :article_title,
				},
				bounces : false,
				opaque : false,
				showProgress : false,
				vScrollBarEnabled : false,
				hScrollBarEnabled : false,
				slidBackEnabled : false,
				delay : 0,
				animation : {
					type : "reveal", //动画类型（详见动画类型常量）
					subType : "from_right", //动画子类型（详见动画子类型常量）
					duration : 300
				},
			});
		}
		/*
		*author:zhaoj
		*function:评论点赞置顶
		*date：20160603
		*/
		function scrollTop(){
			document.getElementById("abc").scrollIntoView();
		}
		/*
		 *author:zhaoj
		 *function:获取评论信息
		 *date：20160318
		 */
		function getCommentInfo(page) {
			currentPage = page;
			api.ajax({
				url : BASE_URL_ACTION + '/bbs/topic/view?pageNumber=' + page + '&pageSize=' + BASE_PAGE_SIZE + '&sort=1&type_id=' + "person_blog_article_" + wz_id + '&message_type=2&random_num=' + creatRandomNum(),
				method : 'get',
				dataType : 'json',
				timeout : 30,
				cache : false,
				headers : {
					'Cookie' : 'person_id=' + $api.getStorage("person_id") + ';identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
				}
			}, function(ret, err) {
				if(err){
					popToast('获取评论信息失败，请稍候重试');
				}else{
					if (ret.success) {
						totalPages = ret.totalPage;
						$api.text($api.byId('j_pinlun_num'),ret.totalRow);
						if (ret.reply_list.length > 0) {
							//对数据进行处理
							for (var i = 0; i < ret.reply_list.length; i++) {
								ret.reply_list[i]["content"] = transferBrStr(ret.reply_list[i]["content"]);	
								ret.reply_list[i]["time"] = ret.reply_list[i].create_time.substring(0, 16);
								if (ret.reply_list[i].parent_person_id * 1) {
									ret.reply_list[i]["has_reply"] = 1
								} else {
									ret.reply_list[i]["has_reply"] = 0;
								}
								//是自己发表的文章，可以删除评论，不是自己发表的文章，不能删除
								if ($api.getStorage("person_id") * 1 == article_person_id * 1 || $api.getStorage("person_id") * 1 == ret.reply_list[i].person_id * 1) {
									ret.reply_list[i]["show_delete"] = 1;
								} else {
									ret.reply_list[i]["show_delete"] = 0;
								}
								//处理头像路径
								if(ret.reply_list[i].icon_url != ""){
									if(BASE_APP_TYPE == 1){
										ret.reply_list[i].icon_url = BASE_IMAGE_PRE + url_path_suffix + ret.reply_list[i].icon_url.substring(0, 2) + "/" +ret.reply_list[i].icon_url + commonReturnPhotoCutSize(1,96,96,ret.reply_list[i].icon_url.substring((ret.reply_list[i].icon_url.length)-3));
									}else{
										ret.reply_list[i].icon_url = BASE_URL_ACTION + BASE_IMAGE_BEGIN + ret.reply_list[i].icon_url.substring(0, 2) + "/" + ret.reply_list[i].icon_url + commonReturnPhotoCutSize(1,96,96,ret.reply_list[i].icon_url.substring((ret.reply_list[i].icon_url.length)-3));
									}	
								}
							}
							commonAddManyHtml('div_body', 'div_script', ret);
						} else {
							var data = {
								"reply_list" : []
							};
							commonAddManyHtml('div_body', 'div_script', ret)
						}
					} else {
						popToast('获取评论信息失败，请稍候重试');
						var data = {
							"reply_list" : []
						};
						commonAddManyHtml('div_body', 'div_script', ret)
					}	
				}
				$api.css($api.byId('shadow'), "z-index:-1;");
				//reloadListData();//重新加载列表数据
				//通知顶部下拉刷新数据加载完毕，组件会恢复到默认状态
				api.hideProgress();
				$api.removeCls($api.byId('div_body'), 'aui-hide');
				$api.removeCls($api.byId('pinglun-icon'), 'aui-hide');
				commonControlRefresh();
			});
		}
		/*
		 *author:zhaoj
		 *function:删除留言
		 *date：20160319
		 */
		function messageBoard_deletePost(pageSize, topic_id, postid) {
			api.confirm({
				title : '提示',
				msg : '确定删除该评论内容？',
				buttons : ['确定', '取消']
			}, function(ret, err) {
				if (ret) {
					if (ret.buttonIndex == 1) {
						$api.css($api.byId('shadow'), "z-index:2;");
						api.ajax({
							url : BASE_URL_ACTION + '/ypt/bbs/post/delete',
							method : 'get',
							dataType : 'json',
							cache : false,
							timeout : 30,
							data : {
								values : {
									"random_num" : creatRandomNum(),
									"topic_id" : topic_id,
									"post_id" : postid
								}
							},
							headers : {
								'Cookie' : 'person_id=' + $api.getStorage("person_id") + ';identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
							}
						}, function(ret, err) {
							api.hideProgress();
							if (ret.success) {
								subCommentNum();
							} else {
								popAlert("删除评论失败，" + ret.info);
								$api.css($api.byId('shadow'), "z-index:-1;");
							}
							if (err) {
								popAlert("删除评论失败");
								$api.css($api.byId('shadow'), "z-index:-1;");
							}
						});
					}
				}
			});
		}

		/*
		 *author:zhaoj
		 *function:删除留言数
		 *date：20160319
		 */
		function subCommentNum() {
			api.ajax({
				url : BASE_URL_ACTION + '/ypt/blog/subCommentNum',
				method : 'post',
				dataType : 'json',
				cache : false,
				timeout : 30,
				data : {
					values : {
						"random_num" : creatRandomNum(),
						"article_id" : wz_id,
						"person_id" : $api.getStorage("person_id"),
						"identity_id" : $api.getStorage("identity")
					}
				},
				headers : {
					'Cookie' : 'person_id=' + $api.getStorage("person_id") + ';identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
				}
			}, function(ret, err) {
				api.hideProgress();
				showSelfProgress('删除中...');
				setTimeout(function() {
					var show_quanzi_info = $api.getStorage('show_quanzi_info');
					show_quanzi_info.comment_num--;
					$api.setStorage('show_quanzi_info',show_quanzi_info);
					getCommentInfo(1);
				}, 2000);
			});
		}

		/**
		 * 上拉刷新页面数据
		 * 周枫
		 * 2015.11.24
		 */
		function scrollBottomReload() {
			api.setRefreshHeaderInfo({
				visible : true,
				loadingImg : 'widget://image/local_icon_refresh.png',
				bgColor : '#efefef',
				textColor : '#8E8E8E',
				textDown : '下拉加载更多...',
				textUp : '松开加载...',
				showTime : true
			}, function(ret, err) {
				//从服务器加载数据，完成后调用commonControlRefresh()方法恢复组件到默认状态
				//需要刷新的方法
				showSelfProgress('加载中...');
				currentPage = 1;
				getCommentInfo(currentPage);
				getPraiseinfoList(1);
			});
		}
		
		function refreshHeaderInfo(){
			api.addEventListener({
				name : 'scrolltobottom',
				extra : {
					threshold : 100 //设置距离底部多少距离时触发，默认值为0，数字类型
				}
			}, function(ret, err) {
				if ((currentPage + 1) <= totalPages) {
					currentPage = currentPage + 1;
					getCommentInfo(currentPage);
				} else {
					popToast('已加载全部数据');
				}
			});
		}
		
		/*
		*author:zhaoj
		*function:获取点赞数据
		*date：20160602
		*/
		function getPraiseinfoList(page){
			api.ajax({
				url : BASE_URL_ACTION + '/space/praise/get_praiseinfo_list?random_num='+creatRandomNum()+'&business_id='+wz_id+'&business_type=1&page_num='+page+'&page_size=9999',
				method : 'get',
				timeout : 30,
				dataType : 'json',
				headers : {
		'Cookie' : 'person_id=' + $api.getStorage("person_id") + '; identity_id=' + $api.getStorage("identity") + '; token=' + $api.getStorage("token_ypt") + ';'
	}
			}, function(ret, err) {
				//通知顶部下拉刷新数据加载完毕，组件会恢复到默认状态
				commonControlRefresh();
				if (err) {
					var data= {"page_size":9999,"page_num":1,"success":true,"total_page":1,"total_row":"2","praise_list":[]};
					addZanTemplateHtml('zan_body','zan_script',data);
				} else {
					if(ret.success){
						zanTotalPages = ret.total_page;
						addZanTemplateHtml('zan_body','zan_script',ret);
					}else{
						var data= {"page_size":9999,"page_num":1,"success":true,"total_page":1,"total_row":"2","praise_list":[]};
					addZanTemplateHtml('zan_body','zan_script',data);
					}
				}
			});
		}
		/*
		 *author:zhaoj
		 *function:渲染html
		 *date：20160602
		 */
		function addZanTemplateHtml(div_id, script_id, data) {
			var html_type = template.render(script_id, data);
			if (zanCurrentPage == 1) {
				document.getElementById(div_id).innerHTML = html_type;
			} else {
				$api.append($api.byId(div_id), html_type);
			}
		}
	

		
		/*
		 * 功能：获取点赞数据
		 * 作者：张自强
		 * 时间：20170918
		 */
		function useGetPraiseinfoList(){
			getPraiseinfoList(zanCurrentPage);
		}
		
		/*
		 * 功能：跳转到页面下方评论点赞的区域
		 * 作者：张自强
		 * 时间：20170919
		 */
		function turnToBottom(){
			document.getElementById("abc").scrollIntoView();
		}
		
		/*
		*author:zhaoj
		*function:打开图片预览
		*date：20171026
		*/
		function openPicture(e){
			//图片
			var res_url=$api.attr(e, 'src');
			//打开图片
			var index = 0;
			for(var i = 0; i <image_array.length;i++){
				if(image_array[i] == res_url){
					index = i;
					break;
				}
			}
			openPictureShowWin(image_array,index);
		}
		
		function openVideo(file_id){
			api.ajax({
				url : BASE_URL_ACTION + '/resCtl/getM3u8Status?file_id='+file_id,
				method : 'get',
				timeout : 30,
				dataType : 'json',
			}, function(ret, err) {
				if (ret && ret.success){
					common_openVideo.getUrl('mp4',file_id,'',ret.m3u8_status.toString())
				}else{
					popToast('获取视频信息失败，请稍后重试！');
				}
			});
		}
	</script>
</html>